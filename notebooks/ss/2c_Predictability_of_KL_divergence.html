
<!DOCTYPE html>


<html lang="en" data-content_root="../../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Predict Kullback-Leibler (KL) Divergence &#8212; On the predictability of f-divergence measures from catchment attributes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../../_static/doctools.js?v=9a2dae69"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../../_static/copybutton.js?v=f281be69"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/ss/2c_Predictability_of_KL_divergence';</script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../../_static/logo.png" class="logo__image only-light" alt="On the predictability of f-divergence measures from catchment attributes - Home"/>
    <script>document.write(`<img src="../../_static/logo.png" class="logo__image only-dark" alt="On the predictability of f-divergence measures from catchment attributes - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="../1_data.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../1a_Update_Catchment_Bounds.html">Update HYSETS Catchment Polygons</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1b_Update_Catchment_Attributes.html">Update HYSETS Catchment Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1c_Process_Target_Variables.html">Process Target Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="../1d_Fit_Continuous_Distributions.html">Fit Continuous Distributions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="../2_Methods.html">Methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="../2a_Predictability_of_Mean_Runoff.html">Predict Mean Runoff</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2b_Predictability_of_entropy.html">Predict (Shannon) Entropy</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2c_Predictability_of_KL_divergence.html">Predict Kullback-Leibler (KL) Divergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2d_Predictability_of_TVD.html">Predict Total Variation Distance (TVD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="../2e_Predictability_of_EMD.html">Predict Earth Mover’s Distance (EMD)</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="../Discussion.html">Discussion</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/dankovacek/divergence_measures" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/dankovacek/divergence_measures/issues/new?title=Issue%20on%20page%20%2Fnotebooks/ss/2c_Predictability_of_KL_divergence.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../../_sources/notebooks/ss/2c_Predictability_of_KL_divergence.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Predict Kullback-Leibler (KL) Divergence</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">Problem Formulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-prediction-problem">Binary Prediction Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-problem">Regression Problem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-import-and-model-setup">Data Import and Model Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pairwise-attribute-comparisons">Load pairwise attribute comparisons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-attribute-groupings">Define attribute groupings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-trial-parameters">Set trial parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-binary-classification-balance">Check the binary classification balance</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-target-column-binary-class-balances-by-bitrate">Compute the target column binary class balances by bitrate</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split">Train-Test Split</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-binary-model">Run Binary Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-regression-models">Run Regression Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results">Plot Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results-of-binary-classification-test">Plot Results of Binary Classification Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-results-discussion">Binary Results Discussion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results-of-d-kl-regression-test">Plot Results of <span class="math notranslate nohighlight">\(D_{KL}\)</span> Regression Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <section class="tex2jax_ignore mathjax_ignore" id="predict-kullback-leibler-kl-divergence">
<h1>Predict Kullback-Leibler (KL) Divergence<a class="headerlink" href="#predict-kullback-leibler-kl-divergence" title="Link to this heading">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Link to this heading">#</a></h2>
<p>Streamflow prediction in ungauged basins has classically focused on minimizing one or more loss functions, typically square error, NSE, and KGE, between observed (daily streamflow) values and predictions generated by some type of model, whether it be an empirical regionalization, statistical machine learning, or process-based rainfall runoff model.</p>
<p>Regionalization and machine learning models for PUB rely on existing streamflow monitoring network, and the performance of these models is tied to how well the network represents the ungauged space.  This connection leads to the question of how the arrangement of streamflow monitoring stations within the network impacts the overall performance of PUB models, particularly in terms of expected prediction error across all ungauged locations. Furthermore, are there environmental signals, orthogonal to streamflow, that contain enough information to differentiate between network arrangements such that the prediction error over ungauged areas can be minimized?</p>
<p>A simple interpretation of the loss functions commonly used in the PUB literature might be “how close are mean daily streamflow predictions to observed values?”  A much simpler question to ask of observational data is: “will a given model outperform random guessing in the long run?”.  This binary question represents a starting point to approach the optimal streamflow monitoring network problem.  The justification for asking such a basic question is that an expectation of the uncertainty reduction over the unmonitored space provided by a given monitoring arrangement supports a discriminant function to compare unique arrangements.  A simple question can be formulated to test on real data, in this case an ungauged space of over 1 million ungauged catchments and a set of over 1600 monitored catchments with which to train a model.</p>
<p>The binary prediction problem is followed by a regresson problem where the goal is to minimize the expectation of prediction error based on the <strong>Kullback-Leibler divergence</strong> <span class="math notranslate nohighlight">\(D_{KL}\)</span>, (a surrogate loss function from the class of <em>information discriminant</em> measures which is consistent with the exponential loss <span id="id1">[]</span>).</p>
</section>
<section id="problem-formulation">
<h2>Problem Formulation<a class="headerlink" href="#problem-formulation" title="Link to this heading">#</a></h2>
<section id="binary-prediction-problem">
<h3>Binary Prediction Problem<a class="headerlink" href="#binary-prediction-problem" title="Link to this heading">#</a></h3>
<p>The first question “is a given model better than random guessing in the long run” is formulated into a binary classification problem as follows:</p>
<ol class="arabic">
<li><p>The streamflow prediction model assumes that discharge at one location is equal to that a different lcoation on a unit area basis, commonly referred to as an equal unit area runoff (UAR) model.</p></li>
<li><p>Given the equal UAR model, an observed (proxy) catchment is a potential model for predicting the distribution of UAR for any unobserved (target) location,</p></li>
<li><p>A proxy is “informative” to a target if the proxy UAR is closer to the posterior target UAR than the maximum uncertainty (uniform distribution) prior.</p></li>
<li><p>A proxy is “disinformative” to a target if the maximum uncertainty (uniform distribution) prior is closer to the posterior target UAR than the proxy UAR.</p></li>
<li><p>The “closeness” of distributions is characterized by three measures from the general class of f-divergences, namely the total variation distance (TVD), the Kullback-Leibler divergence (<span class="math notranslate nohighlight">\(D_{KL}\)</span>), and the earth mover’s distance (EMD), also known as the Wasserstein distance.</p>
<p>For the Kullback-Leibler divergence <span class="math notranslate nohighlight">\(D_{KL}\)</span>:</p>
</li>
<li><p>The (posterior) target UAR distribution is denoted by <span class="math notranslate nohighlight">\(P\)</span>, and the proxy UAR distribution (model) is denoted by <span class="math notranslate nohighlight">\(Q\)</span>.</p></li>
<li><p>A proxy model is informative for some target location if <span class="math notranslate nohighlight">\(D_{KL}(P||\mathbb{U}) - D_{KL}(P||Q) &gt; 0\)</span></p>
<p>The binary problem formulation is then:</p>
</li>
<li><p>The discriminant function maps the difference in the two divergences to a binary outcome corresponding to the sign of the resulting quantity <span class="math notranslate nohighlight">\(Y = +1 \text{ if } D_{KL}(P||\mathbb{U}) - D_{KL}(P||Q) &gt; 0 \text{ or } -1 \text{ otherwise}\)</span></p></li>
<li><p>The goal is to miminize the probability of incorrect predictions, defined by the (Bayes) error <span class="math notranslate nohighlight">\(R_{\textbf{Bayes}}(\gamma, C) := \mathbb{P} \left(Y \neq \text{sign}(D_{KL}(\mathbf{P}||\mathbb{U}) - D_{KL}(\mathbf{P}||\mathbf{Q}) \right)\)</span></p></li>
</ol>
</section>
<section id="regression-problem">
<h3>Regression Problem<a class="headerlink" href="#regression-problem" title="Link to this heading">#</a></h3>
<p>The same problem setup applies for the regression prediction problem which is to optimize the discriminant function and the input signal quantization simultaneously to minimize the error in predicting the KL divergence from catchment attributes.</p>
<p>Instead of predicting a scalar measure which is a feature of a single location, the key difference in this step is the target variable describes a measure of the difference in runoff between <strong>pairs of locations</strong>.  This approach asks whether the <strong>Kullback-Leibler Divergence</strong> (KLD) of the distribution of unit area runoff between two locations can be predicted from the attributes of both catchments (and their differences) using the gradient boosted decision tree method, which is also capable of predicting continuous variables, in this case <span class="math notranslate nohighlight">\(D_{KL}\)</span>.</p>
<p>…</p>
</section>
</section>
<section id="data-import-and-model-setup">
<h2>Data Import and Model Setup<a class="headerlink" href="#data-import-and-model-setup" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>

<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span><span class="p">,</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Sunset10</span><span class="p">,</span> <span class="n">Vibrant7</span><span class="p">,</span> <span class="n">Category20</span><span class="p">,</span> <span class="n">Bokeh6</span><span class="p">,</span> <span class="n">Bokeh7</span><span class="p">,</span> <span class="n">Bokeh8</span>

<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="n">xgb</span><span class="o">.</span><span class="n">config_context</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">root_mean_squared_error</span><span class="p">,</span>
    <span class="n">mean_absolute_error</span><span class="p">,</span>
    <span class="n">roc_auc_score</span><span class="p">,</span>
    <span class="n">accuracy_score</span><span class="p">,</span>
    <span class="n">confusion_matrix</span><span class="p">,</span>
<span class="p">)</span>

<span class="kn">import</span> <span class="nn">data_processing_functions</span> <span class="k">as</span> <span class="nn">dpf</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>
<span class="n">output_notebook</span><span class="p">()</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line</span> <span class="mi">23</span>
<span class="g g-Whitespace">     </span><span class="mi">13</span> <span class="n">xgb</span><span class="o">.</span><span class="n">config_context</span><span class="p">(</span><span class="n">verbosity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>     <span class="n">root_mean_squared_error</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">17</span>     <span class="n">mean_absolute_error</span><span class="p">,</span>
   <span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>     <span class="n">confusion_matrix</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">23</span> <span class="kn">import</span> <span class="nn">data_processing_functions</span> <span class="k">as</span> <span class="nn">dpf</span>
<span class="g g-Whitespace">     </span><span class="mi">25</span> <span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">linregress</span>
<span class="g g-Whitespace">     </span><span class="mi">26</span> <span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">StratifiedKFold</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;data_processing_functions&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the catchment characteristics</span>
<span class="n">fname</span> <span class="o">=</span> <span class="s1">&#39;BCUB_watershed_attributes_updated.csv&#39;</span>
<span class="n">attr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">fname</span><span class="p">))</span>
<span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="n">station_ids</span> <span class="o">=</span> <span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">station_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> monitored basins in the attribute set.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>There are 1325 monitored basins in the attribute set.
</pre></div>
</div>
</div>
</div>
<section id="load-pairwise-attribute-comparisons">
<h3>Load pairwise attribute comparisons<a class="headerlink" href="#load-pairwise-attribute-comparisons" title="Link to this heading">#</a></h3>
<p>Load a few rows from one of the pairwise data files.  These contain attributes about divergence measures that are computed on concurrent and non-concurrent time series at two monitored locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># open an example pairwise results file</span>
<span class="n">input_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span>
    <span class="n">BASE_DIR</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">,</span> <span class="s2">&quot;processed_divergence_inputs&quot;</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">pairs_files</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">input_folder</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">pairs_files</span><span class="p">[:</span><span class="mi">4</span><span class="p">])</span>
<span class="n">test_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">pairs_files</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">nrows</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;KL_results_4bits_20240812.csv&#39;, &#39;BCUB_watershed_attributes_updated.csv&#39;, &#39;KL_results_6bits_20240812.csv&#39;, &#39;KL_results_4bits_20240812_partial_counts.csv&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">kld_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">test_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="s1">&#39;dkl&#39;</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
<span class="n">kld_columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;dkl_concurrent_uniform&#39;,
 &#39;dkl_concurrent_post_-5R&#39;,
 &#39;dkl_concurrent_post_-4R&#39;,
 &#39;dkl_concurrent_post_-3R&#39;,
 &#39;dkl_concurrent_post_-2R&#39;,
 &#39;dkl_concurrent_post_-1R&#39;,
 &#39;dkl_concurrent_post_0R&#39;,
 &#39;dkl_concurrent_post_1R&#39;,
 &#39;dkl_concurrent_post_2R&#39;,
 &#39;dkl_concurrent_post_3R&#39;,
 &#39;dkl_concurrent_post_4R&#39;,
 &#39;dkl_concurrent_post_5R&#39;,
 &#39;dkl_concurrent_post_6R&#39;,
 &#39;dkl_concurrent_post_7R&#39;,
 &#39;dkl_concurrent_post_8R&#39;,
 &#39;dkl_concurrent_post_9R&#39;,
 &#39;dkl_concurrent_post_10R&#39;,
 &#39;dkl_nonconcurrent_uniform&#39;,
 &#39;dkl_nonconcurrent_post_-5R&#39;,
 &#39;dkl_nonconcurrent_post_-4R&#39;,
 &#39;dkl_nonconcurrent_post_-3R&#39;,
 &#39;dkl_nonconcurrent_post_-2R&#39;,
 &#39;dkl_nonconcurrent_post_-1R&#39;,
 &#39;dkl_nonconcurrent_post_0R&#39;,
 &#39;dkl_nonconcurrent_post_1R&#39;,
 &#39;dkl_nonconcurrent_post_2R&#39;,
 &#39;dkl_nonconcurrent_post_3R&#39;,
 &#39;dkl_nonconcurrent_post_4R&#39;,
 &#39;dkl_nonconcurrent_post_5R&#39;,
 &#39;dkl_nonconcurrent_post_6R&#39;,
 &#39;dkl_nonconcurrent_post_7R&#39;,
 &#39;dkl_nonconcurrent_post_8R&#39;,
 &#39;dkl_nonconcurrent_post_9R&#39;,
 &#39;dkl_nonconcurrent_post_10R&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;kld_prediction_results&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">results_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">binary_results_folder</span><span class="p">)</span>

<span class="n">binary_results_folder</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">BASE_DIR</span><span class="p">,</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="s1">&#39;kld_prediction_results_binary&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">binary_results_folder</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">binary_results_folder</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="define-attribute-groupings">
<h3>Define attribute groupings<a class="headerlink" href="#define-attribute-groupings" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">terrain</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">,</span> <span class="s1">&#39;elevation_m&#39;</span><span class="p">,</span> <span class="s1">&#39;slope_deg&#39;</span><span class="p">,</span> <span class="s1">&#39;aspect_deg&#39;</span><span class="p">]</span> <span class="c1">#&#39;gravelius&#39;, &#39;perimeter&#39;,</span>
<span class="n">land_cover</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s1">&#39;land_use_forest_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_grass_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_wetland_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_water_frac_2010&#39;</span><span class="p">,</span> 
    <span class="s1">&#39;land_use_urban_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_shrubs_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_crops_frac_2010&#39;</span><span class="p">,</span> <span class="s1">&#39;land_use_snow_ice_frac_2010&#39;</span><span class="p">]</span>
<span class="n">soil</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;logk_ice_x100&#39;</span><span class="p">,</span> <span class="s1">&#39;porosity_x100&#39;</span><span class="p">]</span>
<span class="n">climate</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;prcp&#39;</span><span class="p">,</span> <span class="s1">&#39;srad&#39;</span><span class="p">,</span> <span class="s1">&#39;swe&#39;</span><span class="p">,</span> <span class="s1">&#39;tmax&#39;</span><span class="p">,</span> <span class="s1">&#39;tmin&#39;</span><span class="p">,</span> <span class="s1">&#39;vp&#39;</span><span class="p">,</span> <span class="s1">&#39;high_prcp_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;high_prcp_duration&#39;</span><span class="p">,</span> <span class="s1">&#39;low_prcp_freq&#39;</span><span class="p">,</span> <span class="s1">&#39;low_prcp_duration&#39;</span><span class="p">]</span>
<span class="n">all_attributes</span> <span class="o">=</span> <span class="n">terrain</span> <span class="o">+</span> <span class="n">land_cover</span> <span class="o">+</span> <span class="n">soil</span> <span class="o">+</span> <span class="n">climate</span>
<span class="nb">len</span><span class="p">(</span><span class="n">all_attributes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>24
</pre></div>
</div>
</div>
</div>
</section>
<section id="set-trial-parameters">
<h3>Set trial parameters<a class="headerlink" href="#set-trial-parameters" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># define the amount of data to set aside for final testing</span>
<span class="n">nfolds</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">n_boost_rounds</span> <span class="o">=</span> <span class="mi">100</span>
<span class="n">n_optimization_rounds</span> <span class="o">=</span> <span class="mi">10</span>
<span class="n">priors_to_test</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">random_state</span> <span class="o">=</span> <span class="mi">42</span>
<span class="n">loss</span> <span class="o">=</span> <span class="s1">&#39;reg:absoluteerror&#39;</span>

<span class="c1">#define if testing concurrent or nonconcurrent data</span>
<span class="n">concurrent</span> <span class="o">=</span> <span class="s1">&#39;concurrent&#39;</span>

<span class="c1"># partial counts refer to the test where observations were assigned</span>
<span class="c1"># a uniform distribution to approximate error and allow fractional </span>
<span class="c1"># observations in state space</span>
<span class="n">partial_counts</span> <span class="o">=</span> <span class="kc">False</span>

<span class="c1"># the input data file has an associated revision date</span>
<span class="n">revision_date</span> <span class="o">=</span> <span class="s1">&#39;20240812&#39;</span>

<span class="n">all_test_results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">attribute_set_names</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;climate&#39;</span><span class="p">,</span> <span class="s1">&#39;+terrain&#39;</span><span class="p">,</span> <span class="s1">&#39;+land_cover&#39;</span><span class="p">,</span> <span class="s1">&#39;+soil&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="check-the-binary-classification-balance">
<h3>Check the binary classification balance<a class="headerlink" href="#check-the-binary-classification-balance" title="Link to this heading">#</a></h3>
<p>The figure below shows how the binary classification balance changes as a function of both the dictionary size and the prior.  Coloured lines in the plot represent different dictionary sizes, and the log x-axis scale reflects the range of priors tested in the form of pseudo counts applied to <span class="math notranslate nohighlight">\(Q\)</span>, the simulated UAR distribution.  The y-axis represents the fraction of True Y values (the target variable), described above as proxy-target (observed-simulated) pairs where the simulated distribution is “closer to” the observed (posterior) compared to the uniform distribution.</p>
<p>The balance of the target variable is sensitive to both the choice of prior and the dictionary size for the range of values tested.  Changing the the dictionary size between <span class="math notranslate nohighlight">\(2^4\)</span> and <span class="math notranslate nohighlight">\(2^{12}\)</span> bits changes the proportion of models that are “better than random guessing” by about 3-8% given any prior, while changing the prior from <span class="math notranslate nohighlight">\(10^{-5}\)</span> to <span class="math notranslate nohighlight">\(10^5\)</span>  changes the same by between 10 and 25% for a given dictionary size.  Smaller priors correspond to larger penalties for underspecified models, so the prior controls the “selectivity” of the model with respect to the discriminant function, controlling the number of “informative models”.  The smallest prior (<span class="math notranslate nohighlight">\(10^{-5}\)</span> pseudo-counts) at 12 bits quantization yields the most selective model where 75% of the pairings are rejected, those whose KL divergence <span class="math notranslate nohighlight">\(D_{KL}(P||Q)\)</span> is less than <span class="math notranslate nohighlight">\(D_{KL}(P||\mathbb{U})\)</span>.</p>
<p>The point is to create contrast within the sample set such that the “usefulness” of models and the predictors thereof can be most effectively distinguished by the gradient boosting procedure.  “Real” in this context is intended to mean “representative of information about processes governing long-term runoff” contained in the signal, as opposed to vestigial effects of data pre-processing, measurement uncertainty, or the model itself (epistemic &amp; aleatoric uncertainty).</p>
<p>A  discriminant function has the effect of attenuating the decision space of the sensor network arrangement problem, because fewer True values means fewer viable monitoring locations.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>

<span class="k">for</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
        <span class="k">continue</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bitrate = </span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;KL_results_</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s2">bits_</span><span class="si">{</span><span class="n">revision_date</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="c1"># if partial_counts is true, we load a separate result file</span>
    <span class="c1"># where observation counts incorporated a 10% uniform uncertainty</span>
    <span class="n">whole_counts_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;KL_results_</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s2">bits_</span><span class="si">{</span><span class="n">revision_date</span><span class="si">}</span><span class="s2">.csv&quot;</span>
    <span class="n">partial_counts_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;KL_results_</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s2">bits_</span><span class="si">{</span><span class="n">revision_date</span><span class="si">}</span><span class="s2">_partial_counts.csv&quot;</span>

    <span class="n">wc_input_data_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">whole_counts_fname</span><span class="p">)</span>
    <span class="n">pc_input_data_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">partial_counts_fname</span><span class="p">)</span>
    
    <span class="n">df_partial</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pc_input_data_fpath</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">df_whole</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">wc_input_data_fpath</span><span class="p">,</span> <span class="n">nrows</span><span class="o">=</span><span class="n">nrows</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    
    <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;partial&#39;</span><span class="p">:</span> <span class="n">df_partial</span><span class="p">,</span> <span class="s1">&#39;whole&#39;</span><span class="p">:</span> <span class="n">df_whole</span><span class="p">}</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bitrate = 4
bitrate = 6
bitrate = 8
bitrate = 9
bitrate = 10
bitrate = 11
bitrate = 12
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">posterior_columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">df_partial</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">c</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_post&#39;</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<section id="compute-the-target-column-binary-class-balances-by-bitrate">
<h4>Compute the target column binary class balances by bitrate<a class="headerlink" href="#compute-the-target-column-binary-class-balances-by-bitrate" title="Link to this heading">#</a></h4>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_target_balance</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">concurrent</span><span class="p">,</span> <span class="n">posterior_columns</span><span class="p">):</span>
    <span class="n">balances</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">target_col</span> <span class="ow">in</span> <span class="n">posterior_columns</span><span class="p">:</span>
        <span class="n">posterior</span> <span class="o">=</span> <span class="n">target_col</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># if DKL(P||Q) &lt; DKL(P||U), then the model is a &quot;better compressor&quot;</span>
        <span class="c1"># of the target signal than a uniform distribution</span>
        <span class="n">df</span><span class="p">[</span><span class="s1">&#39;binary_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_uniform&#39;</span><span class="p">]</span>
        <span class="n">ut</span><span class="p">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;binary_target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">pct_false</span> <span class="o">=</span> <span class="n">ct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
        <span class="n">balances</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">pct_false</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">balances</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_balance_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binary_results_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;dkl_binary_balance_result.csv&#39;</span><span class="p">)</span>

<span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">class_balance_fpath</span><span class="p">):</span>
    <span class="n">class_balance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">class_balance_fpath</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">class_balance_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">13</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
            <span class="k">continue</span>
            
        <span class="n">partial_count_df</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;partial&#39;</span><span class="p">]</span>
        <span class="n">whole_count_df</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;whole&#39;</span><span class="p">]</span>
        
        <span class="n">class_balance_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s1">_partial_counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_target_balance</span><span class="p">(</span><span class="n">partial_count_df</span><span class="p">,</span> <span class="n">concurrent</span><span class="p">,</span> <span class="n">posterior_columns</span><span class="p">)</span>
        <span class="n">class_balance_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s1">_whole_counts&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">compute_target_balance</span><span class="p">(</span><span class="n">whole_count_df</span><span class="p">,</span> <span class="n">concurrent</span><span class="p">,</span> <span class="n">posterior_columns</span><span class="p">)</span>
        
    <span class="n">class_balance_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]))</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">posterior_columns</span><span class="p">]</span>
    <span class="n">class_balance_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;prior&#39;</span>
    <span class="n">class_balance_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">class_balance_fpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">class_balance_df</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;4_partial_counts&#39;, &#39;4_whole_counts&#39;, &#39;6_partial_counts&#39;,
       &#39;6_whole_counts&#39;, &#39;8_partial_counts&#39;, &#39;8_whole_counts&#39;,
       &#39;9_partial_counts&#39;, &#39;9_whole_counts&#39;, &#39;10_partial_counts&#39;,
       &#39;10_whole_counts&#39;, &#39;11_partial_counts&#39;, &#39;11_whole_counts&#39;,
       &#39;12_partial_counts&#39;, &#39;12_whole_counts&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bal_figs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">count_type</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="s1">&#39;partial&#39;</span><span class="p">]:</span>
    <span class="n">bal_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">count_type</span><span class="si">}</span><span class="s1"> counts&#39;</span><span class="p">,</span>
                    <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">))</span>
    <span class="n">class_cols</span> <span class="o">=</span> <span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">count_type</span><span class="si">}</span><span class="s1">_counts&#39;</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]]</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">class_cols</span><span class="p">:</span>
        <span class="n">bal_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">class_balance_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">class_balance_df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">Category20</span><span class="p">[</span><span class="mi">8</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> 
                     <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span><span class="si">}</span><span class="s1"> bits&#39;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">bal_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Prior Q (Pseudo-counts)} [ 10^\alpha ]$$&#39;</span>
    <span class="n">bal_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{P(True) } [ \% ]$$&#39;</span>
    <span class="n">bal_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;bottom_right&#39;</span>
    <span class="n">bal_figs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bal_fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bal_fig_layout</span> <span class="o">=</span> <span class="n">row</span><span class="p">(</span><span class="n">bal_figs</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">bal_fig_layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="e56924bf-1130-42ba-9819-2882dd33cf77" data-root-id="p1211" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"aca3ecd8-b3ff-474c-94c4-8c04579e5b32":{"version":"3.4.1","title":"Bokeh Application","roots":[{"type":"object","name":"Row","id":"p1211","attributes":{"children":[{"type":"object","name":"Figure","id":"p1001","attributes":{"width":550,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1003"},"y_range":{"type":"object","name":"Range1d","id":"p1011","attributes":{"start":0.25,"end":0.55}},"x_scale":{"type":"object","name":"LogScale","id":"p1012"},"y_scale":{"type":"object","name":"LinearScale","id":"p1013"},"title":{"type":"object","name":"Title","id":"p1004","attributes":{"text":"whole counts"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1041","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1035","attributes":{"selected":{"type":"object","name":"Selection","id":"p1036","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1037"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"5g8JTQwX2T8uM2BY80nZP1bLeEr7gNk/QOqP7JzE2T84FHb03BzaP4RpOOgonto/ihDkDQ+f2z82VnJYLZvdP/gSpWdSzN8/pInEO91d4D9KCIgwu3HgP5h5cFUqdOA/wFkTpXN04D9seA+zdnTgP2x4D7N2dOA/bHgPs3Z04D8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1042","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1043"}}},"glyph":{"type":"object","name":"Line","id":"p1038","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1039","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1040","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1052","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1046","attributes":{"selected":{"type":"object","name":"Selection","id":"p1047","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1048"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"mh3LdmiR2D94g7qyCN3YPzwU1gT+PNk/ZLKCAfmw2T/4iZeGa0raP6oc2OhDPts/8qEnkPX93D90cfcTAWHfP/YSXZs5dOA/5aleEPeo4D8UBnXKxLDgPywNcXORseA/OiFO8ayx4D86IU7xrLHgPzohTvGsseA/OiFO8ayx4D8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1053","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1054"}}},"glyph":{"type":"object","name":"Line","id":"p1049","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1050","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1051","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1062","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1056","attributes":{"selected":{"type":"object","name":"Selection","id":"p1057","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1058"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"alBKhnBk1j9KqeU7bufWP5btyhGvidc/nrl6+CRn2D9i/Vbks5jZP7KyBgFAgNs/QOgqevNv3j/Stb2pE3fgP2YUHPvO8OA/Dz3ygeoK4T8wI+ay4w7hP3/jK1J2D+E/2CAkbnwP4T/YICRufA/hP9ggJG58D+E/2CAkbnwP4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1063","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1064"}}},"glyph":{"type":"object","name":"Line","id":"p1059","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1060","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1061","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1072","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1066","attributes":{"selected":{"type":"object","name":"Selection","id":"p1067","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1068"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"4JGEXvv21D8kvDvVcJXVP8QX1vM4Y9Y/7BIT88d11z+eyOyShP/YP8jo4OO0d9s/7M4KrsD93j9MkOCG4rngPxS4Jtp/GuE/esW3hIUu4T80H6BEvjHhP/5lVk74MeE/r+BGhgQy4T9b/0KUBzLhP1v/QpQHMuE/W/9ClAcy4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1073","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1074"}}},"glyph":{"type":"object","name":"Line","id":"p1069","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1070","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1071","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1082","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1076","attributes":{"selected":{"type":"object","name":"Selection","id":"p1077","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1078"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Zi1LJ2m80j8IYtYRF4fTP0ZYtxx8kNQ/rIZ2gbrz1T+UDNu3KgnYPzA/O/7qTNs/GiDYVHZj3z9Q0yiNUufgP90oNp1NPOE/HC8VxO9M4T/IOeoubk/hP6CUfbbDT+E/Ug9u7s9P4T9SD27uz0/hP1IPbu7PT+E/Ug9u7s9P4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1083","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1084"}}},"glyph":{"type":"object","name":"Line","id":"p1079","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1080","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1081","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1092","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1086","attributes":{"selected":{"type":"object","name":"Selection","id":"p1087","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1088"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"+IVi3R9w0T9gWtvEQ1PSP6As9yAIeNM/Jk8Nx8AP1T/Y8Z7FxnPXPxRk0wlNJNs/eHxTyEus3z92jscbDAvhP1Cs6dAnVOE/2u8KOTli4T/Q6MRqA2ThP+4Qf2Y6ZOE/Rk53gkBk4T9GTneCQGThP0ZOd4JAZOE/mi97dD1k4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1093","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1094"}}},"glyph":{"type":"object","name":"Line","id":"p1089","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1090","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1091","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1102","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1096","attributes":{"selected":{"type":"object","name":"Selection","id":"p1097","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1098"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"BHHiilMN0T/yLIiwf/7RP2LVrwy4QtM/YlAkRAsS1T+Cb2bR+MjXPwJMPWy4fds/xC3HvF303z/+vILOqSPhP4vgZx+DY+E/DQpbKMlt4T+WVUuWaG/hP6VpKBSEb+E//qYgMIpv4T/+piAwim/hP/6mIDCKb+E//qYgMIpv4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1103","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1104"}}},"glyph":{"type":"object","name":"Line","id":"p1099","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1100","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1101","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1010","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1024"},{"type":"object","name":"WheelZoomTool","id":"p1025","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1026","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1027","attributes":{"syncable":false,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1032"},{"type":"object","name":"ResetTool","id":"p1033"},{"type":"object","name":"HelpTool","id":"p1034"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1019","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1020","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1021"},"axis_label":"$$\\text{P(True) } [ \\% ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1022"}}}],"below":[{"type":"object","name":"LogAxis","id":"p1014","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1015","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1016"},"axis_label":"$$\\text{Prior Q (Pseudo-counts)} [ 10^\\alpha ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1017"}}}],"center":[{"type":"object","name":"Grid","id":"p1018","attributes":{"axis":{"id":"p1014"}}},{"type":"object","name":"Grid","id":"p1023","attributes":{"dimension":1,"axis":{"id":"p1019"}}},{"type":"object","name":"Legend","id":"p1044","attributes":{"location":"bottom_right","items":[{"type":"object","name":"LegendItem","id":"p1045","attributes":{"label":{"type":"value","value":"4 bits"},"renderers":[{"id":"p1041"}]}},{"type":"object","name":"LegendItem","id":"p1055","attributes":{"label":{"type":"value","value":"6 bits"},"renderers":[{"id":"p1052"}]}},{"type":"object","name":"LegendItem","id":"p1065","attributes":{"label":{"type":"value","value":"8 bits"},"renderers":[{"id":"p1062"}]}},{"type":"object","name":"LegendItem","id":"p1075","attributes":{"label":{"type":"value","value":"9 bits"},"renderers":[{"id":"p1072"}]}},{"type":"object","name":"LegendItem","id":"p1085","attributes":{"label":{"type":"value","value":"10 bits"},"renderers":[{"id":"p1082"}]}},{"type":"object","name":"LegendItem","id":"p1095","attributes":{"label":{"type":"value","value":"11 bits"},"renderers":[{"id":"p1092"}]}},{"type":"object","name":"LegendItem","id":"p1105","attributes":{"label":{"type":"value","value":"12 bits"},"renderers":[{"id":"p1102"}]}}]}}]}},{"type":"object","name":"Figure","id":"p1106","attributes":{"width":550,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1108"},"y_range":{"type":"object","name":"Range1d","id":"p1116","attributes":{"start":0.25,"end":0.55}},"x_scale":{"type":"object","name":"LogScale","id":"p1117"},"y_scale":{"type":"object","name":"LinearScale","id":"p1118"},"title":{"type":"object","name":"Title","id":"p1109","attributes":{"text":"partial counts"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1146","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1140","attributes":{"selected":{"type":"object","name":"Selection","id":"p1141","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1142"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"cLM0xTty2T/Ej7M2JJ3ZPxjOd7PFy9k/Dn+nh04E2j9YzZZeuFDaPyq43pBvw9o/NP6DvYu42z/2tCLCvazdP7roAJIP198/vPIF8GJi4D8/7Rq/AHbgP35KJmZUeOA/SJHcb4544D/0r9h9kXjgP6DO1IuUeOA/oM7Ui5R44D8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1147","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1148"}}},"glyph":{"type":"object","name":"Line","id":"p1143","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1144","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1145","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1157","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1151","attributes":{"selected":{"type":"object","name":"Selection","id":"p1152","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1153"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"eKjdHc3F2T8Ox4G8dADaP0B1ZLfeSdo/UvKs59Cd2j8my6xhORTbPyBU6Nr42ts/ylp6MAhm3T90EVsSupLfPyRy/zwpgeA/czFrBp+y4D94rrvYS7ngP0PI9yX9ueA/PJ/6ixK64D88n/qLErrgPzyf+osSuuA/PJ/6ixK64D8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1158","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1159"}}},"glyph":{"type":"object","name":"Line","id":"p1154","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1155","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1156","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1167","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1161","attributes":{"selected":{"type":"object","name":"Selection","id":"p1162","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1163"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"LLkdo1672j9ud3JsvwLbPwyfli+YW9s//p6wzPDI2z/UkQoueWjcP+BU7yW1k90/PFCkf36Q3z8xLi/G+7DgPy+FK76cEuE/YyFA+WAp4T/O9RjxpSzhPwlGjegTLeE/E/51PCYt4T8T/nU8Ji3hPxP+dTwmLeE/E/51PCYt4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1168","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1169"}}},"glyph":{"type":"object","name":"Line","id":"p1164","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1165","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1166","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1177","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1171","attributes":{"selected":{"type":"object","name":"Selection","id":"p1172","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1173"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"OGpGe8Ev2z9GGWTgmX3bP6g+MhQ53Ns/eCg7NAFX3D86/WrtARPdP0if1LsWeN4/9gT6irhD4D+gW4LavwXhP+bEKEhNS+E/zo0PU+lb4T/IHfSFW17hPzknsnOPXuE/PoOmnZhe4T/qoaKrm17hP+qhoqubXuE/6qGiq5te4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1178","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1179"}}},"glyph":{"type":"object","name":"Line","id":"p1174","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1175","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1176","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1187","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1181","attributes":{"selected":{"type":"object","name":"Selection","id":"p1182","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1183"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"8pF2pn+e2z/6HZPC3+/bP7KuphS6Vtw/FGu1vOTe3D88C6LqJcLdPwqk8qQ3ZN8/pG2Y0ZCv4D9YVZPp0kXhP8Bj97Sjd+E/Dh6ISQOE4T9Ec/yrEIbhP2oeT9FQhuE/bpw+7VaG4T9unD7tVobhP26cPu1WhuE/bpw+7VaG4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1188","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1189"}}},"glyph":{"type":"object","name":"Line","id":"p1184","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1185","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1186","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1197","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1191","attributes":{"selected":{"type":"object","name":"Selection","id":"p1192","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1193"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"bIKIdXQd3D+wJBOG43TcP4D3kxUY49w/LCkHRIZ73T86uNI0P4jeP/fCOH54KOA/rBRG6DkO4T86ia/OqX7hPzhpKKfBo+E/VcavjHKt4T9Wmci8/67hP+qIuMk5r+E/6oi4yTmv4T/qiLjJOa/hP+qIuMk5r+E/6oi4yTmv4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1198","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1199"}}},"glyph":{"type":"object","name":"Line","id":"p1194","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1195","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1196","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1207","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1201","attributes":{"selected":{"type":"object","name":"Selection","id":"p1202","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1203"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"8WjjiLX45D4tQxzr4jYaP/yp8dJNYlA/exSuR+F6hD+amZmZmZm5PwAAAAAAAPA/AAAAAAAAJEAAAAAAAABZQAAAAAAAQI9AAAAAAACIw0AAAAAAAGr4QAAAAACAhC5BAAAAANASY0EAAAAAhNeXQQAAAABlzc1BAAAAIF+gAkI="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Yh35HA953D+wXIn6S9bcP2SBXDyFTN0/UulP74n63T8oTWH2KjbfP/xKjBaij+A/miRi6TVS4T/7x2vRoKXhP56AJosuwuE/4dahPuPI4T9q51vV48nhP9aUJZkOyuE/L9IdtRTK4T8v0h21FMrhPy/SHbUUyuE/L9IdtRTK4T8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1208","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1209"}}},"glyph":{"type":"object","name":"Line","id":"p1204","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1205","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1206","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1115","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1129"},{"type":"object","name":"WheelZoomTool","id":"p1130","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1131","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1132","attributes":{"syncable":false,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1137"},{"type":"object","name":"ResetTool","id":"p1138"},{"type":"object","name":"HelpTool","id":"p1139"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1124","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1125","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1126"},"axis_label":"$$\\text{P(True) } [ \\% ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1127"}}}],"below":[{"type":"object","name":"LogAxis","id":"p1119","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1120","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1121"},"axis_label":"$$\\text{Prior Q (Pseudo-counts)} [ 10^\\alpha ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1122"}}}],"center":[{"type":"object","name":"Grid","id":"p1123","attributes":{"axis":{"id":"p1119"}}},{"type":"object","name":"Grid","id":"p1128","attributes":{"dimension":1,"axis":{"id":"p1124"}}},{"type":"object","name":"Legend","id":"p1149","attributes":{"location":"bottom_right","items":[{"type":"object","name":"LegendItem","id":"p1150","attributes":{"label":{"type":"value","value":"4 bits"},"renderers":[{"id":"p1146"}]}},{"type":"object","name":"LegendItem","id":"p1160","attributes":{"label":{"type":"value","value":"6 bits"},"renderers":[{"id":"p1157"}]}},{"type":"object","name":"LegendItem","id":"p1170","attributes":{"label":{"type":"value","value":"8 bits"},"renderers":[{"id":"p1167"}]}},{"type":"object","name":"LegendItem","id":"p1180","attributes":{"label":{"type":"value","value":"9 bits"},"renderers":[{"id":"p1177"}]}},{"type":"object","name":"LegendItem","id":"p1190","attributes":{"label":{"type":"value","value":"10 bits"},"renderers":[{"id":"p1187"}]}},{"type":"object","name":"LegendItem","id":"p1200","attributes":{"label":{"type":"value","value":"11 bits"},"renderers":[{"id":"p1197"}]}},{"type":"object","name":"LegendItem","id":"p1210","attributes":{"label":{"type":"value","value":"12 bits"},"renderers":[{"id":"p1207"}]}}]}}]}}]}}]}};
  const render_items = [{"docid":"aca3ecd8-b3ff-474c-94c4-8c04579e5b32","roots":{"p1211":"e56924bf-1130-42ba-9819-2882dd33cf77"},"root_ids":["p1211"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>From the figure above at left, assuming the observations are “exact” yields a larger proportion of empty bins as the dictionary size increases.  This approach yields higher penalties for misaligned distributions by assuming the observation precision increases with the dictionary size.  The figure at right approximates measurement uncertainty by distributing observations between bins in proportion to the assumed measurement error, in this case +/- 10% uniformly distributed.  This approach reduces the influence of the prior since fewer bins are empty and the prior only impacts empty bins in Q.</p>
<p>Decreasing the prior results in larger penalties for <strong>underspecified models</strong>, that is where some <span class="math notranslate nohighlight">\(q_i = 0\)</span>. The shift in the classification balance, that is the pairs that change from True to False as the prior decreases with respect to <span class="math notranslate nohighlight">\(D_{KL}(P||Q) &lt; D_{KL}(P||\mathbb{U})\)</span>, includes catchment pairs where the proxy <span class="math notranslate nohighlight">\(Q\)</span> underspecifies the state frequencies of <span class="math notranslate nohighlight">\(P\)</span>, and the tolerance of underspecification is proportional to the observed (posterior) state frequency.  Increasing the dictionary size preserves more of the original signal precision, and it also gives greater discriminatory power to the prior, as shown by the greater change in y in the plot above.</p>
<p>Next we’ll invert the plot to show how the binary label balance changes as a function of dictionary size (bitrate) for different priors.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">cb_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">brates</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">posterior</span> <span class="ow">in</span> <span class="n">posterior_columns</span><span class="p">:</span>
    <span class="n">balances_whole</span><span class="p">,</span> <span class="n">balances_partial</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">13</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">5</span><span class="p">,</span> <span class="mi">7</span><span class="p">]:</span>
            <span class="k">continue</span>
        
        <span class="n">model_tests_whole</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;whole&#39;</span><span class="p">][</span><span class="n">posterior</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;whole&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_uniform&#39;</span><span class="p">]</span>
        <span class="n">model_tests_partial</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;partial&#39;</span><span class="p">][</span><span class="n">posterior</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="s1">&#39;partial&#39;</span><span class="p">][</span><span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_uniform&#39;</span><span class="p">]</span>
        <span class="n">ut_whole</span><span class="p">,</span> <span class="n">ct_whole</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_tests_whole</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">ut_partial</span><span class="p">,</span> <span class="n">ct_partial</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">model_tests_partial</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">balances_whole</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ct_whole</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_tests_whole</span><span class="p">))</span>
        <span class="n">balances_partial</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">ct_partial</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">model_tests_partial</span><span class="p">))</span>
    <span class="n">cb_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">posterior</span><span class="si">}</span><span class="s1">_partial&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances_partial</span>
    <span class="n">cb_df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">posterior</span><span class="si">}</span><span class="s1">_whole&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">balances_whole</span>
<span class="n">cb_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2</span><span class="o">**</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">]]</span>
<span class="c1"># class_balance_df.index = [10**(int(c.split(&#39;_&#39;)[-1].split(&#39;R&#39;)[0])) for c in posterior_columns]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bal_figs2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">cb</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;whole&#39;</span><span class="p">,</span> <span class="s1">&#39;partial&#39;</span><span class="p">]:</span>
    <span class="n">bal_fig2</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">cb</span><span class="si">}</span><span class="s1"> counts&#39;</span><span class="p">,</span>
                     <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.55</span><span class="p">))</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ccols</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">cb_df</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">cb</span> <span class="ow">in</span> <span class="n">c</span><span class="p">]</span>
    
    <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">ccols</span><span class="p">:</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">c</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="o">-</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;R&#39;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">bal_fig2</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">cb_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">cb_df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="n">Category20</span><span class="p">[</span><span class="mi">20</span><span class="p">][</span><span class="n">n</span><span class="p">],</span> 
                     <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;10^</span><span class="si">{</span><span class="n">a</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">bal_fig2</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Dictionary Size}$$&#39;</span>
    <span class="n">bal_fig2</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{P(True) } [ \% ]$$&#39;</span>
    <span class="n">bal_fig2</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">bal_fig2</span><span class="o">.</span><span class="n">legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">bal_fig2</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;bottom_right&#39;</span>
    <span class="n">bal_figs2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">bal_fig2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bal2_layout</span> <span class="o">=</span> <span class="n">row</span><span class="p">(</span><span class="n">bal_figs2</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">bal2_layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="c87f62af-ea07-4bbd-8a35-fad935f7adcd" data-root-id="p1630" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"2c45d6be-bc93-457e-8bc4-b95137f189bd":{"version":"3.4.1","title":"Bokeh Application","roots":[{"type":"object","name":"Row","id":"p1630","attributes":{"children":[{"type":"object","name":"Figure","id":"p1240","attributes":{"height":450,"x_range":{"type":"object","name":"DataRange1d","id":"p1242"},"y_range":{"type":"object","name":"Range1d","id":"p1250","attributes":{"start":0.25,"end":0.55}},"x_scale":{"type":"object","name":"LogScale","id":"p1251"},"y_scale":{"type":"object","name":"LinearScale","id":"p1252"},"title":{"type":"object","name":"Title","id":"p1243","attributes":{"text":"whole counts"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1280","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1274","attributes":{"selected":{"type":"object","name":"Selection","id":"p1275","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1276"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"5g8JTQwX2T+aHct2aJHYP2pQSoZwZNY/4JGEXvv21D9mLUsnabzSP/iFYt0fcNE/BHHiilMN0T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1281","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1282"}}},"glyph":{"type":"object","name":"Line","id":"p1277","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1278","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1279","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1291","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1285","attributes":{"selected":{"type":"object","name":"Selection","id":"p1286","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1287"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"LjNgWPNJ2T94g7qyCN3YP0qp5Ttu59Y/JLw71XCV1T8IYtYRF4fTP2Ba28RDU9I/8iyIsH/+0T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1292","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1293"}}},"glyph":{"type":"object","name":"Line","id":"p1288","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1289","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1290","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1301","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1295","attributes":{"selected":{"type":"object","name":"Selection","id":"p1296","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1297"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Vst4SvuA2T88FNYE/jzZP5btyhGvidc/xBfW8zhj1j9GWLccfJDUP6As9yAIeNM/YtWvDLhC0z8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1302","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1303"}}},"glyph":{"type":"object","name":"Line","id":"p1298","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1299","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1300","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1311","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1305","attributes":{"selected":{"type":"object","name":"Selection","id":"p1306","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1307"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"QOqP7JzE2T9ksoIB+bDZP565evgkZ9g/7BIT88d11z+shnaBuvPVPyZPDcfAD9U/YlAkRAsS1T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1312","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1313"}}},"glyph":{"type":"object","name":"Line","id":"p1308","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1309","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1310","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1321","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1315","attributes":{"selected":{"type":"object","name":"Selection","id":"p1316","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1317"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"OBR29Nwc2j/4iZeGa0raP2L9VuSzmNk/nsjskoT/2D+UDNu3KgnYP9jxnsXGc9c/gm9m0fjI1z8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1322","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1323"}}},"glyph":{"type":"object","name":"Line","id":"p1318","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1319","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1320","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1331","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1325","attributes":{"selected":{"type":"object","name":"Selection","id":"p1326","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1327"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"hGk46Cie2j+qHNjoQz7bP7KyBgFAgNs/yOjg47R32z8wPzv+6kzbPxRk0wlNJNs/Akw9bLh92z8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1332","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1333"}}},"glyph":{"type":"object","name":"Line","id":"p1328","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1329","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1330","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1341","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1335","attributes":{"selected":{"type":"object","name":"Selection","id":"p1336","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1337"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"ihDkDQ+f2z/yoSeQ9f3cP0DoKnrzb94/7M4KrsD93j8aINhUdmPfP3h8U8hLrN8/xC3HvF303z8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1342","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1343"}}},"glyph":{"type":"object","name":"Line","id":"p1338","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1339","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1340","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1351","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1345","attributes":{"selected":{"type":"object","name":"Selection","id":"p1346","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1347"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"NlZyWC2b3T90cfcTAWHfP9K1vakTd+A/TJDghuK54D9Q0yiNUufgP3aOxxsMC+E//ryCzqkj4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1352","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1353"}}},"glyph":{"type":"object","name":"Line","id":"p1348","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1349","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1350","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1361","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1355","attributes":{"selected":{"type":"object","name":"Selection","id":"p1356","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1357"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"+BKlZ1LM3z/2El2bOXTgP2YUHPvO8OA/FLgm2n8a4T/dKDadTTzhP1Cs6dAnVOE/i+BnH4Nj4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1362","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1363"}}},"glyph":{"type":"object","name":"Line","id":"p1358","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1359","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1360","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1371","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1365","attributes":{"selected":{"type":"object","name":"Selection","id":"p1366","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1367"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"pInEO91d4D/lqV4Q96jgPw898oHqCuE/esW3hIUu4T8cLxXE70zhP9rvCjk5YuE/DQpbKMlt4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1372","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1373"}}},"glyph":{"type":"object","name":"Line","id":"p1368","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1369","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1370","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1381","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1375","attributes":{"selected":{"type":"object","name":"Selection","id":"p1376","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1377"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"SgiIMLtx4D8UBnXKxLDgPzAj5rLjDuE/NB+gRL4x4T/IOeoubk/hP9DoxGoDZOE/llVLlmhv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1382","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1383"}}},"glyph":{"type":"object","name":"Line","id":"p1378","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1379","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1380","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1391","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1385","attributes":{"selected":{"type":"object","name":"Selection","id":"p1386","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1387"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"mHlwVSp04D8sDXFzkbHgP3/jK1J2D+E//mVWTvgx4T+glH22w0/hP+4Qf2Y6ZOE/pWkoFIRv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1392","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1393"}}},"glyph":{"type":"object","name":"Line","id":"p1388","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1389","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1390","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1401","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1395","attributes":{"selected":{"type":"object","name":"Selection","id":"p1396","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1397"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"wFkTpXN04D86IU7xrLHgP9ggJG58D+E/r+BGhgQy4T9SD27uz0/hP0ZOd4JAZOE//qYgMIpv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1402","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1403"}}},"glyph":{"type":"object","name":"Line","id":"p1398","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1399","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1400","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1411","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1405","attributes":{"selected":{"type":"object","name":"Selection","id":"p1406","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1407"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"bHgPs3Z04D86IU7xrLHgP9ggJG58D+E/W/9ClAcy4T9SD27uz0/hP0ZOd4JAZOE//qYgMIpv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1412","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1413"}}},"glyph":{"type":"object","name":"Line","id":"p1408","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1409","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1410","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1421","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1415","attributes":{"selected":{"type":"object","name":"Selection","id":"p1416","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1417"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"bHgPs3Z04D86IU7xrLHgP9ggJG58D+E/W/9ClAcy4T9SD27uz0/hP0ZOd4JAZOE//qYgMIpv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1422","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1423"}}},"glyph":{"type":"object","name":"Line","id":"p1418","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1419","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1420","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1431","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1425","attributes":{"selected":{"type":"object","name":"Selection","id":"p1426","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1427"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"bHgPs3Z04D86IU7xrLHgP9ggJG58D+E/W/9ClAcy4T9SD27uz0/hP5ove3Q9ZOE//qYgMIpv4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1432","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1433"}}},"glyph":{"type":"object","name":"Line","id":"p1428","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1429","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1430","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1249","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1263"},{"type":"object","name":"WheelZoomTool","id":"p1264","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1265","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1266","attributes":{"syncable":false,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1271"},{"type":"object","name":"ResetTool","id":"p1272"},{"type":"object","name":"HelpTool","id":"p1273"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1258","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1259","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1260"},"axis_label":"$$\\text{P(True) } [ \\% ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1261"}}}],"right":[{"type":"object","name":"Legend","id":"p1283","attributes":{"location":"bottom_right","items":[{"type":"object","name":"LegendItem","id":"p1284","attributes":{"label":{"type":"value","value":"10^-5"},"renderers":[{"id":"p1280"}]}},{"type":"object","name":"LegendItem","id":"p1294","attributes":{"label":{"type":"value","value":"10^-4"},"renderers":[{"id":"p1291"}]}},{"type":"object","name":"LegendItem","id":"p1304","attributes":{"label":{"type":"value","value":"10^-3"},"renderers":[{"id":"p1301"}]}},{"type":"object","name":"LegendItem","id":"p1314","attributes":{"label":{"type":"value","value":"10^-2"},"renderers":[{"id":"p1311"}]}},{"type":"object","name":"LegendItem","id":"p1324","attributes":{"label":{"type":"value","value":"10^-1"},"renderers":[{"id":"p1321"}]}},{"type":"object","name":"LegendItem","id":"p1334","attributes":{"label":{"type":"value","value":"10^0"},"renderers":[{"id":"p1331"}]}},{"type":"object","name":"LegendItem","id":"p1344","attributes":{"label":{"type":"value","value":"10^1"},"renderers":[{"id":"p1341"}]}},{"type":"object","name":"LegendItem","id":"p1354","attributes":{"label":{"type":"value","value":"10^2"},"renderers":[{"id":"p1351"}]}},{"type":"object","name":"LegendItem","id":"p1364","attributes":{"label":{"type":"value","value":"10^3"},"renderers":[{"id":"p1361"}]}},{"type":"object","name":"LegendItem","id":"p1374","attributes":{"label":{"type":"value","value":"10^4"},"renderers":[{"id":"p1371"}]}},{"type":"object","name":"LegendItem","id":"p1384","attributes":{"label":{"type":"value","value":"10^5"},"renderers":[{"id":"p1381"}]}},{"type":"object","name":"LegendItem","id":"p1394","attributes":{"label":{"type":"value","value":"10^6"},"renderers":[{"id":"p1391"}]}},{"type":"object","name":"LegendItem","id":"p1404","attributes":{"label":{"type":"value","value":"10^7"},"renderers":[{"id":"p1401"}]}},{"type":"object","name":"LegendItem","id":"p1414","attributes":{"label":{"type":"value","value":"10^8"},"renderers":[{"id":"p1411"}]}},{"type":"object","name":"LegendItem","id":"p1424","attributes":{"label":{"type":"value","value":"10^9"},"renderers":[{"id":"p1421"}]}},{"type":"object","name":"LegendItem","id":"p1434","attributes":{"label":{"type":"value","value":"10^10"},"renderers":[{"id":"p1431"}]}}]}}],"below":[{"type":"object","name":"LogAxis","id":"p1253","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1254","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1255"},"axis_label":"$$\\text{Dictionary Size}$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1256"}}}],"center":[{"type":"object","name":"Grid","id":"p1257","attributes":{"axis":{"id":"p1253"}}},{"type":"object","name":"Grid","id":"p1262","attributes":{"dimension":1,"axis":{"id":"p1258"}}},{"id":"p1283"}]}},{"type":"object","name":"Figure","id":"p1435","attributes":{"height":450,"x_range":{"type":"object","name":"DataRange1d","id":"p1437"},"y_range":{"type":"object","name":"Range1d","id":"p1445","attributes":{"start":0.25,"end":0.55}},"x_scale":{"type":"object","name":"LogScale","id":"p1446"},"y_scale":{"type":"object","name":"LinearScale","id":"p1447"},"title":{"type":"object","name":"Title","id":"p1438","attributes":{"text":"partial counts"}},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1475","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1469","attributes":{"selected":{"type":"object","name":"Selection","id":"p1470","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1471"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"cLM0xTty2T94qN0dzcXZPyy5HaNeu9o/OGpGe8Ev2z/ykXamf57bP2yCiHV0Hdw/Yh35HA953D8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1476","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1477"}}},"glyph":{"type":"object","name":"Line","id":"p1472","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1473","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1474","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1f77b4","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1486","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1480","attributes":{"selected":{"type":"object","name":"Selection","id":"p1481","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1482"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"xI+zNiSd2T8Ox4G8dADaP253cmy/Ats/Rhlk4Jl92z/6HZPC3+/bP7AkE4bjdNw/sFyJ+kvW3D8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1487","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1488"}}},"glyph":{"type":"object","name":"Line","id":"p1483","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1484","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1485","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#aec7e8","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1496","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1490","attributes":{"selected":{"type":"object","name":"Selection","id":"p1491","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1492"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"GM53s8XL2T9AdWS33knaPwyfli+YW9s/qD4yFDnc2z+yrqYUulbcP4D3kxUY49w/ZIFcPIVM3T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1497","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1498"}}},"glyph":{"type":"object","name":"Line","id":"p1493","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1494","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1495","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff7f0e","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1506","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1500","attributes":{"selected":{"type":"object","name":"Selection","id":"p1501","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1502"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Dn+nh04E2j9S8qzn0J3aP/6esMzwyNs/eCg7NAFX3D8Ua7W85N7cPywpB0SGe90/UulP74n63T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1507","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1508"}}},"glyph":{"type":"object","name":"Line","id":"p1503","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1504","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1505","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ffbb78","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1516","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1510","attributes":{"selected":{"type":"object","name":"Selection","id":"p1511","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1512"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"WM2WXrhQ2j8my6xhORTbP9SRCi55aNw/Ov1q7QET3T88C6LqJcLdPzq40jQ/iN4/KE1h9io23z8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1517","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1518"}}},"glyph":{"type":"object","name":"Line","id":"p1513","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1514","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1515","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#2ca02c","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1526","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1520","attributes":{"selected":{"type":"object","name":"Selection","id":"p1521","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1522"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"KrjekG/D2j8gVOja+NrbP+BU7yW1k90/SJ/UuxZ43j8KpPKkN2TfP/fCOH54KOA//EqMFqKP4D8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1527","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1528"}}},"glyph":{"type":"object","name":"Line","id":"p1523","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1524","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1525","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#98df8a","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1536","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1530","attributes":{"selected":{"type":"object","name":"Selection","id":"p1531","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1532"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"NP6DvYu42z/KWnowCGbdPzxQpH9+kN8/9gT6irhD4D+kbZjRkK/gP6wURug5DuE/miRi6TVS4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1537","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1538"}}},"glyph":{"type":"object","name":"Line","id":"p1533","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1534","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1535","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#d62728","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1546","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1540","attributes":{"selected":{"type":"object","name":"Selection","id":"p1541","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1542"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"9rQiwr2s3T90EVsSupLfPzEuL8b7sOA/oFuC2r8F4T9YVZPp0kXhPzqJr86pfuE/+8dr0aCl4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1547","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1548"}}},"glyph":{"type":"object","name":"Line","id":"p1543","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1544","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1545","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#ff9896","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1556","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1550","attributes":{"selected":{"type":"object","name":"Selection","id":"p1551","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1552"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"uugAkg/X3z8kcv88KYHgPy+FK76cEuE/5sQoSE1L4T/AY/e0o3fhPzhpKKfBo+E/noAmiy7C4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1557","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1558"}}},"glyph":{"type":"object","name":"Line","id":"p1553","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1554","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1555","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#9467bd","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1566","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1560","attributes":{"selected":{"type":"object","name":"Selection","id":"p1561","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1562"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"vPIF8GJi4D9zMWsGn7LgP2MhQPlgKeE/zo0PU+lb4T8OHohJA4ThP1XGr4xyreE/4dahPuPI4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1567","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1568"}}},"glyph":{"type":"object","name":"Line","id":"p1563","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1564","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1565","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c5b0d5","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1576","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1570","attributes":{"selected":{"type":"object","name":"Selection","id":"p1571","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1572"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"P+0avwB24D94rrvYS7ngP871GPGlLOE/yB30hVte4T9Ec/yrEIbhP1aZyLz/ruE/audb1ePJ4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1577","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1578"}}},"glyph":{"type":"object","name":"Line","id":"p1573","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1574","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1575","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#8c564b","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1586","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1580","attributes":{"selected":{"type":"object","name":"Selection","id":"p1581","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1582"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"fkomZlR44D9DyPcl/bngPwlGjegTLeE/OSeyc49e4T9qHk/RUIbhP+qIuMk5r+E/1pQlmQ7K4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1587","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1588"}}},"glyph":{"type":"object","name":"Line","id":"p1583","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1584","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1585","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c49c94","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1596","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1590","attributes":{"selected":{"type":"object","name":"Selection","id":"p1591","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1592"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"SJHcb4544D88n/qLErrgPxP+dTwmLeE/PoOmnZhe4T9unD7tVobhP+qIuMk5r+E/L9IdtRTK4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1597","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1598"}}},"glyph":{"type":"object","name":"Line","id":"p1593","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1594","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1595","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#e377c2","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1606","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1600","attributes":{"selected":{"type":"object","name":"Selection","id":"p1601","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1602"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"9K/YfZF44D88n/qLErrgPxP+dTwmLeE/6qGiq5te4T9unD7tVobhP+qIuMk5r+E/L9IdtRTK4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1607","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1608"}}},"glyph":{"type":"object","name":"Line","id":"p1603","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1604","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1605","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#f7b6d2","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1616","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1610","attributes":{"selected":{"type":"object","name":"Selection","id":"p1611","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1612"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"oM7Ui5R44D88n/qLErrgPxP+dTwmLeE/6qGiq5te4T9unD7tVobhP+qIuMk5r+E/L9IdtRTK4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1617","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1618"}}},"glyph":{"type":"object","name":"Line","id":"p1613","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1614","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1615","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7f7f7f","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1626","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1620","attributes":{"selected":{"type":"object","name":"Selection","id":"p1621","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1622"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"EAAAAEAAAAAAAQAAAAIAAAAEAAAACAAAABAAAA=="},"shape":[7],"dtype":"int32","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"oM7Ui5R44D88n/qLErrgPxP+dTwmLeE/6qGiq5te4T9unD7tVobhP+qIuMk5r+E/L9IdtRTK4T8="},"shape":[7],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1627","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1628"}}},"glyph":{"type":"object","name":"Line","id":"p1623","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1624","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1625","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#c7c7c7","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1444","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1458"},{"type":"object","name":"WheelZoomTool","id":"p1459","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1460","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1461","attributes":{"syncable":false,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5}}}},{"type":"object","name":"SaveTool","id":"p1466"},{"type":"object","name":"ResetTool","id":"p1467"},{"type":"object","name":"HelpTool","id":"p1468"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1453","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1454","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1455"},"axis_label":"$$\\text{P(True) } [ \\% ]$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1456"}}}],"right":[{"type":"object","name":"Legend","id":"p1478","attributes":{"location":"bottom_right","items":[{"type":"object","name":"LegendItem","id":"p1479","attributes":{"label":{"type":"value","value":"10^-5"},"renderers":[{"id":"p1475"}]}},{"type":"object","name":"LegendItem","id":"p1489","attributes":{"label":{"type":"value","value":"10^-4"},"renderers":[{"id":"p1486"}]}},{"type":"object","name":"LegendItem","id":"p1499","attributes":{"label":{"type":"value","value":"10^-3"},"renderers":[{"id":"p1496"}]}},{"type":"object","name":"LegendItem","id":"p1509","attributes":{"label":{"type":"value","value":"10^-2"},"renderers":[{"id":"p1506"}]}},{"type":"object","name":"LegendItem","id":"p1519","attributes":{"label":{"type":"value","value":"10^-1"},"renderers":[{"id":"p1516"}]}},{"type":"object","name":"LegendItem","id":"p1529","attributes":{"label":{"type":"value","value":"10^0"},"renderers":[{"id":"p1526"}]}},{"type":"object","name":"LegendItem","id":"p1539","attributes":{"label":{"type":"value","value":"10^1"},"renderers":[{"id":"p1536"}]}},{"type":"object","name":"LegendItem","id":"p1549","attributes":{"label":{"type":"value","value":"10^2"},"renderers":[{"id":"p1546"}]}},{"type":"object","name":"LegendItem","id":"p1559","attributes":{"label":{"type":"value","value":"10^3"},"renderers":[{"id":"p1556"}]}},{"type":"object","name":"LegendItem","id":"p1569","attributes":{"label":{"type":"value","value":"10^4"},"renderers":[{"id":"p1566"}]}},{"type":"object","name":"LegendItem","id":"p1579","attributes":{"label":{"type":"value","value":"10^5"},"renderers":[{"id":"p1576"}]}},{"type":"object","name":"LegendItem","id":"p1589","attributes":{"label":{"type":"value","value":"10^6"},"renderers":[{"id":"p1586"}]}},{"type":"object","name":"LegendItem","id":"p1599","attributes":{"label":{"type":"value","value":"10^7"},"renderers":[{"id":"p1596"}]}},{"type":"object","name":"LegendItem","id":"p1609","attributes":{"label":{"type":"value","value":"10^8"},"renderers":[{"id":"p1606"}]}},{"type":"object","name":"LegendItem","id":"p1619","attributes":{"label":{"type":"value","value":"10^9"},"renderers":[{"id":"p1616"}]}},{"type":"object","name":"LegendItem","id":"p1629","attributes":{"label":{"type":"value","value":"10^10"},"renderers":[{"id":"p1626"}]}}]}}],"below":[{"type":"object","name":"LogAxis","id":"p1448","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1449","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1450"},"axis_label":"$$\\text{Dictionary Size}$$","major_label_policy":{"type":"object","name":"AllLabels","id":"p1451"}}}],"center":[{"type":"object","name":"Grid","id":"p1452","attributes":{"axis":{"id":"p1448"}}},{"type":"object","name":"Grid","id":"p1457","attributes":{"dimension":1,"axis":{"id":"p1453"}}},{"id":"p1478"}]}}]}}]}};
  const render_items = [{"docid":"2c45d6be-bc93-457e-8bc4-b95137f189bd","roots":{"p1630":"c87f62af-ea07-4bbd-8a35-fad935f7adcd"},"root_ids":["p1630"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>Above, the balance of binary classification is affected least with increasing prior assumed on Q regardless of how the observation counts are tallied.  Assuming a uniform distribution on each observation reduces the effect of the dictionary size on the binary classification balance, with a slightly increasing proportion of True (informative) models.</p>
</section>
</section>
<section id="train-test-split">
<h3>Train-Test Split<a class="headerlink" href="#train-test-split" title="Link to this heading">#</a></h3>
<p>The input dataset is pairwise comparisons of just over 1600 (streamflow) monitored catchments, their attributes, and the attribute differences.  After filtering for data concurrency (minimum 1 year, 90% complete) and maximum distance between basin centroids (1000 km) we are left with roughly 600K pairs.  The pairwise setup means that station data appears in more than one row.  As a result, the attributes of stations can end up in both training and test sets if we simply split by randomly assigning rows to training or test sets.  To address this issue we split the set of catchment IDs and generate pairs separately such that no ID appears in both training and test set.  One problem remains, and that is to generate training and test sets with some assurance that the target variable distributions match to some degree.</p>
<p>Next we create training/test splits and visualize how the target variable distributions compare.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">add_attributes</span><span class="p">(</span><span class="n">attr_df</span><span class="p">,</span> <span class="n">df_relations</span><span class="p">,</span> <span class="n">attribute_cols</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adds attributes from the df_attributes to the df_relations based on the &#39;proxy&#39; and &#39;target&#39; columns</span>
<span class="sd">    using map for efficient lookups.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    df_attributes (pd.DataFrame): DataFrame with &#39;id&#39; and attribute columns.</span>
<span class="sd">    df_relations (pd.DataFrame): DataFrame with &#39;proxy&#39; and &#39;target&#39; columns.</span>
<span class="sd">    attribute_cols (list of str): List of attribute columns to add to df_relations.</span>

<span class="sd">    Returns:</span>
<span class="sd">    pd.DataFrame: Updated df_relations with added attribute columns.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create dictionaries for each attribute for quick lookup</span>
    <span class="n">attr_dicts</span> <span class="o">=</span> <span class="p">{</span><span class="n">col</span><span class="p">:</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;official_id&#39;</span><span class="p">)[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">to_dict</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">attribute_cols</span><span class="p">}</span>

    <span class="c1"># Add target attributes</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">attribute_cols</span><span class="p">:</span>
        <span class="n">df_relations</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;target_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_relations</span><span class="p">[</span><span class="s1">&#39;target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">attr_dicts</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

    <span class="c1"># Add proxy attributes</span>
    <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">attribute_cols</span><span class="p">:</span>
        <span class="n">df_relations</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;proxy_</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_relations</span><span class="p">[</span><span class="s1">&#39;proxy&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">attr_dicts</span><span class="p">[</span><span class="n">col</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">df_relations</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>
<span class="kn">from</span> <span class="nn">networkx.algorithms.community</span> <span class="kn">import</span> <span class="n">asyn_fluidc</span>

<span class="k">def</span> <span class="nf">graph_based_kfold</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">proxy_col</span><span class="o">=</span><span class="s1">&#39;proxy&#39;</span><span class="p">,</span> <span class="n">target_col</span><span class="o">=</span><span class="s1">&#39;target&#39;</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Use graph-based partitioning to create k-folds from a dataset representing pairs of locations.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    -----------</span>
<span class="sd">    df : pd.DataFrame</span>
<span class="sd">        The input dataframe containing proxy and target columns representing pairs of locations.</span>
<span class="sd">    proxy_col : str</span>
<span class="sd">        The name of the column representing proxy IDs (locations).</span>
<span class="sd">    target_col : str</span>
<span class="sd">        The name of the column representing target IDs (locations).</span>
<span class="sd">    n_folds : int</span>
<span class="sd">        The number of folds to create.</span>

<span class="sd">    Returns:</span>
<span class="sd">    --------</span>
<span class="sd">    dict</span>
<span class="sd">        A dictionary where the keys are fold numbers and the values are the indices of rows in that fold.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Step 1: Create a graph from the proxy and target pairs</span>
    <span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">Graph</span><span class="p">()</span>
    <span class="n">G</span><span class="o">.</span><span class="n">add_edges_from</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">proxy_col</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]))</span>

    <span class="c1"># Step 2: Use a graph partitioning algorithm to split the graph into n_folds</span>
    
    <span class="n">partitions</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">asyn_fluidc</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="n">random_seed</span><span class="p">))</span>  <span class="c1"># Partition the graph into n_folds using fluid communities</span>
    
    <span class="c1"># Step 3: Assign rows in the dataframe to the fold based on the partition of the graph</span>
    <span class="n">fold_assignments</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">fold_num</span><span class="p">,</span> <span class="n">partition</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">partitions</span><span class="p">):</span>
        <span class="c1"># Assign rows to the fold where both proxy and target IDs are in the same partition</span>
        <span class="n">fold_mask</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">proxy_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span> <span class="o">&amp;</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">(</span><span class="n">partition</span><span class="p">)</span>
        <span class="n">fold_assignments</span><span class="p">[</span><span class="n">fold_num</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">fold_mask</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">fold_assignments</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">check_fold_sizes_and_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fold_assignments</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>
    <span class="n">n_tot</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">fold_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">fold</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fold_assignments</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
        <span class="n">idxs</span> <span class="o">=</span> <span class="n">fold_assignments</span><span class="p">[</span><span class="n">fold</span><span class="p">]</span>
        <span class="n">fold_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">fold_assignments</span><span class="p">[</span><span class="n">fold</span><span class="p">],</span> <span class="p">:]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">fold_vals</span> <span class="o">=</span> <span class="n">fold_df</span><span class="p">[</span><span class="n">target_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">n_tot</span> <span class="o">+=</span> <span class="nb">len</span><span class="p">(</span><span class="n">fold_df</span><span class="p">)</span>        
        <span class="n">fold_mean</span><span class="p">,</span> <span class="n">fold_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">fold_vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">fold_vals</span><span class="p">)</span>
        <span class="n">fold_dict</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span> <span class="nb">len</span><span class="p">(</span><span class="n">fold_df</span><span class="p">),</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span> <span class="n">fold_mean</span><span class="p">,</span> <span class="s1">&#39;std&#39;</span><span class="p">:</span> <span class="n">fold_std</span><span class="p">}</span>
        <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;      fold </span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">fold_df</span><span class="p">)</span><span class="si">}</span><span class="s1"> elements, mean=</span><span class="si">{</span><span class="n">fold_mean</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, std=</span><span class="si">{</span><span class="n">fold_std</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">assert</span> <span class="n">n_tot</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="c1"># there should be fewer samples because we have to cut the graph</span>
    <span class="k">return</span> <span class="n">fold_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">graph_fold_separation_trial</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">seed</span><span class="p">):</span>
    <span class="n">fold_assignments</span> <span class="o">=</span> <span class="n">graph_based_kfold</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">n_folds</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">seed</span><span class="p">)</span>
    <span class="n">fold_dict</span> <span class="o">=</span> <span class="n">check_fold_sizes_and_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fold_assignments</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
    <span class="c1"># Compute a score for this partitioning (based on variance in fold sizes and statistics)</span>
    <span class="n">sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fold_dict</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;size&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fold_dict</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;mean&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
    <span class="n">stds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">fold_dict</span><span class="p">[</span><span class="n">n</span><span class="p">][</span><span class="s1">&#39;std&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="n">fold_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())])</span>
    
    <span class="c1"># Score based on fold size balance and mean/std similarity</span>
    <span class="n">mean_size</span><span class="p">,</span> <span class="n">min_size</span><span class="p">,</span> <span class="n">max_size</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sizes</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sizes</span><span class="p">)</span>
    <span class="n">mean_var</span><span class="p">,</span> <span class="n">min_mean</span><span class="p">,</span> <span class="n">max_mean</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">means</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">means</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">means</span><span class="p">)</span>
    <span class="n">mean_std</span><span class="p">,</span> <span class="n">min_std</span><span class="p">,</span> <span class="n">max_std</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">stds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">stds</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">stds</span><span class="p">)</span>

    <span class="c1"># Compute a weighted score</span>
    <span class="n">weight_size</span><span class="p">,</span> <span class="n">weight_mean</span><span class="p">,</span> <span class="n">weight_std</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">size_var_norm</span> <span class="o">=</span> <span class="n">weight_size</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_size</span> <span class="o">-</span> <span class="n">min_size</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_size</span> <span class="o">-</span> <span class="n">min_size</span><span class="p">)</span> 
    <span class="n">mean_var_norm</span> <span class="o">=</span> <span class="n">weight_mean</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_var</span> <span class="o">-</span> <span class="n">min_mean</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_mean</span> <span class="o">-</span> <span class="n">min_mean</span><span class="p">)</span> 
    <span class="n">std_var_norm</span> <span class="o">=</span> <span class="n">weight_std</span> <span class="o">*</span> <span class="p">(</span><span class="n">mean_std</span> <span class="o">-</span> <span class="n">min_std</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">max_std</span> <span class="o">-</span> <span class="n">min_std</span><span class="p">)</span>
    <span class="n">score</span> <span class="o">=</span> <span class="n">size_var_norm</span> <span class="o">+</span> <span class="n">mean_var_norm</span> <span class="o">+</span> <span class="n">std_var_norm</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;     Score for this trial: </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> (size_var=</span><span class="si">{</span><span class="n">size_var_norm</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, mean_var=</span><span class="si">{</span><span class="n">mean_var_norm</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">, std_var=</span><span class="si">{</span><span class="n">std_var_norm</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">fold_dict</span><span class="p">,</span> <span class="n">score</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">optimize_folds</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">20</span><span class="p">):</span>
    <span class="n">best_fold_dict</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_score</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
    <span class="n">best_seed</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="k">for</span> <span class="n">trial</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n_trials</span><span class="p">):</span>        
        <span class="n">seed</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1e6</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Trial </span><span class="si">{</span><span class="n">trial</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">/</span><span class="si">{</span><span class="n">n_trials</span><span class="si">}</span><span class="s2"> with seed </span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>        
        <span class="n">fold_assignments</span><span class="p">,</span> <span class="n">score</span> <span class="o">=</span> <span class="n">graph_fold_separation_trial</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">seed</span><span class="p">)</span>
        <span class="c1"># Check if this is the best partitioning so far</span>
        <span class="k">if</span> <span class="n">score</span> <span class="o">&lt;</span> <span class="n">best_score</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;New best score = </span><span class="si">{</span><span class="n">score</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> (random seed=</span><span class="si">{</span><span class="n">seed</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
            <span class="n">best_score</span> <span class="o">=</span> <span class="n">score</span>
            <span class="n">best_fold_dict</span> <span class="o">=</span> <span class="n">fold_assignments</span>
            <span class="n">best_seed</span> <span class="o">=</span> <span class="n">seed</span>
    <span class="k">return</span> <span class="n">best_fold_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">predict_KLD_from_attributes</span><span class="p">(</span><span class="n">attr_df</span><span class="p">,</span> <span class="n">target_col_base</span><span class="p">,</span> <span class="n">stations</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span> 
                                <span class="n">loss_function</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">binary_test</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
                               <span class="n">optimize_cv_folds</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">cv_fold_seed</span><span class="o">=</span><span class="mi">42</span><span class="p">):</span>

    <span class="n">counts_key</span> <span class="o">=</span> <span class="s1">&#39;partial&#39;</span>
    <span class="k">if</span> <span class="n">partial_counts</span> <span class="o">==</span> <span class="s2">&quot;False&quot;</span><span class="p">:</span>
        <span class="n">counts_key</span> <span class="o">=</span> <span class="s1">&#39;whole&#39;</span>
    
    <span class="n">all_test_results</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">bitrate</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;bitrate = </span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">input_data_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">input_folder</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
        <span class="n">nrows</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="c1"># df = pd.read_csv(input_data_fpath, nrows=nrows, low_memory=False)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">result_dict</span><span class="p">[</span><span class="n">bitrate</span><span class="p">][</span><span class="n">counts_key</span><span class="p">]</span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">target_col_base</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># reduce the maximum distance separating pairs such that the </span>
        <span class="c1"># graph can be more evenly separated</span>
        <span class="n">max_distance</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># km</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;centroid_distance&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">max_distance</span><span class="p">]</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;  </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span><span class="si">}</span><span class="s1"> pairs remaining after filtering by max distance of </span><span class="si">{</span><span class="n">max_distance</span><span class="si">}</span><span class="s1"> km&#39;</span><span class="p">)</span>
        
        <span class="c1"># add the attributes into the input dataset</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">add_attributes</span><span class="p">(</span><span class="n">attr_df</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">all_attributes</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">binary_test</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
            <span class="c1"># training_stn_cv_sets, test_stn_sets = dpf.train_test_split_by_official_id(holdout_pct, stations, nfolds)</span>
            <span class="c1"># if DKL(P||Q) &lt; DKL(P||U), then the model is a better compressor </span>
            <span class="c1"># of the target signal than a uniform distribution</span>
            <span class="n">df</span><span class="p">[</span><span class="s1">&#39;binary_target&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target_col_base</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_uniform&#39;</span><span class="p">]</span>
            <span class="n">ut</span><span class="p">,</span> <span class="n">ct</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;binary_target&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">return_counts</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">pct_false</span> <span class="o">=</span> <span class="n">ct</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
            <span class="c1"># change target_col to the new binary target</span>
            <span class="n">target_col</span> <span class="o">=</span> <span class="s1">&#39;binary_target&#39;</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The binary target variable balance is </span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="n">pct_false</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">% False and </span><span class="si">{</span><span class="mi">100</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">pct_false</span><span class="p">)</span><span class="si">:</span><span class="s1">.0f</span><span class="si">}</span><span class="s1">% True&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">target_col</span> <span class="o">=</span> <span class="n">target_col_base</span>

        <span class="k">if</span> <span class="n">optimize_cv_folds</span><span class="p">:</span>
            <span class="n">best_fold_dict</span> <span class="o">=</span> <span class="n">optimize_folds</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">n_trials</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fold_assignments</span> <span class="o">=</span> <span class="n">graph_based_kfold</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">random_seed</span><span class="o">=</span><span class="n">cv_fold_seed</span><span class="p">)</span>
            <span class="n">fold_dict</span> <span class="o">=</span> <span class="n">check_fold_sizes_and_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fold_assignments</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>

                   

        <span class="nb">print</span><span class="p">(</span><span class="n">asdf</span><span class="p">)</span>
        <span class="c1"># return fold_assignment</span>
        
    <span class="c1">#     print(fold_assignment)</span>
    <span class="c1">#     print(asdf)</span>
        
    <span class="c1">#     # add attribute groups successively</span>
    <span class="c1">#     for attribute_set, set_name in zip([land_cover, terrain, soil, climate], attribute_set_names):</span>
    <span class="c1">#         print(f&#39;  Processing {set_name} attribute set: {target_col}&#39;)</span>
    <span class="c1">#         input_attributes += attribute_set </span>
                        
    <span class="c1">#         features = dpf.format_features(input_attributes)</span>

    <span class="c1">#         if binary_test == True:</span>
    <span class="c1">#             trial_df, test_df = dpf.run_binary_xgb_trials_custom_CV(</span>
    <span class="c1">#                 bitrate, set_name, features, target_col, df, n_optimization_rounds, </span>
    <span class="c1">#                 nfolds, n_boost_rounds, results_folder, loss=loss_function, eval_metric=&#39;error&#39;</span>
    <span class="c1">#             )</span>
                
    <span class="c1">#             obs, pred = test_df[&#39;actual&#39;].values, test_df[&#39;predicted&#39;].values</span>
    <span class="c1">#             tn, fp, fn, tp = confusion_matrix(obs, pred).ravel()</span>
    <span class="c1">#             test_accuracy = (tp + tn) / (tp + fp + fn + tn) </span>
                
    <span class="c1">#             print(f&#39;   held-out test accuracy: {test_accuracy:.2f}&#39;)</span>
    <span class="c1">#             # store the test set predictions and actuals</span>
    <span class="c1">#             all_test_results[bitrate][set_name] = {</span>
    <span class="c1">#                 &#39;trials&#39;: trial_df, &#39;test_df&#39;: test_df,</span>
    <span class="c1">#                 &#39;test_accuracy&#39;: test_accuracy} </span>
    <span class="c1">#         else:</span>
    <span class="c1">#             trial_df, test_df = dpf.run_xgb_trials_custom_CV(</span>
    <span class="c1">#                 bitrate, set_name, features, target_col, df, n_optimization_rounds, </span>
    <span class="c1">#                 nfolds, n_boost_rounds, results_folder, loss=loss_function</span>
    <span class="c1">#             )</span>
    <span class="c1">#             test_rmse = root_mean_squared_error(test_df[&#39;actual&#39;], test_df[&#39;predicted&#39;])</span>
    <span class="c1">#             test_mae = mean_absolute_error(test_df[&#39;actual&#39;], test_df[&#39;predicted&#39;])</span>

    <span class="c1">#             print(f&#39;   Held-out test rmse: {test_rmse:.2f}, mae: {test_mae:.2f}&#39;)</span>
    <span class="c1">#             print(&#39;&#39;)</span>
    <span class="c1">#             # store the test set predictions and actuals</span>
    <span class="c1">#             all_test_results[bitrate][set_name] = {</span>
    <span class="c1">#                 &#39;trials&#39;: trial_df, &#39;test_df&#39;: test_df,</span>
    <span class="c1">#                 &#39;test_mae&#39;: test_mae, &#39;test_rmse&#39;: test_rmse} </span>
    <span class="c1"># return all_test_results</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss_function</span> <span class="o">=</span> <span class="s1">&#39;reg:absoluteerror&#39;</span>
<span class="n">optimize_cv_folds</span> <span class="o">=</span> <span class="kc">False</span>
<span class="n">cv_fold_seed</span> <span class="o">=</span> <span class="mi">83561</span>
<span class="n">n_trials</span> <span class="o">=</span> <span class="mi">25</span>
<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors_to_test</span><span class="p">:</span>
    <span class="n">target_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_post_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">R&#39;</span>
    <span class="n">test_results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results.npy&#39;</span>
    <span class="k">if</span> <span class="n">partial_counts</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">test_results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results.npy&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results_partial_counts.npy&#39;</span>
    <span class="n">test_results_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">results_folder</span><span class="p">,</span> <span class="n">test_results_fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;processed and loading: &#39;</span><span class="p">,</span> <span class="n">test_results_fname</span><span class="p">)</span>
        <span class="n">all_test_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_test_results</span> <span class="o">=</span> <span class="n">predict_KLD_from_attributes</span><span class="p">(</span>
            <span class="n">attr_df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">station_ids</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span> 
            <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_function</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="n">partial_counts</span><span class="p">,</span>
            <span class="n">optimize_cv_folds</span><span class="o">=</span><span class="n">optimize_cv_folds</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cv_fold_seed</span><span class="o">=</span><span class="n">cv_fold_seed</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">all_test_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>bitrate = 4
  228413 pairs remaining after filtering by max distance of 500 km
      fold 1 has 32044 elements, mean=1.89, std=3.06
      fold 2 has 40189 elements, mean=2.06, std=3.06
      fold 3 has 18675 elements, mean=1.58, std=2.49
      fold 4 has 11968 elements, mean=1.24, std=2.13
      fold 5 has 12742 elements, mean=1.20, std=1.90
{0: {&#39;size&#39;: 32044, &#39;mean&#39;: 1.8853656227476505, &#39;std&#39;: 3.05667743433809}, 1: {&#39;size&#39;: 40189, &#39;mean&#39;: 2.0621906356413513, &#39;std&#39;: 3.057044591993696}, 2: {&#39;size&#39;: 18675, &#39;mean&#39;: 1.578743584577704, &#39;std&#39;: 2.485098701937047}, 3: {&#39;size&#39;: 11968, &#39;mean&#39;: 1.238713749817703, &#39;std&#39;: 2.134464416443258}, 4: {&#39;size&#39;: 12742, &#39;mean&#39;: 1.1978954400570754, &#39;std&#39;: 1.895729332380075}}
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">361</span><span class="p">],</span> <span class="n">line</span> <span class="mi">17</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span>     <span class="n">all_test_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="k">else</span><span class="p">:</span>
<span class="ne">---&gt; </span><span class="mi">17</span>     <span class="n">all_test_results</span> <span class="o">=</span> <span class="n">predict_KLD_from_attributes</span><span class="p">(</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span>         <span class="n">attr_df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">station_ids</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">results_folder</span><span class="p">,</span> 
<span class="g g-Whitespace">     </span><span class="mi">19</span>         <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_function</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="n">partial_counts</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">20</span>         <span class="n">optimize_cv_folds</span><span class="o">=</span><span class="n">optimize_cv_folds</span><span class="p">,</span> <span class="n">n_trials</span><span class="o">=</span><span class="n">n_trials</span><span class="p">,</span> <span class="n">cv_fold_seed</span><span class="o">=</span><span class="n">cv_fold_seed</span><span class="p">,</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span>     <span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span>     <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">all_test_results</span><span class="p">)</span>

<span class="nn">Cell In[360], line 49,</span> in <span class="ni">predict_KLD_from_attributes</span><span class="nt">(attr_df, target_col_base, stations, nfolds, results_folder, loss_function, partial_counts, binary_test, random_seed, optimize_cv_folds, n_trials, cv_fold_seed)</span>
<span class="g g-Whitespace">     </span><span class="mi">44</span>     <span class="n">fold_dict</span> <span class="o">=</span> <span class="n">check_fold_sizes_and_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">fold_assignments</span><span class="p">,</span> <span class="n">target_col</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">46</span> <span class="nb">print</span><span class="p">(</span><span class="n">fold_dict</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">49</span> <span class="nb">print</span><span class="p">(</span><span class="n">asdf</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;asdf&#39; is not defined
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="run-binary-model">
<h2>Run Binary Model<a class="headerlink" href="#run-binary-model" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loss_function</span> <span class="o">=</span> <span class="s1">&#39;binary:hinge&#39;</span>

<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors_to_test</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Starting tests based on 10^</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1"> pseudo-count prior.&#39;</span><span class="p">)</span>
    <span class="n">target_col</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_post_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">R&#39;</span>
    <span class="k">if</span> <span class="n">partial_counts</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">test_results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results_binary.npy&#39;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">test_results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target_col</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results_binary_partial_counts.npy&#39;</span>
    <span class="n">test_results_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">binary_results_folder</span><span class="p">,</span> <span class="n">test_results_fname</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">):</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="n">predict_KLD_from_attributes</span><span class="p">(</span>
            <span class="n">attr_df</span><span class="p">,</span> <span class="n">target_col</span><span class="p">,</span> <span class="n">station_ids</span><span class="p">,</span> <span class="n">nfolds</span><span class="p">,</span> <span class="n">binary_results_folder</span><span class="p">,</span> 
            <span class="n">loss_function</span><span class="o">=</span><span class="n">loss_function</span><span class="p">,</span> <span class="n">binary_test</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="n">partial_counts</span><span class="p">)</span>
        <span class="n">np</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">test_results_fpath</span><span class="p">,</span> <span class="n">all_results</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="run-regression-models">
<h2>Run Regression Models<a class="headerlink" href="#run-regression-models" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">load_result_by_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;dkl_</span><span class="si">{</span><span class="n">concurrent</span><span class="si">}</span><span class="s1">_post_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">R_</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_prior_results.npy&#39;</span>
    <span class="k">if</span> <span class="n">binary</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;_binary.npy&#39;</span><span class="p">)</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">binary_results_folder</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">rf</span> <span class="o">=</span> <span class="n">results_folder</span>
    <span class="k">if</span> <span class="n">partial_counts</span> <span class="o">==</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.npy&#39;</span><span class="p">,</span> <span class="s1">&#39;_partial_counts.npy&#39;</span><span class="p">)</span>
    <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">rf</span><span class="p">,</span> <span class="n">fname</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fpath</span><span class="p">,</span> <span class="n">allow_pickle</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">item</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-results">
<h2>Plot Results<a class="headerlink" href="#plot-results" title="Link to this heading">#</a></h2>
<section id="plot-results-of-binary-classification-test">
<h3>Plot Results of Binary Classification Test<a class="headerlink" href="#plot-results-of-binary-classification-test" title="Link to this heading">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">bin_plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors_to_test</span><span class="p">:</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">load_result_by_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">partial_counts</span><span class="o">=</span><span class="n">partial_counts</span><span class="p">)</span>
    <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;10^</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1"> Prior: Binary Test Results &#39;</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">attribute_set_names</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Accuracy score (tp+tn)/(N)&#39;</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Attribute Group (additive)&#39;</span>
    <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">set_dict</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>        
        <span class="n">y</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_dict</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;test_accuracy&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attribute_set_names</span><span class="p">]</span>
        <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">attribute_set_names</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
            
        <span class="n">fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">bits&#39;</span><span class="p">,</span> 
                 <span class="n">color</span><span class="o">=</span><span class="n">Category20</span><span class="p">[</span><span class="mi">10</span><span class="p">][</span><span class="n">c</span><span class="p">],</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
        
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="n">attribute_set_names</span><span class="p">,</span> <span class="s1">&#39;accuracy&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">})</span>
        <span class="n">c</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">bin_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="mi">0</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">bin_plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="binary-results-discussion">
<h3>Binary Results Discussion<a class="headerlink" href="#binary-results-discussion" title="Link to this heading">#</a></h3>
<p>Without additional context, the above plots might lead us to believe that the prior has very little effect on the accuracy performance of the xgboost model but perhaps a higher prior leads to slightly better performance.  Given the additional context provided by the classification balance, we might identify that the</p>
<p>The equal UAR model is based on mapping “observed” streamflow at one location to another.  The dictionary size and the prior are two key assumptions that affect both the discriminant and loss functions upon which decisions and actions are ultimately based.  The dictionary size controls the precision, or the confidence we have about the “true” value of observations.  A perfect model will not be affected by the dictionary size, since however narrow we make intervals defining states, the model frequencies will equal the posterior (observed frequencies).  By the same token, the choice of prior does not affect the discriminant function of a perfect model since it always predicts observed states.  Our goal is to discriminate between imperfect models, to tune the dials of prior and quantization to bring into focus the true distinction between imperfect models without excessively introducing artifacts arising from incomplete information.  Too small a dictionary filters out real information that the discriminant function would otherwise aim to exploit.  Increasing the dictionary size leads to oversampling and increased sensitivity to outliers.  The choice of prior can also be thought of as controlling contrast between samples in the discriminant function where predicted state frequencies are small compared to the assumed prior.</p>
<p>A low prior increases the penalty for “misaligned” distributions, that is models that yield 0 probability for some observed state(s).  This characteristic is reflected in the class balance of Y as the prior is varied.  ncreasing the dictionary size has a magnifying effect on the loss function as the “alignment” of bins</p>
</section>
</section>
<section id="plot-results-of-d-kl-regression-test">
<h2>Plot Results of <span class="math notranslate nohighlight">\(D_{KL}\)</span> Regression Test<a class="headerlink" href="#plot-results-of-d-kl-regression-test" title="Link to this heading">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">reg_plots_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">res_r2_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors_to_test</span><span class="p">:</span>
    <span class="n">plots</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">load_result_by_prior</span><span class="p">(</span><span class="n">prior</span><span class="p">,</span> <span class="n">binary</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">reg_plots_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">res_r2_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">set_dict</span> <span class="ow">in</span> <span class="n">result</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">test_rmse</span><span class="p">,</span> <span class="n">test_mae</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
        <span class="n">attribute_sets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">set_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
        <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_dict</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;test_rmse&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="p">]</span>
        <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_dict</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;test_mae&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="p">]</span>
        
        <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">attribute_sets</span><span class="p">,</span> <span class="s1">&#39;y1&#39;</span><span class="p">:</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">:</span> <span class="n">y2</span><span class="p">})</span>
        
        <span class="n">title</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> bits (Q(θ|D)∼Dirichlet(α=10^</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">))&#39;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">plots</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">attribute_sets</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="n">title</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">attribute_sets</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">plots</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">y_range</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y1&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;rmse&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y2&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;mae&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Error&#39;</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Attribute Group (additive)&#39;</span>
        
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="n">attribute_sets</span><span class="p">,</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">:</span> <span class="n">y2</span><span class="p">})</span>
        <span class="n">best_rmse_idx</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">best_mae_idx</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
        <span class="n">best_rmse_set</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_rmse_idx</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">]</span>
        <span class="n">best_mae_set</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_mae_idx</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">]</span>
        <span class="n">best_result</span> <span class="o">=</span> <span class="n">set_dict</span><span class="p">[</span><span class="n">best_rmse_set</span><span class="p">][</span><span class="s1">&#39;test_df&#39;</span><span class="p">]</span>
        
        <span class="n">xx</span><span class="p">,</span> <span class="n">yy</span> <span class="o">=</span> <span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">],</span> <span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;predicted&#39;</span><span class="p">]</span>
        <span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">se</span> <span class="o">=</span> <span class="n">linregress</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">)</span>
        
        <span class="c1"># sfig = figure(title=f&#39;Test: {b} bits best model {best_rmse_set} (N={len(best_result)})&#39;, toolbar_location=&#39;above&#39;)</span>
        <span class="n">sfig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> bits&#39;</span><span class="p">,</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="s1">&#39;above&#39;</span><span class="p">)</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">xx</span><span class="p">,</span> <span class="n">yy</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>
        <span class="n">xpred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">xx</span><span class="p">),</span> <span class="mi">100</span><span class="p">)</span>
        <span class="n">ybf</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span> <span class="o">*</span> <span class="n">e</span> <span class="o">+</span> <span class="n">intercept</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">xpred</span><span class="p">]</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">xpred</span><span class="p">,</span> <span class="n">ybf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;R²=</span><span class="si">{</span><span class="n">r</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>   
        <span class="c1"># plot a 1:1 line</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">line</span><span class="p">([</span><span class="nb">min</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">yy</span><span class="p">)],</span> <span class="p">[</span><span class="nb">min</span><span class="p">(</span><span class="n">yy</span><span class="p">),</span> <span class="nb">max</span><span class="p">(</span><span class="n">yy</span><span class="p">)],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> 
                  <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;1:1&#39;</span><span class="p">)</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Actual $$D_</span><span class="si">{KL}</span><span class="s1">$$ [bits/sample]&#39;</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;Predicted $$D_</span><span class="si">{KL}</span><span class="s1">$$ [bits/sample]&#39;</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
        <span class="n">sfig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span>
        <span class="n">reg_plots_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">sfig</span>
        <span class="n">res_r2_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="n">r</span><span class="o">**</span><span class="mi">2</span>
        <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>
        <span class="n">plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sfig</span><span class="p">)</span>
    <span class="n">layout_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">350</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">layout_dict</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show(layout_dict[-1])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show(layout_dict[0])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show(layout_dict[1])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show(layout_dict[2])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">prior</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">12</span><span class="p">]:</span>
    <span class="n">plot</span> <span class="o">=</span> <span class="n">reg_plots_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">][</span><span class="n">b</span><span class="p">]</span>
    <span class="n">sample_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sample_layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">sample_plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">250</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">250</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">sample_layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.transform</span> <span class="kn">import</span> <span class="n">linear_cmap</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColorBar</span><span class="p">,</span> <span class="n">ColumnDataSource</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Viridis256</span><span class="p">,</span> <span class="n">gray</span><span class="p">,</span> <span class="n">magma</span><span class="p">,</span> <span class="n">Category20</span>

<span class="c1"># Convert the nested dict into a DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">res_r2_dict</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>  <span class="c1"># Transpose to get priors as columns</span>
<span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Prior&#39;</span>
<span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Bitrate&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Melt the DataFrame to a long format</span>
<span class="n">df_melted</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">melt</span><span class="p">(</span><span class="n">id_vars</span><span class="o">=</span><span class="s1">&#39;Prior&#39;</span><span class="p">,</span> <span class="n">var_name</span><span class="o">=</span><span class="s1">&#39;Bitrate&#39;</span><span class="p">,</span> <span class="n">value_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">)</span>
<span class="c1"># Ensure the Bitrate values are ordered correctly (increasing order)</span>
<span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Bitrate&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Categorical</span><span class="p">(</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Bitrate&#39;</span><span class="p">],</span> <span class="n">categories</span><span class="o">=</span><span class="nb">sorted</span><span class="p">(</span><span class="n">df_melted</span><span class="p">[</span><span class="s1">&#39;Bitrate&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">(),</span> <span class="n">reverse</span><span class="o">=</span><span class="kc">False</span><span class="p">),</span> <span class="n">ordered</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Create a Bokeh ColumnDataSource</span>
<span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">df_melted</span><span class="p">)</span>

<span class="c1"># Create a figure for the heatmap</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;KL divergence from attributes: R² of test set by Prior and Bitrate&quot;</span><span class="p">,</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
           <span class="n">tools</span><span class="o">=</span><span class="s2">&quot;hover&quot;</span><span class="p">,</span> <span class="n">tooltips</span><span class="o">=</span><span class="p">[(</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="s1">&#39;@Value&#39;</span><span class="p">)],</span> <span class="n">toolbar_location</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>

<span class="c1"># Create a color mapper</span>
<span class="n">mapper</span> <span class="o">=</span> <span class="n">linear_cmap</span><span class="p">(</span><span class="n">field_name</span><span class="o">=</span><span class="s1">&#39;Value&#39;</span><span class="p">,</span> <span class="n">palette</span><span class="o">=</span><span class="n">magma</span><span class="p">(</span><span class="mi">256</span><span class="p">),</span> <span class="n">low</span><span class="o">=</span><span class="n">df_melted</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">high</span><span class="o">=</span><span class="n">df_melted</span><span class="o">.</span><span class="n">Value</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

<span class="c1"># Add rectangles to the plot</span>
<span class="n">p</span><span class="o">.</span><span class="n">rect</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s2">&quot;Prior&quot;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s2">&quot;Bitrate&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span>
       <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">mapper</span><span class="p">)</span>

<span class="c1"># Add color bar</span>
<span class="n">color_bar</span> <span class="o">=</span> <span class="n">ColorBar</span><span class="p">(</span><span class="n">color_mapper</span><span class="o">=</span><span class="n">mapper</span><span class="p">[</span><span class="s1">&#39;transform&#39;</span><span class="p">],</span> <span class="n">width</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">))</span>
<span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">color_bar</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>

<span class="c1"># Format plot</span>
<span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">axis_line_color</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_tick_line_color</span> <span class="o">=</span> <span class="kc">None</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$Q(θ|D)∼\text</span><span class="si">{Dirichlet}</span><span class="s1">(\alpha = 10^</span><span class="si">{a}</span><span class="s1">)$$&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Quantization Bitrate (dictionary size)}$$&#39;</span>
<span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_text_font_size</span> <span class="o">=</span> <span class="s2">&quot;10pt&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">axis</span><span class="o">.</span><span class="n">major_label_standoff</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">major_label_orientation</span> <span class="o">=</span> <span class="mf">1.0</span>

<span class="c1"># Output the plot to an HTML file and display it</span>
<span class="c1"># output_file(&quot;heatmap.html&quot;)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="discussion">
<h2>Discussion<a class="headerlink" href="#discussion" title="Link to this heading">#</a></h2>
<p>Since KL divergence <span class="math notranslate nohighlight">\(D_{KL}(P||Q) = \sum_{i=1}^{2^b} p_i\log(\frac{p_i}{q_i}) = +\infty \text{ when any } q_i \rightarrow 0\)</span>, the simulated <span class="math notranslate nohighlight">\(Q\)</span> is treated as a posterior distribution by assuming a uniform (Dirichlet) prior <span class="math notranslate nohighlight">\(\alpha = [a_1, \dots, a_n]\)</span>. The prior <span class="math notranslate nohighlight">\(\alpha\)</span> is an additive array of uniform pseudo-counts used to address the (commonly occurring) case where <span class="math notranslate nohighlight">\(q_i = 0\)</span>, that is the model does not predict an observed state <span class="math notranslate nohighlight">\(i\)</span>.  In this experiment we tested a wide range of priors on an exponential scale, <span class="math notranslate nohighlight">\(\alpha = 10^a, a \in [-2, -1, 0, 1, 2]\)</span>.</p>
<p>The scale of the pseudo-count can be interpreted as a strength of belief in the model. Small <span class="math notranslate nohighlight">\(a\)</span> represents strong belief that the model produces a distribution <span class="math notranslate nohighlight">\(Q\)</span> that is representative of the “true” (observed posterior) distribution <span class="math notranslate nohighlight">\(P\)</span>, and for a fixed <span class="math notranslate nohighlight">\(p_i\)</span> the effect of a decreasing <span class="math notranslate nohighlight">\(a\)</span> on the discriminant function <span class="math notranslate nohighlight">\(D_{KL}\)</span> yields a stronger penalty for a model that predicts an observed state with 0 probability.  Loss functions penalize overconfidence in incorrect predictions, and a prediction of 0 probability of a state which is actually observed should perhaps be thought of as confidence in an incorrect prediction and penalized as such.  A large <span class="math notranslate nohighlight">\(a\)</span> represents weak belief that the model produces a distribution <span class="math notranslate nohighlight">\(Q\)</span> that is representative of <span class="math notranslate nohighlight">\(P\)</span>, since <span class="math notranslate nohighlight">\(Q\)</span> approaches the uniform distribution <span class="math notranslate nohighlight">\(\mathbb{U}\)</span> as <span class="math notranslate nohighlight">\(a\)</span> increases.</p>
<p>Adding pseudo-counts has the effect of diluting the signal for the gradient boosting model to exploit in minimizing prediction error.  Analogously, varying the bitrate, or the size of the dictionary used to quantize continuous streamflow into discrete states, also adds quantization noise since the original streamflow signals are stored in three decimal precision and they are quantized into as few as 4 bits (16 symbol dictionary) and as many as 12 bits (4096 symbol dictionary).  The range of dictionary sizes is set to cover the expected range of rating curve uncertainty, which is generally considered multiplicative and expressed as a % of the observed value.</p>
<p>As shown by the results, priors representing the addition of <span class="math notranslate nohighlight">\(10^1 \text{ to } 10^2\)</span> pseudo-counts diminishes the performance of the gradient boosted decision tree model, regardless of the dictionary size, or the number of possible values provided by the quantization.  Heavily penalizing unpredicted states does not have as great an impact as anticipated, perhaps as a result of the corresponding <span class="math notranslate nohighlight">\(p_i\)</span> values also being small.</p>
<p>How do the prior and the birate affect the distribution of “actual” <span class="math notranslate nohighlight">\(D_{KL}\)</span>?.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dfig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;$$D_{\text</span><span class="si">{KL}</span><span class="s2">}(\text</span><span class="si">{bitrate}</span><span class="s2">)$$&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">order_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">b</span><span class="p">,</span> <span class="n">set_dict</span> <span class="ow">in</span> <span class="n">all_test_results</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="n">test_rmse</span><span class="p">,</span> <span class="n">test_mae</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
    <span class="n">attribute_sets</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">set_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    
    <span class="n">y1</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_dict</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;test_rmse&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="p">]</span>
    <span class="n">y2</span> <span class="o">=</span> <span class="p">[</span><span class="n">set_dict</span><span class="p">[</span><span class="n">e</span><span class="p">][</span><span class="s1">&#39;test_mae&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attribute_sets</span><span class="p">]</span>

    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;set&#39;</span><span class="p">:</span> <span class="n">attribute_sets</span><span class="p">,</span> <span class="s1">&#39;rmse&#39;</span><span class="p">:</span> <span class="n">y1</span><span class="p">,</span> <span class="s1">&#39;mae&#39;</span><span class="p">:</span> <span class="n">y2</span><span class="p">})</span>
    <span class="n">best_rmse_idx</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;rmse&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
    <span class="n">best_mae_idx</span> <span class="o">=</span> <span class="n">result_df</span><span class="p">[</span><span class="s1">&#39;mae&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmin</span><span class="p">()</span>
    <span class="n">best_rmse_set</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_rmse_idx</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">]</span>
    <span class="n">best_mae_set</span> <span class="o">=</span> <span class="n">result_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">best_mae_idx</span><span class="p">,</span> <span class="s1">&#39;set&#39;</span><span class="p">]</span>
    <span class="n">best_result</span> <span class="o">=</span> <span class="n">set_dict</span><span class="p">[</span><span class="n">best_rmse_set</span><span class="p">][</span><span class="s1">&#39;test_df&#39;</span><span class="p">]</span>
    
    <span class="n">best_result</span> <span class="o">=</span> <span class="n">set_dict</span><span class="p">[</span><span class="n">best_rmse_set</span><span class="p">][</span><span class="s1">&#39;test_df&#39;</span><span class="p">]</span>    

    <span class="c1"># print(b, best_result[&#39;actual&#39;].min())</span>
    <span class="c1"># xx, yy = best_result[&#39;actual&#39;], best_result[&#39;predicted&#39;]</span>
    <span class="c1"># xx = best_result[&#39;actual&#39;]</span>
    <span class="c1"># slope, intercept, r, p, se = linregress(xx, yy)</span>

    <span class="c1"># compute empirical cdf of &quot;Actual&quot; TVD</span>
    <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">best_result</span><span class="p">[</span><span class="s1">&#39;actual&#39;</span><span class="p">])</span>
    <span class="c1"># Calculate the CDF values</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
    <span class="n">dfig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">cdf_values</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Vibrant7</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> 
              <span class="n">line_width</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="n">dfig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span><span class="s1">&#39;bottom_right&#39;</span>
<span class="n">dfig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$D_{\text</span><span class="si">{KL}</span><span class="s1">} [\text</span><span class="si">{bits}</span><span class="s1">/\text</span><span class="si">{sample}</span><span class="s1">]$$&#39;</span>
<span class="n">dfig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Pr}</span><span class="s1">(D_{\text</span><span class="si">{KL}</span><span class="s1">})$$&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">show</span><span class="p">(</span><span class="n">dfig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="citations">
<h2>Citations<a class="headerlink" href="#citations" title="Link to this heading">#</a></h2>
<span class="target" id="id2"></span></section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks/ss"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#introduction">Introduction</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#problem-formulation">Problem Formulation</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-prediction-problem">Binary Prediction Problem</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#regression-problem">Regression Problem</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#data-import-and-model-setup">Data Import and Model Setup</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#load-pairwise-attribute-comparisons">Load pairwise attribute comparisons</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#define-attribute-groupings">Define attribute groupings</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#set-trial-parameters">Set trial parameters</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#check-the-binary-classification-balance">Check the binary classification balance</a><ul class="nav section-nav flex-column">
<li class="toc-h4 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-target-column-binary-class-balances-by-bitrate">Compute the target column binary class balances by bitrate</a></li>
</ul>
</li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#train-test-split">Train-Test Split</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-binary-model">Run Binary Model</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#run-regression-models">Run Regression Models</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results">Plot Results</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results-of-binary-classification-test">Plot Results of Binary Classification Test</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#binary-results-discussion">Binary Results Discussion</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#plot-results-of-d-kl-regression-test">Plot Results of <span class="math notranslate nohighlight">\(D_{KL}\)</span> Regression Test</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#discussion">Discussion</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>
  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dan Kovacek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>