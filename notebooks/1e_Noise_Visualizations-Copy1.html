
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Streamflow observation as a model of streamflow observation &#8212; On the predictability of f-divergence measures from catchment attributes</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.0/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'notebooks/1e_Noise_Visualizations-Copy1';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../intro.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.png" class="logo__image only-light" alt="On the predictability of f-divergence measures from catchment attributes - Home"/>
    <script>document.write(`<img src="../_static/logo.png" class="logo__image only-dark" alt="On the predictability of f-divergence measures from catchment attributes - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../intro.html">
                    Introduction
                </a>
            </li>
        </ul>
        <ul class="nav bd-sidenav">
<li class="toctree-l1 has-children"><a class="reference internal" href="1_data.html">Data</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="1a_Update_Catchment_Bounds.html">Update HYSETS Catchment Polygons</a></li>
<li class="toctree-l2"><a class="reference internal" href="1b_Update_Catchment_Attributes.html">Update HYSETS Catchment Attributes</a></li>
<li class="toctree-l2"><a class="reference internal" href="1c_Process_Target_Variables.html">Process Target Variables</a></li>
<li class="toctree-l2"><a class="reference internal" href="1d_Fit_Continuous_Distributions.html">Fit Continuous Distributions</a></li>
</ul>
</details></li>
<li class="toctree-l1 has-children"><a class="reference internal" href="2_Methods.html">Methods</a><details><summary><span class="toctree-toggle" role="presentation"><i class="fa-solid fa-chevron-down"></i></span></summary><ul>
<li class="toctree-l2"><a class="reference internal" href="2a_Predictability_of_Mean_Runoff.html">Predict Mean Runoff</a></li>
<li class="toctree-l2"><a class="reference internal" href="2b_Predictability_of_entropy.html">Predict (Shannon) Entropy</a></li>
<li class="toctree-l2"><a class="reference internal" href="2c_Predictability_of_KL_divergence.html">Predict Kullback-Leibler (KL) Divergence</a></li>
<li class="toctree-l2"><a class="reference internal" href="2d_Predictability_of_TVD.html">Predict Total Variation Distance (TVD)</a></li>
<li class="toctree-l2"><a class="reference internal" href="2e_Predictability_of_EMD.html">Predict Earth Mover’s Distance (EMD)</a></li>
</ul>
</details></li>
<li class="toctree-l1"><a class="reference internal" href="Discussion.html">Discussion</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/dankovacek/divergence_measures" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/dankovacek/divergence_measures/issues/new?title=Issue%20on%20page%20%2Fnotebooks/1e_Noise_Visualizations-Copy1.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/notebooks/1e_Noise_Visualizations-Copy1.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Streamflow observation as a model of streamflow observation</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Streamflow observation as a model of streamflow observation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-runoff-variability">Characterizing Runoff Variability</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-encoding">Optimal Encoding</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#probabilistic-representations-of-observed-sequences">Probabilistic Representations of Observed Sequences</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivating-example">Motivating Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#epistemic-noise">Epistemic Noise</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-probability-distributions">Comparing Probability Distributions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#target-proxy-range-binning">Target/Proxy Range Binning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-based-binning">Application-based Binning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-uncertainty-binning">Maximum Uncertainty Binning</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-noise-added-by-quantization-and-the-prior-assumption">Visualize the Noise added by Quantization and the Prior Assumption</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#good-bad-2">{good, bad}^2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-underspecification-assuming-a-prior-on-q">Dealing with Underspecification: Assuming a Prior on Q</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quantization-noise">Quantization Noise</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantization-noise-and-representation-bias">Quantization Noise and Representation Bias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#formalize-the-problem-statement">Formalize the problem statement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-noise-added-to-a-discriminant-value-due-to-assuming-an-error-distribution-as-a-prior">Compute the noise added to a discriminant value due to assuming an error distribution as a prior</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pairwise-processing">Pairwise Processing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">time</span>
<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">entropy</span>
<span class="kn">import</span> <span class="nn">multiprocessing</span> <span class="k">as</span> <span class="nn">mp</span>
<span class="kn">import</span> <span class="nn">data_processing_functions</span> <span class="k">as</span> <span class="nn">dpf</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">geopandas</span> <span class="k">as</span> <span class="nn">gpd</span>

<span class="c1"># visualize the catchment centroid locations</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">export_png</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">LinearAxis</span><span class="p">,</span> <span class="n">Range1d</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Colorblind</span><span class="p">,</span> <span class="n">Sunset10</span>
<span class="n">output_notebook</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">scipy.stats</span> <span class="kn">import</span> <span class="n">lognorm</span><span class="p">,</span> <span class="n">expon</span><span class="p">,</span> <span class="n">kappa4</span><span class="p">,</span> <span class="n">gaussian_kde</span>
<span class="kn">from</span> <span class="nn">scipy.special</span> <span class="kn">import</span> <span class="n">kl_div</span><span class="p">,</span> <span class="n">gammaln</span>
<span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="kn">import</span> <span class="nn">jax</span>
<span class="kn">import</span> <span class="nn">jax.numpy</span> <span class="k">as</span> <span class="nn">jnp</span>
<span class="kn">from</span> <span class="nn">jax.scipy.stats</span> <span class="kn">import</span> <span class="n">gaussian_kde</span> <span class="k">as</span> <span class="n">jkde</span>

<span class="n">BASE_DIR</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">    <style>
        .bk-notebook-logo {
            display: block;
            width: 20px;
            height: 20px;
            background-image: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAABHNCSVQICAgIfAhkiAAAAAlwSFlzAAALEgAACxIB0t1+/AAAABx0RVh0U29mdHdhcmUAQWRvYmUgRmlyZXdvcmtzIENTNui8sowAAAOkSURBVDiNjZRtaJVlGMd/1/08zzln5zjP1LWcU9N0NkN8m2CYjpgQYQXqSs0I84OLIC0hkEKoPtiH3gmKoiJDU7QpLgoLjLIQCpEsNJ1vqUOdO7ppbuec5+V+rj4ctwzd8IIbbi6u+8f1539dt3A78eXC7QizUF7gyV1fD1Yqg4JWz84yffhm0qkFqBogB9rM8tZdtwVsPUhWhGcFJngGeWrPzHm5oaMmkfEg1usvLFyc8jLRqDOMru7AyC8saQr7GG7f5fvDeH7Ej8CM66nIF+8yngt6HWaKh7k49Soy9nXurCi1o3qUbS3zWfrYeQDTB/Qj6kX6Ybhw4B+bOYoLKCC9H3Nu/leUTZ1JdRWkkn2ldcCamzrcf47KKXdAJllSlxAOkRgyHsGC/zRday5Qld9DyoM4/q/rUoy/CXh3jzOu3bHUVZeU+DEn8FInkPBFlu3+nW3Nw0mk6vCDiWg8CeJaxEwuHS3+z5RgY+YBR6V1Z1nxSOfoaPa4LASWxxdNp+VWTk7+4vzaou8v8PN+xo+KY2xsw6une2frhw05CTYOmQvsEhjhWjn0bmXPjpE1+kplmmkP3suftwTubK9Vq22qKmrBhpY4jvd5afdRA3wGjFAgcnTK2s4hY0/GPNIb0nErGMCRxWOOX64Z8RAC4oCXdklmEvcL8o0BfkNK4lUg9HTl+oPlQxdNo3Mg4Nv175e/1LDGzZen30MEjRUtmXSfiTVu1kK8W4txyV6BMKlbgk3lMwYCiusNy9fVfvvwMxv8Ynl6vxoByANLTWplvuj/nF9m2+PDtt1eiHPBr1oIfhCChQMBw6Aw0UulqTKZdfVvfG7VcfIqLG9bcldL/+pdWTLxLUy8Qq38heUIjh4XlzZxzQm19lLFlr8vdQ97rjZVOLf8nclzckbcD4wxXMidpX30sFd37Fv/GtwwhzhxGVAprjbg0gCAEeIgwCZyTV2Z1REEW8O4py0wsjeloKoMr6iCY6dP92H6Vw/oTyICIthibxjm/DfN9lVz8IqtqKYLUXfoKVMVQVVJOElGjrnnUt9T9wbgp8AyYKaGlqingHZU/uG2NTZSVqwHQTWkx9hxjkpWDaCg6Ckj5qebgBVbT3V3NNXMSiWSDdGV3hrtzla7J+duwPOToIg42ChPQOQjspnSlp1V+Gjdged7+8UN5CRAV7a5EdFNwCjEaBR27b3W890TE7g24NAP/mMDXRWrGoFPQI9ls/MWO2dWFAar/xcOIImbbpA3zgAAAABJRU5ErkJggg==);
        }
    </style>
    <div>
        <a href="https://bokeh.org" target="_blank" class="bk-notebook-logo"></a>
        <span id="cda00be1-78ed-4c46-ad24-f2019f2debb9">Loading BokehJS ...</span>
    </div>
</div><script type="application/javascript">'use strict';
(function(root) {
  function now() {
    return new Date();
  }

  const force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

const JS_MIME_TYPE = 'application/javascript';
  const HTML_MIME_TYPE = 'text/html';
  const EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  const CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    const script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    function drop(id) {
      const view = Bokeh.index.get_by_id(id)
      if (view != null) {
        view.model.document.clear()
        Bokeh.index.delete(view)
      }
    }

    const cell = handle.cell;

    const id = cell.output_area._bokeh_element_id;
    const server_id = cell.output_area._bokeh_server_id;

    // Clean up Bokeh references
    if (id != null) {
      drop(id)
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      const cmd_clean = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd_clean, {
        iopub: {
          output: function(msg) {
            const id = msg.content.text.trim()
            drop(id)
          }
        }
      });
      // Destroy server and session
      const cmd_destroy = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd_destroy);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    const output_area = handle.output_area;
    const output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!Object.prototype.hasOwnProperty.call(output.data, EXEC_MIME_TYPE))) {
      return
    }

    const toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      const bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      const script_attrs = bk_div.children[0].attributes;
      for (let i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      const toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      const props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    const events = require('base/js/events');
    const OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  const NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded(error = null) {
    const el = document.getElementById("cda00be1-78ed-4c46-ad24-f2019f2debb9");
    if (el != null) {
      const html = (() => {
        if (typeof root.Bokeh === "undefined") {
          if (error == null) {
            return "BokehJS is loading ...";
          } else {
            return "BokehJS failed to load.";
          }
        } else {
          const prefix = `BokehJS ${root.Bokeh.version}`;
          if (error == null) {
            return `${prefix} successfully loaded.`;
          } else {
            return `${prefix} <b>encountered errors</b> while loading and may not function as expected.`;
          }
        }
      })();
      el.innerHTML = html;

      if (error != null) {
        const wrapper = document.createElement("div");
        wrapper.style.overflow = "auto";
        wrapper.style.height = "5em";
        wrapper.style.resize = "vertical";
        const content = document.createElement("div");
        content.style.fontFamily = "monospace";
        content.style.whiteSpace = "pre-wrap";
        content.style.backgroundColor = "rgb(255, 221, 221)";
        content.textContent = error.stack ?? error.toString();
        wrapper.append(content);
        el.append(wrapper);
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(() => display_loaded(error), 100);
    }
  }

  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error(url) {
      console.error("failed to load " + url);
    }

    for (let i = 0; i < css_urls.length; i++) {
      const url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    for (let i = 0; i < js_urls.length; i++) {
      const url = js_urls[i];
      const element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error.bind(null, url);
      element.async = false;
      element.src = url;
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  const js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.6.0.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-mathjax-3.6.0.min.js"];
  const css_urls = [];

  const inline_js = [    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
function(Bokeh) {
    }
  ];

  function run_inline_js() {
    if (root.Bokeh !== undefined || force === true) {
      try {
            for (let i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }

      } catch (error) {display_loaded(error);throw error;
      }if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      const cell = $(document.getElementById("cda00be1-78ed-4c46-ad24-f2019f2debb9")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }
  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script></div>
</div>
<section id="streamflow-observation-as-a-model-of-streamflow-observation">
<h1>Streamflow observation as a model of streamflow observation<a class="headerlink" href="#streamflow-observation-as-a-model-of-streamflow-observation" title="Link to this heading">#</a></h1>
<p>The streamflow monitoring network is a set of “models” of streamflow at a specific set of locations.  The rating curve equation <em>compresses</em> streamflow observations at monitoring stations since only the (three) parameters defining the power law relationship are needed to know the flow for any water level.  Let <span class="math notranslate nohighlight">\(X_m\)</span> represent streamflow at a monitored location.</p>
<p>Streamflow records at monitored locations also contain predictive information about streamflow in ungauged basins (PUB).  “Predictive” can mean “the ungauged catchment will generate runoff as a function of the observed catchment runoff <span class="math notranslate nohighlight">\(f(X_m)\)</span>” or it can mean “the overall basin response to precipitation is a function of the observed catchment response <span class="math notranslate nohighlight">\(g(\text{Pr}(X=x))\)</span>”.</p>
<p>The overarching motivating question asks “<em>how well does a monitoring network represent a region <strong>overall</strong>?</em>”, so the latter interpretation of prediction is the focus here.  In other words, what arrangement of monitoring stations provides the closest representation of an unmonitored region <em>overall</em> in terms of long-term behaviour.  This question doesn’t solve the problem of predicting timing and magnitude of all ungauged locations, but it corresponds to the objective of covering the range of basin response “shapes” for the ungauged region, which may not be reflected in the existing network.</p>
<p>The expected shape of an unobserved catchment is not directly, instead the divergence from another distribution is estimated based on a very large sample of distribution comparisions using catchment attributes of both catchments as predictors.  In other words, the physical descriptors of catchments are used to predict how different the distributions are expected to be.</p>
</section>
<section id="characterizing-runoff-variability">
<h1>Characterizing Runoff Variability<a class="headerlink" href="#characterizing-runoff-variability" title="Link to this heading">#</a></h1>
<p>In hydrology, the overall basin response to precipitation is described by the flow duration curve (FDC), which is a non-parametric representation of runoff that expresses the percentage of time that a certain flow rate is equaled or exceeded over some period.  A probability density function (PDF) describes the underlying probability density that the FDC is derived from, which emphasizes the frequency that certain ranges of flows are expected to occur.  The PDF captures the overall runoff behaviour in a catchment, reflecting how the system of storages and flux controls shape the hydrological response.</p>
<p>To evaluate how well the monitoring network reflects the runoff behaviour of a region <em>overall</em>, we compare PDFs between many different locations and quantify the differences in a pairwise manner.  The difference or divergence between two probability distributions is quantified by the Kullback-Liebler (KL) divergence, defined as the “extra description length” when using an approximate distribution <span class="math notranslate nohighlight">\(Q\)</span> to represent the “ground truth” distribution <span class="math notranslate nohighlight">\(P\)</span>.  In this definition, the approximation <span class="math notranslate nohighlight">\(Q\)</span> is the distribution generated by a rainfall-runoff or regional transfer model that simulates <span class="math notranslate nohighlight">\(P\)</span>.</p>
<p>Defining differences between PDFs in terms of “extra description length” reflects a fundamental link between prediction and compression.  If the process that generates <span class="math notranslate nohighlight">\(P\)</span> can be defined by its physics or by some relationship with a related observable variable, then direct observation of runoff is not required.  Instead, a <em>compressed</em> representation of the process can be stored in the form of a governing equation, or an encoding that minimizes the amound of computer disk space needed to store the sequence of bits and the instructions needed to decode these exactly into the original observations.</p>
</section>
<section id="optimal-encoding">
<h1>Optimal Encoding<a class="headerlink" href="#optimal-encoding" title="Link to this heading">#</a></h1>
<blockquote>
<div><p><em>It’s all a story of the interplay between underlying computational irreducibility and our nature as computationally bounded observers.</em> -Stephen Wolfram (from The Second Law)</p>
</div></blockquote>
<p>Streamflow observations (and environmental signals generally) are observed, stored, and operated on computationally, and in computer systems data are fundamentally bound by nested layers of encoding to allow computers to handle a range of data types optimally for storage and computational operations.  One encoding might use more disk space to make read-write operations faster, etc.</p>
<p>A series of observations can similarly be <em>encoded</em> by defining a set of distinct ‘states’ or ‘symbols’ that represent different values within the data.  The ‘dictionary’ of these states can be designed based on the frequency of each state’s occurrence, allowing for a compressed representation that maximizes information content while preserving the essential patterns of the original signal.  Optimal encoding of time series observations relies on the algorithm used to assign bit strings to symbols based on their frequencies, and it also depends critically on how the states are defined in the first place.  Algorithms like Huffman and arithmetic coding can be counted on to approach the theoretical limit of compression described by the (Shannon) Entropy of the source distribution.  The compression limit is the minimum average description length needed to perfectly encode the information contained in a sequence of symbols.</p>
<blockquote>
<div><p><em>For an optimal encoding, the true distribution <span class="math notranslate nohighlight">\(P\)</span> provides the shortest possible average description length for data sampled from <span class="math notranslate nohighlight">\(P\)</span>.</em></p>
</div></blockquote>
<p>A catch in this definition is that the “true” probability distribution must be defined in a form that supports quantitative analysis.</p>
</section>
<section id="probabilistic-representations-of-observed-sequences">
<h1>Probabilistic Representations of Observed Sequences<a class="headerlink" href="#probabilistic-representations-of-observed-sequences" title="Link to this heading">#</a></h1>
<p>The probability distribution can be described in several ways, each with its own set of implications for data representation and computation:</p>
<p>Distributions are expressed in parametric and nonparametric, continuous and discrete forms:</p>
<ul class="simple">
<li><p><strong>(continuous) parametric</strong>: the parameters of some distribution are calibrated to the data, often using Maximum Likelihood Estimation (MLE).  This is itself an approximation of the data, and there is no one best parametric form for all streamflow time series.  Log-normal has been found to work well in some places, exponential in arid places, and the four-parameter Kappa “best overall” (Castellarin, 2007).  No matter what family of distributions is chosen, this approach still represents curve fitting.</p></li>
<li><p><strong>nonparametric</strong>:</p>
<ul>
<li><p><strong>continuous</strong>: the kernel density estimator (KDE) treats individual observations as distributions themselves, and their sum creates a smooth, continuous distribution function based (almost) purely on the data.  The caveat is the kernel represents the probability distribution of individual observations, which is difficult to quantify for individual observations, and probably varies considerably.  The simplest form is to assume a constant kernel across all observations, and the computational cost of this approach is significant to begin with.</p></li>
<li><p><strong>discrete</strong>: a simpler approach is to define a set of intervals that describe “bins”, or ranges of flow to represent the expected precision of streamflow observations, or some other question of practical interest.  This approach is somewhat analogous to assuming some kind of kernel since defining bin edges means that all observations falling within any interval are treated equal.  Too coarse a binning risks erasing real information, and too fine binning is both inefficient and potentially misleading assuming there is uncertainty in the observations.</p></li>
</ul>
</li>
</ul>
<p>The three categories above are “data driven” approaches to representing a “true distribution” P.  In each case, there is some kind of model applied, whether it is a) the parametric form, b) the kernel, or c) the quantization.  Each of these “models” introduce epistemic (model structure) uncertainty.</p>
<section id="motivating-example">
<h2>Motivating Example<a class="headerlink" href="#motivating-example" title="Link to this heading">#</a></h2>
<p>Imagine a simple system that we know nothing about besides that it generates (small) non-negative integers.  Before making any observations, assume we had reason to be curious about the number of times the following values were produced: i) 0, ii) between 1 and 4 inclusive, and iii) between 5 and 10 inclusive.  These questions can be reflected by defining the system states as <span class="math notranslate nohighlight">\(\Omega = \{[0, 1), [1, 5), [5, 10)]\}\)</span>.  Assume four observations are then recorded, <span class="math notranslate nohighlight">\(X = [1, 3, 4, 1]\)</span>, yielding a likelihood of <span class="math notranslate nohighlight">\(\text{Pr}(X|\Omega) =  [0, 1, 0]\)</span>.</p>
<p>Ignoring deep nuance in coding theory, we could define a coding dictionary for this system as <span class="math notranslate nohighlight">\(\mathcal{C} = \{ [0, 1): \text{00}, [1, 5): \text{01}, [5, 10): \text{10}\}\)</span>, yielding the encoded sequence <span class="math notranslate nohighlight">\(\mathcal{C}(X) = [01, 01, 01, 01]\)</span>.  A perfect model could be achieved by simply predicting the mean (2.25), or any constant in the range <span class="math notranslate nohighlight">\(\omega_1 = [1, 5)\)</span>.  An infinite number of models exist to satisfy these predictions perfectly, and none of them are useful or informative.  Our choice of quantization, that is the intervals we defined our system over, eliminated the variance in the original signal.</p>
<p>Finding our model uninformative, we could collect more observations to see if the system visits other states of interest (test ergodicity).  Alternatively we could redefine <span class="math notranslate nohighlight">\(\Omega\)</span> if there is something of practical interest in the observed variance <span class="math notranslate nohighlight">\(X = [1, 3, 4, 1]\)</span>.  An alternate set of states could be defined from the observations as <span class="math notranslate nohighlight">\(\Omega_1 = \{[0, 2), [2, 4), [4, 6)\}\)</span> which for the same <span class="math notranslate nohighlight">\(X\)</span> yields a likelihood <span class="math notranslate nohighlight">\(\text{Pr}(X|\Omega) = [0.5, 0.25, 0.25]\)</span>.  The same coding dictionary yields <span class="math notranslate nohighlight">\(\mathcal{C}(X) = [00, 01, 10, 00]\)</span> which clearly contains less redundancy and therefore preserves more of the original signal variance.</p>
<p>The (Shannon) entropy describes the lower bound on this distribution, given by <span class="math notranslate nohighlight">\(-\sum p \log_2 p = -(0.5 \log_2 0.5 + 2\cdot ( 0.25 \log_2 0.25)) = 1.5\)</span> bits, and the a.</p>
</section>
</section>
<section id="epistemic-noise">
<h1>Epistemic Noise<a class="headerlink" href="#epistemic-noise" title="Link to this heading">#</a></h1>
<p>In this section we revisit the idea of a “True distribution P” and how it is affected by model choices and measurement uncertainty.  How do we choose a representation that best suits a particular problem, that supports the broadest possible questions, or better yet anticipates future questions?  The short answer is by retaining the most information in the original signal.  Ultimately we want a representation of P that preserves information that can be used to support decisions.</p>
<p>There is plenty to explore on the side of reducing uncertainty in the observation itself, and developing error models to reduce uncertainty after the fact.  Since we are working with a large database of historical observations, we can’t change how the observations were done in the past, and developing a model of uncertainty to cover data collection across different governing bodies, across generations of technologists and measurement technologies, and across quality assurance adjustments that cannot be replicated, we assume there is varying degress of uncertainty in the data and we do not know its structure.</p>
<p>Instead, we test the information content of the signal by varying the degree of noise added (or variance removed) to the observations used to train a predictive model.  A central component of this model is quantifying the difference between distributions representing simulated and observed runoff.</p>
</section>
<section id="comparing-probability-distributions">
<h1>Comparing Probability Distributions<a class="headerlink" href="#comparing-probability-distributions" title="Link to this heading">#</a></h1>
<p>The interpretation of the divergence between two distributions is affected by how the distributions are represented.  The example quantization preserved no information about the set of observations (besides a range of values).  The question is how do we preserve the most information from the original signal?  Any information we lose from quantization is unavailable for subseqent computation (or learning).</p>
<p>Coming back to simulating the process that generates <span class="math notranslate nohighlight">\(X\)</span>, let the distribution of simulated values be denoted by <span class="math notranslate nohighlight">\(Q\)</span>.  If we want to quantify how much <span class="math notranslate nohighlight">\(Q\)</span> diverges from <span class="math notranslate nohighlight">\(P\)</span>, the quantization should aim to preserve as much information in <span class="math notranslate nohighlight">\(P\)</span> as possible.  But what about the information in <span class="math notranslate nohighlight">\(Q\)</span>?  If we compare the distributions based on a range most suitable to preserving information in <span class="math notranslate nohighlight">\(P\)</span>, then we are bound to find many cases where the quantization is not suited to preserve in formation in <span class="math notranslate nohighlight">\(Q\)</span>, in particular when the ranges do not align.</p>
<p>We could quantize <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(Q\)</span> to:</p>
<ol class="arabic simple">
<li><p>the range of the target <span class="math notranslate nohighlight">\(P\)</span>: best aligns the chosen quantization method with the “ground truth”, so preserves the most information for a given quantization.</p></li>
<li><p>the range of <span class="math notranslate nohighlight">\(Q\)</span>: a more intuitive way of approaching PUB since the target range is normally unknown.  Since <span class="math notranslate nohighlight">\(D_{KL}(P||Q)\)</span> is not symmetric, this</p></li>
<li><p>some general range (practical question): An example would be based on measurement uncertainty, or on an overall desired precision for “bands” or ranges of unit area runoff to cover all possible states in all possible catchments.</p></li>
<li><p><strong>Maximum uncertainty: retains the most information in <span class="math notranslate nohighlight">\(P\)</span></strong> by setting bin edges according to equiprobable states.  This yields highly variable bin widths according to frequency of observation.</p></li>
</ol>
<section id="target-proxy-range-binning">
<h2>Target/Proxy Range Binning<a class="headerlink" href="#target-proxy-range-binning" title="Link to this heading">#</a></h2>
</section>
<section id="application-based-binning">
<h2>Application-based Binning<a class="headerlink" href="#application-based-binning" title="Link to this heading">#</a></h2>
</section>
<section id="maximum-uncertainty-binning">
<h2>Maximum Uncertainty Binning<a class="headerlink" href="#maximum-uncertainty-binning" title="Link to this heading">#</a></h2>
<p>A binning scheme that maximizes uncertainty also maximizes the information in the distribution.  Since ultimately we are measuring how much information is lost when approximating <span class="math notranslate nohighlight">\(P\)</span> with <span class="math notranslate nohighlight">\(Q\)</span>, if <span class="math notranslate nohighlight">\(P\)</span> is binned to maximize uncertainty (uniform distribution), equal probability binning reduces bias introduced by “arbitrary” bin edges which risk overrepresenting areas with few observations.  The tradeoff is that heavy-tailed distributions, which distributions of streamflow observations are typically characterized by, lose the greatest amount of precision, or in other words the added noise is concentrated in the high magnitude bins.</p>
</section>
</section>
<section id="visualize-the-noise-added-by-quantization-and-the-prior-assumption">
<h1>Visualize the Noise added by Quantization and the Prior Assumption<a class="headerlink" href="#visualize-the-noise-added-by-quantization-and-the-prior-assumption" title="Link to this heading">#</a></h1>
<p>The objective is to determine the description length “cost” associated with an (imperfect) simulation <span class="math notranslate nohighlight">\(\hat X_T\)</span> instead of having the “ground truth” <span class="math notranslate nohighlight">\(X_T\)</span> observations.  The description length cost is a function of the accuracy state frequencies, or the accuracy of the simulated flow duration curve (FDC).  A poor simulation of the target catchment will “cost” <span class="math notranslate nohighlight">\(D_\text{KL}(T||\hat T)\)</span> bits per sample because errors in estimating the “ground truth” FDC results in mis-allocation of bits.  The encoding algorithm is near optimal <em>assuming the frequencies</em>, so incorrect frequencies mean that the expected message length will be longer because the true frequencies were not used to create the coding dictionary.  The cost is the KL divergence, and it is being proposed as a discriminant function to choose one proxy over another in simulating a target.</p>
<p>The calculated cost of frequency estimation error <span class="math notranslate nohighlight">\(D_\text{KL}(T||\hat T)\)</span> is affected by the methodology in two ways:</p>
<ul class="simple">
<li><p>using small dictionaries reduces the variance of the original signal,</p></li>
<li><p>assuming a prior on the likelihood changes the shape of the distribution in proportion to the prior,</p></li>
</ul>
<p>The goal is to measure how much the dictionary size and the choice of prior affect the KL divergence in comparison to the discriminant value being used to choose between proxies for the better simulation (compression) of a target.  If the discriminant is larger than the vestigial effects of the model, then we have confidence that the epistemic a.k.a methodological uncertainty does not overpower the “genuine differences” between any proxy <span class="math notranslate nohighlight">\(S\)</span> and any target <span class="math notranslate nohighlight">\(T\)</span>.</p>
<p>For two catchments where streamflow monitoring observations have been recorded, let one location represent a <strong>Surrogate</strong> (a.k.a. proxy) catchment that will be used to simulate runoff at a <strong>Target</strong> catchment.  In this case the target catchment is also observed such that the model can be evaluated against “ground truth” observations.</p>
<ol class="arabic simple">
<li><p>Import full streamflow timeseries of both.  Test for minimum 1 year concurrent data.</p>
<ul class="simple">
<li><p>1 complete year contains 12 months with less than 5 days missing in any month.</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import streamflow record timeseries</span>
<span class="n">attributes_filename</span> <span class="o">=</span> <span class="s1">&#39;BCUB_watershed_attributes_updated.csv&#39;</span>
<span class="n">attributes_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">attributes_filename</span><span class="p">)</span>
<span class="n">attr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">attributes_fpath</span><span class="p">)</span>
<span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="c1"># df.columns</span>
<span class="n">filtered_stns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span> <span class="o">=</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span> <span class="o">=</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>

<span class="c1"># Retrieve the data for both stations</span>
<span class="c1"># this is all data, including non-concurrent</span>
<span class="n">adf</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">retrieve_nonconcurrent_data</span><span class="p">(</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span>

<span class="c1"># add a very small amount of noise to prevent duplicate bin edges</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">]:</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">adf</span><span class="p">))</span>
    <span class="n">adf</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">adf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="n">df</span><span class="p">[[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">]]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">]]</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
<span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">count_complete_years</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">test_proxy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num_complete_concurrent_years</span><span class="p">,</span> <span class="s1">&#39;concurrent years of record&#39;</span><span class="p">)</span>
    
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>24 concurrent years of record
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="2">
<li><p>Let <span class="math notranslate nohighlight">\(X_S\)</span> and <span class="math notranslate nohighlight">\(X_T\)</span> represent unit area runoff timeseries observations of the <strong>Surrogate</strong> and <strong>Target</strong> catchments</p></li>
<li><p>Simulate runoff at the target as <span class="math notranslate nohighlight">\(\hat X_T = X_S \cdot \frac{A_T}{A_S}\)</span> Where <span class="math notranslate nohighlight">\(A_T\)</span> and <span class="math notranslate nohighlight">\(A_S\)</span> are the target and surrogate catchment areas.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate runoff at the target based on equal unit area runoff scaling</span>
<span class="n">target_da</span> <span class="o">=</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_target</span><span class="p">,</span> <span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">proxy_da</span> <span class="o">=</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_proxy</span><span class="p">,</span> <span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># by the equal unit area runoff model assumption, the simulated target runoff</span>
<span class="c1"># is equal to the observed proxy unit area runoff</span>
<span class="n">sim_target</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_sim&#39;</span>
<span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_da</span> <span class="o">/</span> <span class="n">proxy_da</span><span class="p">)</span>
<span class="c1"># convert to Unit Area Runoff</span>
<span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">/</span> <span class="n">target_da</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">/</span> <span class="n">target_da</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1000</span> <span class="o">*</span> <span class="n">df</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">]</span> <span class="o">/</span> <span class="n">proxy_da</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mf">0.1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">[[</span><span class="n">sim_target</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">test_proxy</span><span class="p">]])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>            05BF016_sim  05BF016  05BB001
time                                     
1962-03-06          3.6      1.1      3.6
1962-03-19          3.7      2.2      3.7
1962-03-26          3.7      2.2      3.7
1962-04-16          5.7      4.3      5.7
1962-04-17          5.7      3.2      5.7
...                 ...      ...      ...
2016-05-02         19.2      9.7     19.2
2016-05-30         30.5     37.6     30.5
2016-06-29         31.7     14.0     31.7
2016-08-15         24.6      7.5     24.6
2016-11-04          9.9      4.3      9.9

[14044 rows x 3 columns]
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="3">
<li><p>Compute <span class="math notranslate nohighlight">\(2^b - 2\)</span> log-spaced bins over the <strong>observed target range</strong> <span class="math notranslate nohighlight">\([\min (X_T), \max (X_T)]\)</span> for <span class="math notranslate nohighlight">\(b = \{ 4, 5, \dots, 14\}\)</span> bits</p>
<ul class="simple">
<li><p>binning over the target range ensures that the ground truth distribution <span class="math notranslate nohighlight">\(T \sim \text{Pr}(X_T = x)\)</span> aligns with the ground-truth range and not the simulated range.</p></li>
<li><p>and also that the simulated distribution <span class="math notranslate nohighlight">\(\hat T \sim \text{Pr}(\hat X_T = x)\)</span> better reflects the “ground truth” in terms of binning, assuming the log-spaced binning procedure.</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># reserve two bins for out of range values at left and right</span>
<span class="n">bitrates</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">17</span><span class="p">))</span>
<span class="n">bitrate</span> <span class="o">=</span> <span class="mi">4</span><span class="c1">#bitrates[-1]</span>

<span class="k">def</span> <span class="nf">digitize_by_log_binning</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">):</span>

    <span class="n">min_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">max_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span> <span class="o">+</span> <span class="mf">1e-3</span>
    
    <span class="c1"># set the bin edges to be evenly spaced between the</span>
    <span class="c1"># observed range of the simulated series </span>
    <span class="c1"># np.digitize will assign 0 for out-of-range values at left</span>
    <span class="c1"># and n_bins + 1 for out-of-range values at right</span>
    <span class="n">log_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">min_log_val</span><span class="p">,</span>
        <span class="n">max_log_val</span><span class="p">,</span>
        <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    
    <span class="c1"># convert bin edges back to linear space</span>
    <span class="k">return</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">log_bin_edges</span><span class="p">]</span>
    
<span class="n">n_bins</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">bitrate</span> <span class="o">-</span> <span class="mi">2</span>
<span class="c1"># convert bin edges back to linear space</span>
<span class="n">target_bin_edges</span> <span class="o">=</span> <span class="n">digitize_by_log_binning</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="4">
<li><p>Quantize the simulated and observed series:</p>
<ul class="simple">
<li><p>this quantization represents a “dictionary optimized on a simulated distribution”</p></li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">obs_q_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_quantized&#39;</span>
<span class="n">df</span><span class="p">[</span><span class="n">obs_q_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">target_bin_edges</span><span class="p">)</span>
<span class="n">sim_q_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_sim_quantized&#39;</span>
<span class="n">df</span><span class="p">[</span><span class="n">sim_q_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">],</span> <span class="n">target_bin_edges</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="5">
<li><p>Compute the quantization noise</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Compute bin midpoints</span>
<span class="c1"># bin_midpoints = (np.array(target_bin_edges[:-1]) + np.array(target_bin_edges[1:])) / 2</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="6">
<li><p>Compute the likelihood of <span class="math notranslate nohighlight">\(\text{Pr}(S|\text{data})\)</span> and <span class="math notranslate nohighlight">\(\text{Pr}(T|\text{data})\)</span>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># count the occurrences of each quantized value</span>
<span class="c1"># the &quot;simulated&quot; series is the proxy/donor series</span>
<span class="c1"># and the &quot;observed&quot; series is the target location</span>
<span class="n">obs_count_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">obs_q_label</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
<span class="n">sim_count_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sim_q_label</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>

<span class="n">count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitrate</span><span class="p">))</span>
<span class="n">count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">+=</span> <span class="n">obs_count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span>
<span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sim_count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span>
<span class="n">count_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the observed and simulated histograms</span>
<span class="k">def</span> <span class="nf">plot_histograms</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col1</span><span class="p">,</span> <span class="n">col2</span><span class="p">,</span> <span class="n">bins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot two overlaid histograms for specified columns in a DataFrame using Bokeh.</span>
<span class="sd">    </span>
<span class="sd">    Parameters:</span>
<span class="sd">    - df: pandas DataFrame containing the data.</span>
<span class="sd">    - bins: list or array of bin edges for the histograms.</span>
<span class="sd">    - col1: name of the first column in df to plot.</span>
<span class="sd">    - col2: name of the second column in df to plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute histograms for each column</span>
    <span class="n">counts1</span><span class="p">,</span> <span class="n">counts2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col1</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">col2</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    
    <span class="c1"># Normalize histograms to make them comparable (optional)</span>
    <span class="n">counts1</span> <span class="o">=</span> <span class="n">counts1</span> <span class="o">/</span> <span class="n">counts1</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">counts2</span> <span class="o">=</span> <span class="n">counts2</span> <span class="o">/</span> <span class="n">counts2</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

    <span class="c1"># Compute bin width in log space and extend bins</span>
    <span class="n">log_width_factor</span> <span class="o">=</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="c1"># Extend bins by dividing and multiplying the edges by the log factor</span>
    <span class="n">extended_bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">bins</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">log_width_factor</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">bins</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">bins</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">log_width_factor</span><span class="p">]</span>
    
    <span class="c1"># Prepare data for Bokeh plotting</span>
    <span class="n">left_edges</span> <span class="o">=</span> <span class="n">extended_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">right_edges</span> <span class="o">=</span> <span class="n">extended_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
    
    <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">left_edges</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">right_edges</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">counts1</span><span class="p">})</span>
    <span class="n">source2</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;left&#39;</span><span class="p">:</span> <span class="n">left_edges</span><span class="p">,</span> <span class="s1">&#39;right&#39;</span><span class="p">:</span> <span class="n">right_edges</span><span class="p">,</span> <span class="s1">&#39;top&#39;</span><span class="p">:</span> <span class="n">counts2</span><span class="p">})</span>
    
    <span class="c1"># Create the Bokeh plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> 
           <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;P(x)&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">source2</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="s1">&#39;top&#39;</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">,</span> <span class="n">right</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">,</span> 
           <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Q(x)&quot;</span><span class="p">)</span>
    
    <span class="c1"># Add labels and legend</span>
    <span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Flow}</span><span class="s1"> [m^3/s]$$&#39;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Pr}</span><span class="s1">(X)$$&#39;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plot</span> <span class="o">=</span> <span class="n">plot_histograms</span><span class="p">(</span><span class="n">count_df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">sim_target</span><span class="p">,</span> <span class="n">target_bin_edges</span><span class="p">)</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="fee6c89d-b8b8-4364-b58a-96699ad6494a" data-root-id="p1007" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"a342d425-dec7-4b26-a309-a63485c53193":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"Figure","id":"p1007","attributes":{"width":700,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1008"},"y_range":{"type":"object","name":"DataRange1d","id":"p1009"},"x_scale":{"type":"object","name":"LogScale","id":"p1017"},"y_scale":{"type":"object","name":"LinearScale","id":"p1018"},"title":{"type":"object","name":"Title","id":"p1010"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1048","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1001","attributes":{"selected":{"type":"object","name":"Selection","id":"p1002","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1003"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"I/US5HiqEj+0bxxWtf8rPyP1EuR4qjI/x1OVAMj/RD8FFr63GLvGP+PvCua7ibk/IBvUddDTsT+UhejNyLLEP2gCGZ9WhL8/q/3fAKx/vz8Hg93ubCa3PyGWs6ccQbU/BSR+shC9qT9DvGZ5eXKSP3pd8hwlFWI/AAAAAAAAAAA="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1049","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1050"}}},"glyph":{"type":"object","name":"Quad","id":"p1045","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1046","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1047","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1059","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1004","attributes":{"selected":{"type":"object","name":"Selection","id":"p1005","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1006"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHUkVHIg1VM/EAPaPm6oxj8b4jXLy5PDP6I3I8vS88A/8CZmsXldwj/N8vLkJCrCP/m0Ivxy4cQ/8C3GrnXesz/dLc0Oc9qEPyP1EuR4qhI/AAAAAAAAAAA="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1060","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1061"}}},"glyph":{"type":"object","name":"Quad","id":"p1056","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1057","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1058","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1016","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1029"},{"type":"object","name":"WheelZoomTool","id":"p1030","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1031","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1032","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1038","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1037","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"SaveTool","id":"p1039"},{"type":"object","name":"ResetTool","id":"p1040"},{"type":"object","name":"HelpTool","id":"p1041"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1024","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1025","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1026"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1027"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p1019","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1020","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1021"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1022"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1023","attributes":{"axis":{"id":"p1019"}}},{"type":"object","name":"Grid","id":"p1028","attributes":{"dimension":1,"axis":{"id":"p1024"}}},{"type":"object","name":"Legend","id":"p1051","attributes":{"location":"top_left","click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1052","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1048"}]}},{"type":"object","name":"LegendItem","id":"p1062","attributes":{"label":{"type":"value","value":"Q(x)"},"renderers":[{"id":"p1059"}]}}]}}]}}]}};
  const render_items = [{"docid":"a342d425-dec7-4b26-a309-a63485c53193","roots":{"p1007":"fee6c89d-b8b8-4364-b58a-96699ad6494a"},"root_ids":["p1007"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>The figure above compares observed runoff at the target catchment to runoff simulated from a surrogate/proxy catchment based on an equal unit area runoff model.  Both distributions have zero probability for the left and right-most edges (states), this is a feature of the quantization which reserves a state at each extreme to capture simulated values outside of the range of the observed series, which is not expressed in this case since the variance of the observed series is slightly greater than the proxy.  The left side of the distribution shows that the simulated values do not provide support coverage of the target distribution. This scenario presents a problem since the discriminant <span class="math notranslate nohighlight">\(D_\text{KL}(P||Q) = P \log (P/Q)\)</span> is undefined where the simulation is inadmissible when <span class="math notranslate nohighlight">\(p_i &gt; 0 \cap q_i = 0\)</span> for any <span class="math notranslate nohighlight">\(i\)</span> due to division by zero.  This case is addressed by assuming a Dirichlet prior which incorporates pseudo-counts to ensure all (simulated) states have non-zero probability.</p>
</section>
<section id="good-bad-2">
<h1>{good, bad}^2<a class="headerlink" href="#good-bad-2" title="Link to this heading">#</a></h1>
<p>The “closeness” of one distribution to another can be described in terms of the implications of mismatch:</p>
<ul class="simple">
<li><p><strong>good good</strong>: a good approximation of <span class="math notranslate nohighlight">\(P(x)\)</span> with complete support coverage,</p></li>
<li><p><strong>bad good</strong>: a bad approximation of P(x) with complete support coverage,</p></li>
<li><p><strong>bad bad</strong>: incomplete support coverage of P(x) with high distortion rate, and</p></li>
<li><p><strong>good bad</strong>: incomplete support coverage of P(x) with small distortion rate</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">normalize</span><span class="p">(</span><span class="n">hist</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">hist</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">hist</span><span class="p">)</span>
<span class="n">bins</span> <span class="o">=</span> <span class="mi">16</span>
<span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="p">(</span><span class="mf">0.7</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">((</span><span class="n">x</span> <span class="o">-</span> <span class="mf">0.4</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mf">0.02</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="mf">0.1</span><span class="p">)</span> <span class="o">-</span> <span class="mf">0.3</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span> <span class="o">/</span> <span class="mf">0.1</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<span class="n">P</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

<span class="c1"># Q1: Has support coverage of P and is a good representation of P with slight noise</span>
<span class="n">Q1</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">((</span><span class="n">P</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">,</span> <span class="n">bins</span><span class="p">))</span><span class="o">.</span><span class="n">clip</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>

<span class="c1"># Q2: Has support coverage of P but extends beyond it (adds more mass in certain regions)</span>
<span class="n">Q2</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">P</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">bins</span><span class="p">)</span> <span class="o">+</span> <span class="mf">0.37</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.8</span><span class="p">))</span>

<span class="c1"># Q3: Does not have support coverage of P where P is concentrated (zeros in main regions of P)</span>
<span class="n">Q3</span> <span class="o">=</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="mf">0.45</span><span class="p">)</span> <span class="o">+</span> <span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="mf">0.15</span><span class="p">)</span>
<span class="n">Q3</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">Q3</span> <span class="o">&gt;</span> <span class="mf">0.04</span><span class="p">,</span> <span class="n">Q3</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="c1"># Q4: Does not have support coverage of P, but only where P is small (focuses on P&#39;s large values)</span>
<span class="n">Q4</span> <span class="o">=</span> <span class="n">normalize</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="p">(</span><span class="n">P</span> <span class="o">&gt;</span> <span class="mf">0.01</span><span class="p">))</span>
<span class="n">ex_plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="p">[</span><span class="n">Q1</span><span class="p">,</span> <span class="n">Q2</span><span class="p">,</span> <span class="n">Q3</span><span class="p">,</span> <span class="n">Q4</span><span class="p">]:</span>
    <span class="n">temp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;p&#39;</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">:</span> <span class="n">q</span><span class="p">})</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">plot_histograms</span><span class="p">(</span><span class="n">temp_df</span><span class="p">,</span> <span class="s1">&#39;p&#39;</span><span class="p">,</span> <span class="s1">&#39;q&#39;</span><span class="p">,</span> <span class="n">target_bin_edges</span><span class="p">)</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="c1"># p.legend.location = &quot;top_right&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">ex_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">ex_plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="eec1584a-21bf-44f9-bc15-cf9f1fd9248e" data-root-id="p1320" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"79eca9a3-c70b-43e4-b275-bd6859069dcc":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"GridPlot","id":"p1320","attributes":{"rows":null,"cols":null,"toolbar":{"type":"object","name":"Toolbar","id":"p1319","attributes":{"tools":[{"type":"object","name":"ToolProxy","id":"p1313","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1093"},{"type":"object","name":"PanTool","id":"p1155"},{"type":"object","name":"PanTool","id":"p1217"},{"type":"object","name":"PanTool","id":"p1279"}]}},{"type":"object","name":"ToolProxy","id":"p1314","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1094","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1156","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1218","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1280","attributes":{"renderers":"auto"}}]}},{"type":"object","name":"ToolProxy","id":"p1315","attributes":{"tools":[{"type":"object","name":"BoxZoomTool","id":"p1095","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1096","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1102","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1101","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1157","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1158","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1164","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1163","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1219","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1220","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1226","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1225","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1281","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1282","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1288","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1287","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}}]}},{"type":"object","name":"SaveTool","id":"p1316"},{"type":"object","name":"ToolProxy","id":"p1317","attributes":{"tools":[{"type":"object","name":"ResetTool","id":"p1104"},{"type":"object","name":"ResetTool","id":"p1166"},{"type":"object","name":"ResetTool","id":"p1228"},{"type":"object","name":"ResetTool","id":"p1290"}]}},{"type":"object","name":"ToolProxy","id":"p1318","attributes":{"tools":[{"type":"object","name":"HelpTool","id":"p1105"},{"type":"object","name":"HelpTool","id":"p1167"},{"type":"object","name":"HelpTool","id":"p1229"},{"type":"object","name":"HelpTool","id":"p1291"}]}}]}},"children":[[{"type":"object","name":"Figure","id":"p1071","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1072"},"y_range":{"type":"object","name":"DataRange1d","id":"p1073"},"x_scale":{"type":"object","name":"LogScale","id":"p1081"},"y_scale":{"type":"object","name":"LinearScale","id":"p1082"},"title":{"type":"object","name":"Title","id":"p1074"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1112","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1065","attributes":{"selected":{"type":"object","name":"Selection","id":"p1066","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1067"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"OcmJbr9PEj9CdsMzyWBKP2+rj9oWXXg/qG61bmTbnD+n5Uq7Ouq1PzuuRnGgV8U/H0+ZWG+nyj9ovt2Ys1nFP+a3bkuhA7Y/Nc8nO3t9nj/m6s3Z7xyGP3SkKUz7cYk/ij4FGMOhlz+LC05WKfujPzTAj0z51K0/7k843d4ItD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1113","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1114"}}},"glyph":{"type":"object","name":"Quad","id":"p1109","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1110","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1111","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1123","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1068","attributes":{"selected":{"type":"object","name":"Selection","id":"p1069","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1070"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAAAnVcJbg0CNP7HznknM6YM/+7Oyp4GrgT+VCW13Cq25PzeZgBvzB8Q/6UIrJIeVyj+OPD90y7bGPx6Hrh31L7I/MwSLHxZfkj/a3QSxWXOaPwAAAAAAAAAA4dacDmHjjj+XrP9QXi+tP0qOHdCQlLE/XsbWynLisT8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1124","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1125"}}},"glyph":{"type":"object","name":"Quad","id":"p1120","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1121","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1122","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1080","attributes":{"tools":[{"id":"p1093"},{"id":"p1094"},{"id":"p1095"},{"type":"object","name":"SaveTool","id":"p1103"},{"id":"p1104"},{"id":"p1105"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1088","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1089","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1090"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1091"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p1083","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1084","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1085"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1086"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1087","attributes":{"axis":{"id":"p1083"}}},{"type":"object","name":"Grid","id":"p1092","attributes":{"dimension":1,"axis":{"id":"p1088"}}},{"type":"object","name":"Legend","id":"p1115","attributes":{"location":"top_left","background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1116","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1112"}]}},{"type":"object","name":"LegendItem","id":"p1126","attributes":{"label":{"type":"value","value":"Q(x)"},"renderers":[{"id":"p1123"}]}}]}}]}},0,0],[{"type":"object","name":"Figure","id":"p1133","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1134"},"y_range":{"type":"object","name":"DataRange1d","id":"p1135"},"x_scale":{"type":"object","name":"LogScale","id":"p1143"},"y_scale":{"type":"object","name":"LinearScale","id":"p1144"},"title":{"type":"object","name":"Title","id":"p1136"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1174","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1127","attributes":{"selected":{"type":"object","name":"Selection","id":"p1128","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1129"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"OcmJbr9PEj9CdsMzyWBKP2+rj9oWXXg/qG61bmTbnD+n5Uq7Ouq1PzuuRnGgV8U/H0+ZWG+nyj9ovt2Ys1nFP+a3bkuhA7Y/Nc8nO3t9nj/m6s3Z7xyGP3SkKUz7cYk/ij4FGMOhlz+LC05WKfujPzTAj0z51K0/7k843d4ItD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1175","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1176"}}},"glyph":{"type":"object","name":"Quad","id":"p1171","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1172","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1173","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1185","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1130","attributes":{"selected":{"type":"object","name":"Selection","id":"p1131","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1132"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"XVb3JHlJQj9AH5jKNVqLP/e1o3lD4JU/IOWEXN4Bij/hDM/hx7amP/lUvHyYZ7Q/OMymaDGStT9W+eEoQG20P7Kbj2Zqvqk/asVnkuXCkz/FLCdNQ/KYP9RB0afMWYU/ddeLkpsOlT/RzWK/vW/FPz5nwJ/rC8c/4ucWhFyByD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1186","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1187"}}},"glyph":{"type":"object","name":"Quad","id":"p1182","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1183","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1184","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1142","attributes":{"tools":[{"id":"p1155"},{"id":"p1156"},{"id":"p1157"},{"type":"object","name":"SaveTool","id":"p1165"},{"id":"p1166"},{"id":"p1167"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1150","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1151","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1152"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1153"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p1145","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1146","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1147"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1148"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1149","attributes":{"axis":{"id":"p1145"}}},{"type":"object","name":"Grid","id":"p1154","attributes":{"dimension":1,"axis":{"id":"p1150"}}},{"type":"object","name":"Legend","id":"p1177","attributes":{"location":"top_left","background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1178","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1174"}]}},{"type":"object","name":"LegendItem","id":"p1188","attributes":{"label":{"type":"value","value":"Q(x)"},"renderers":[{"id":"p1185"}]}}]}}]}},0,1],[{"type":"object","name":"Figure","id":"p1195","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1196"},"y_range":{"type":"object","name":"DataRange1d","id":"p1197"},"x_scale":{"type":"object","name":"LogScale","id":"p1205"},"y_scale":{"type":"object","name":"LinearScale","id":"p1206"},"title":{"type":"object","name":"Title","id":"p1198"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1236","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1189","attributes":{"selected":{"type":"object","name":"Selection","id":"p1190","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1191"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"OcmJbr9PEj9CdsMzyWBKP2+rj9oWXXg/qG61bmTbnD+n5Uq7Ouq1PzuuRnGgV8U/H0+ZWG+nyj9ovt2Ys1nFP+a3bkuhA7Y/Nc8nO3t9nj/m6s3Z7xyGP3SkKUz7cYk/ij4FGMOhlz+LC05WKfujPzTAj0z51K0/7k843d4ItD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1237","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1238"}}},"glyph":{"type":"object","name":"Quad","id":"p1233","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1234","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1235","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1247","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1192","attributes":{"selected":{"type":"object","name":"Selection","id":"p1193","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1194"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAADOQ+7b8cpT+w6emTiwjAP7TK6HqTOs8/XiDC9yWA0z8jok6vnD2/P5ZwbfggG7A/AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMINQRpZ06U/ORSsr79QrT8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1248","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1249"}}},"glyph":{"type":"object","name":"Quad","id":"p1244","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1245","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1246","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1204","attributes":{"tools":[{"id":"p1217"},{"id":"p1218"},{"id":"p1219"},{"type":"object","name":"SaveTool","id":"p1227"},{"id":"p1228"},{"id":"p1229"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1212","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1213","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1214"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1215"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p1207","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1208","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1209"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1210"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1211","attributes":{"axis":{"id":"p1207"}}},{"type":"object","name":"Grid","id":"p1216","attributes":{"dimension":1,"axis":{"id":"p1212"}}},{"type":"object","name":"Legend","id":"p1239","attributes":{"location":"top_left","background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1240","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1236"}]}},{"type":"object","name":"LegendItem","id":"p1250","attributes":{"label":{"type":"value","value":"Q(x)"},"renderers":[{"id":"p1247"}]}}]}}]}},1,0],[{"type":"object","name":"Figure","id":"p1257","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1258"},"y_range":{"type":"object","name":"DataRange1d","id":"p1259"},"x_scale":{"type":"object","name":"LogScale","id":"p1267"},"y_scale":{"type":"object","name":"LinearScale","id":"p1268"},"title":{"type":"object","name":"Title","id":"p1260"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1298","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1251","attributes":{"selected":{"type":"object","name":"Selection","id":"p1252","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1253"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"OcmJbr9PEj9CdsMzyWBKP2+rj9oWXXg/qG61bmTbnD+n5Uq7Ouq1PzuuRnGgV8U/H0+ZWG+nyj9ovt2Ys1nFP+a3bkuhA7Y/Nc8nO3t9nj/m6s3Z7xyGP3SkKUz7cYk/ij4FGMOhlz+LC05WKfujPzTAj0z51K0/7k843d4ItD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1299","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1300"}}},"glyph":{"type":"object","name":"Quad","id":"p1295","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1296","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1297","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"grey"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"grey"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1309","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1254","attributes":{"selected":{"type":"object","name":"Selection","id":"p1255","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1256"},"data":{"type":"map","entries":[["left",[0.120212569925448,0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015]],["right",[0.20000000000000004,0.3327439054402276,0.5535925330380757,0.9210227073281876,1.5323234631775642,2.5493564676769873,4.241414137070721,7.05652352279152,11.740075979022418,19.532193657124616,32.49609199643242,54.06438281218924,89.94796941071682,149.64819314070024,248.97262113855015,414.2206115266566]],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAbA7aiyQOnT8xPhdfxRC2PxIFB0EpfcU/7eacok/Wyj8dpMAOQH/FPx7bNJtYKrY/4C8Eohqznj+qXFWr00OGP9jz31q7nok/4n72u1LLlz+5r6ROTR6kP3vYSFlwCa4/CSm48RostD8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1310","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1311"}}},"glyph":{"type":"object","name":"Quad","id":"p1306","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.5}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1307","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.1},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1308","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"value","value":0},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"red"},"line_alpha":{"type":"value","value":0.2},"fill_color":{"type":"value","value":"red"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1266","attributes":{"tools":[{"id":"p1279"},{"id":"p1280"},{"id":"p1281"},{"type":"object","name":"SaveTool","id":"p1289"},{"id":"p1290"},{"id":"p1291"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1274","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1275","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1276"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1277"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p1269","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1270","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1271"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1272"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1273","attributes":{"axis":{"id":"p1269"}}},{"type":"object","name":"Grid","id":"p1278","attributes":{"dimension":1,"axis":{"id":"p1274"}}},{"type":"object","name":"Legend","id":"p1301","attributes":{"location":"top_left","background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1302","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1298"}]}},{"type":"object","name":"LegendItem","id":"p1312","attributes":{"label":{"type":"value","value":"Q(x)"},"renderers":[{"id":"p1309"}]}}]}}]}},1,1]]}}]}};
  const render_items = [{"docid":"79eca9a3-c70b-43e4-b275-bd6859069dcc","roots":{"p1320":"eec1584a-21bf-44f9-bc15-cf9f1fd9248e"},"root_ids":["p1320"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
</section>
<section id="dealing-with-underspecification-assuming-a-prior-on-q">
<h1>Dealing with Underspecification: Assuming a Prior on Q<a class="headerlink" href="#dealing-with-underspecification-assuming-a-prior-on-q" title="Link to this heading">#</a></h1>
<p>The joint likelihod of observing the data given <span class="math notranslate nohighlight">\(Q\)</span> and the prior probability of <span class="math notranslate nohighlight">\(Q\)</span> is given by <span class="math notranslate nohighlight">\(\text{Pr}(\text{data}|Q)\cdot \text{Prior}(Q)\)</span>, and the normalized posterior is given by:</p>
<div class="math notranslate nohighlight">
\[\text{Pr}(Q|\text{data}) = \frac{\text{Pr}(\text{data}|Q) \cdot \text{Prior}(Q)}{\text{Pr}(\text{data})}\]</div>
<p>However this doesn’t address our (fairly common) problem where some <span class="math notranslate nohighlight">\(q_i = 0\)</span>.  Normal Bayesian updating still yields <span class="math notranslate nohighlight">\(q_i = 0\)</span> because the dot product will multiply by zero.</p>
<p>Let:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(Q = (q_1, q_2, \dots, q_k)\)</span> be a probability vector representing a discrete distribution over <span class="math notranslate nohighlight">\(k\)</span> categories (states).</p></li>
<li><p>The observed data consist of counts <span class="math notranslate nohighlight">\((n_1, n_2, \dots, n_k)\)</span> for each category</p></li>
<li><p>The prior distribution for <span class="math notranslate nohighlight">\(Q\)</span> is a Dirichlet distribution with parameters <span class="math notranslate nohighlight">\(\alpha = (\alpha_1, \alpha_2, \dots, \alpha_k)\)</span>, and by definition the posterior is also a Dirichlet distribution, or one that satisfies <span class="math notranslate nohighlight">\(\sum_{i=1}^k t_i = 1, t_i \geq 0 \text{ for all } i\)</span></p></li>
</ul>
<div class="math notranslate nohighlight">
\[Q|\text{data}\sim \text{Dirichlet}(\alpha_1 + n_1, \alpha_2 + n_2, \dots, \alpha_k + n_k)\]</div>
<p>The (renormalized) posterior is given by:</p>
<div class="math notranslate nohighlight">
\[\mathbb{E}[Q|data] = \left( \frac{\alpha_1 + n_1}{\sum_{j=1}^k(\alpha_j + n_j)}, \frac{\alpha_2 + n_2}{\sum_{j=1}^k(\alpha_j + n_j)}, \dots, \frac{\alpha_k + n_k}{\sum_{j=1}^k(\alpha_j + n_j)} \right)\]</div>
<p>The KL divergence can’t be computed where <span class="math notranslate nohighlight">\(\hat t_i = 0\)</span>.  To address this case we assume a Dirichlet prior on <span class="math notranslate nohighlight">\(\hat T\)</span> in the form of a uniform distribution of pseudo-counts.  The assumption of a prior adds noise to the distribution, and the goal is to minimize the influence this procedural step has on the discriminant value in the final objective function.  To illustrate this point, we apply a range of priors to <span class="math notranslate nohighlight">\(\hat T\)</span> and evaluate the degree to which it adds noise to the simulated distribution.</p>
<ol class="arabic simple" start="4">
<li><p>For a range of priors representing strength of belief in a model, compute the posterior given by:</p></li>
</ol>
<div class="math notranslate nohighlight">
\[\mathbb{E}[t_i \mid \text{data}] = \frac{\alpha_i + n_i}{\sum_{j=1}^k (\alpha_j + n_j)}\]</div>
<p>Where <span class="math notranslate nohighlight">\(\alpha_i\)</span> represents a Dirichlet prior of pseudo-counts, and <span class="math notranslate nohighlight">\(n_i\)</span> represent the observed target counts.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mf">5.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">:</span>
    <span class="n">pseudo_counts</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">prior</span>
    <span class="n">post_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_pseudo_counts&#39;</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">post_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">+</span> <span class="n">pseudo_counts</span>

<span class="c1"># normalize the counts to probabilities</span>
<span class="n">probabilities</span> <span class="o">=</span> <span class="n">count_df</span> <span class="o">/</span> <span class="n">count_df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
<span class="n">col_sums</span> <span class="o">=</span> <span class="n">probabilities</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">col_sums</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)),</span> <span class="n">col_sums</span>
</pre></div>
</div>
</div>
</div>
<ol class="arabic simple" start="5">
<li><p>Compute the noise on <span class="math notranslate nohighlight">\(T\)</span> from assuming a prior as <span class="math notranslate nohighlight">\(\eta_{pr} = D_\text{KL}(T||Q)\)</span>, where</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(T\)</span> is the likelihood</p></li>
<li><p><span class="math notranslate nohighlight">\(Q\)</span> is the posterior distribution of T after assuming a Dirichlet prior:</p>
<ul>
<li><p><span class="math notranslate nohighlight">\(Q|data \sim \text{Dirichlet}(\alpha_1 + n_1, \alpha_2 + n_2, \dots, \alpha_k + n_k)\)</span> with</p></li>
<li><p>each <span class="math notranslate nohighlight">\(q_i = \mathbb{E} [q_i|\text{data}] = \frac{\alpha_i+n_i}{\sum_{j=1}^k(\alpha_j + n_j)}\)</span> is the updated expectation of the probability of category <span class="math notranslate nohighlight">\(i\)</span></p></li>
</ul>
</li>
</ul>
</li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_noise</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">obs_label</span><span class="p">,</span> <span class="n">posterior_sim_label</span><span class="p">):</span>
    <span class="c1"># compute DKL(Q||Q_post), or the divergence</span>
    <span class="c1"># of the posterior from the likelihood due to the prior</span>
    <span class="n">p</span><span class="p">,</span> <span class="n">q</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">obs_label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">posterior_sim_label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">noise</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">noise</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span>
<span class="n">probabilities</span><span class="o">.</span><span class="n">columns</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>05BB001 05BF016
</pre></div>
</div>
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Index([&#39;05BF016&#39;, &#39;05BF016_sim&#39;, &#39;-3.0_pseudo_counts&#39;, &#39;-2.0_pseudo_counts&#39;,
       &#39;-1.0_pseudo_counts&#39;, &#39;0.0_pseudo_counts&#39;, &#39;1.0_pseudo_counts&#39;,
       &#39;2.0_pseudo_counts&#39;, &#39;3.0_pseudo_counts&#39;, &#39;4.0_pseudo_counts&#39;,
       &#39;5.0_pseudo_counts&#39;],
      dtype=&#39;object&#39;)
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># plot the posterior distribution for each prior</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">TolRainbow14</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">row</span><span class="p">,</span> <span class="n">column</span><span class="p">,</span> <span class="n">gridplot</span>

<span class="n">post_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="c1"># Compute bin width in log space and extend bins</span>
<span class="n">log_width_factor</span> <span class="o">=</span> <span class="n">target_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span><span class="n">target_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># Extend bins by dividing and multiplying the edges by the log factor</span>
<span class="n">extended_bins</span> <span class="o">=</span> <span class="p">[</span><span class="n">target_bin_edges</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">/</span> <span class="n">log_width_factor</span><span class="p">]</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="n">target_bin_edges</span><span class="p">)</span> <span class="o">+</span> <span class="p">[</span><span class="n">target_bin_edges</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">log_width_factor</span><span class="p">]</span>
<span class="n">bin_midpoints</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">extended_bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">extended_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span> 

<span class="n">post_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bin_midpoints</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">test_target</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> 
              <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;P(x)&#39;</span><span class="p">)</span>

<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">min_post_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">min</span><span class="p">(</span><span class="n">priors</span><span class="p">)</span><span class="si">}</span><span class="s1">_pseudo_counts&#39;</span>
<span class="nb">print</span><span class="p">(</span><span class="n">min_post_label</span><span class="p">)</span>
<span class="n">noise_1</span><span class="p">,</span> <span class="n">noise_2</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">discriminants</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">:</span>
    <span class="n">post_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_pseudo_counts&#39;</span>
    <span class="n">noise_1</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compute_noise</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">sim_target</span><span class="p">,</span> <span class="n">post_label</span><span class="p">))</span>
    <span class="n">discriminants</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">compute_noise</span><span class="p">(</span><span class="n">probabilities</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">post_label</span><span class="p">))</span>
    <span class="n">post_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bin_midpoints</span><span class="p">,</span> <span class="n">probabilities</span><span class="p">[</span><span class="n">post_label</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">prior</span><span class="p">),</span>
                 <span class="n">line_width</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">TolRainbow14</span><span class="p">[</span><span class="n">n</span><span class="p">])</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>

<span class="n">post_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Flow}</span><span class="s1"> [m^3/s]$$&#39;</span>
<span class="n">post_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Pr}</span><span class="s1">(X)$$&#39;</span>
<span class="c1"># post_fig.legend.location = &quot;top_left&quot;</span>
<span class="n">post_fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">post_fig</span><span class="o">.</span><span class="n">legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">post_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
<span class="n">post_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">post_fig</span><span class="p">)</span>

<span class="n">noise_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">450</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">priors</span><span class="p">,</span> <span class="n">noise_1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> 
               <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;DKL(Q||Q_post)&#39;</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">priors</span><span class="p">,</span> <span class="n">discriminants</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;DKL(P||Q_post)&#39;</span><span class="p">)</span>

<span class="n">noise_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Prior } (\alpha =  10^x) \text{ Pseudo-Counts} $$&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$D_\text</span><span class="si">{KL}</span><span class="s1">(P||Q_\text</span><span class="si">{approx}</span><span class="s1">)$$&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_right&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
<span class="n">noise_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">noise_fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>-3.0_pseudo_counts
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">([</span><span class="n">post_fig</span><span class="p">,</span> <span class="n">noise_fig</span><span class="p">],</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="f846c9fa-e311-4e39-9971-6d55b1f3d575" data-root-id="p1527" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"f9f29eee-9222-4bc2-9a11-3ade9c1fc067":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"GridPlot","id":"p1527","attributes":{"rows":null,"cols":null,"toolbar":{"type":"object","name":"Toolbar","id":"p1526","attributes":{"tools":[{"type":"object","name":"ToolProxy","id":"p1520","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1351"},{"type":"object","name":"PanTool","id":"p1486"}]}},{"type":"object","name":"ToolProxy","id":"p1521","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1352","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1487","attributes":{"renderers":"auto"}}]}},{"type":"object","name":"ToolProxy","id":"p1522","attributes":{"tools":[{"type":"object","name":"BoxZoomTool","id":"p1353","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1354","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1360","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1359","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1488","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1489","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1495","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1494","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}}]}},{"type":"object","name":"SaveTool","id":"p1523"},{"type":"object","name":"ToolProxy","id":"p1524","attributes":{"tools":[{"type":"object","name":"ResetTool","id":"p1362"},{"type":"object","name":"ResetTool","id":"p1497"}]}},{"type":"object","name":"ToolProxy","id":"p1525","attributes":{"tools":[{"type":"object","name":"HelpTool","id":"p1363"},{"type":"object","name":"HelpTool","id":"p1498"}]}}]}},"children":[[{"type":"object","name":"Figure","id":"p1330","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1331"},"y_range":{"type":"object","name":"DataRange1d","id":"p1332"},"x_scale":{"type":"object","name":"LogScale","id":"p1339"},"y_scale":{"type":"object","name":"LinearScale","id":"p1340"},"title":{"type":"object","name":"Title","id":"p1337"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1370","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1364","attributes":{"selected":{"type":"object","name":"Selection","id":"p1365","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1366"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"I/US5HiqEj+0bxxWtf8rPyP1EuR4qjI/x1OVAMj/RD8FFr63GLvGP+PvCua7ibk/IBvUddDTsT+UhejNyLLEP2gCGZ9WhL8/q/3fAKx/vz8Hg93ubCa3PyGWs6ccQbU/BSR+shC9qT9DvGZ5eXKSP3pd8hwlFWI/AAAAAAAAAAA="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1371","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1372"}}},"glyph":{"type":"object","name":"Line","id":"p1367","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":3,"line_dash":[6]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1368","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":3,"line_dash":[6]}},"muted_glyph":{"type":"object","name":"Line","id":"p1369","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":3,"line_dash":[6]}}}},{"type":"object","name":"GlyphRenderer","id":"p1381","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1375","attributes":{"selected":{"type":"object","name":"Selection","id":"p1376","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1377"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"gPOtZSYdcz6A861lJh1zPoDzrWUmHXM+gPOtZSYdcz6A861lJh1zPoA02mtr1VM/Fo2uJm2oxj9mR+ztypPDP+2bBSDS88A//flH63hdwj9W6akiJCrCP6ez7wVy4cQ/EqrSZHXesz/c9skOe9qEP0dL5cg+rxI/gPOtZSYdcz4="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1382","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1383"}}},"glyph":{"type":"object","name":"Line","id":"p1378","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#D1BBD7","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1379","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#D1BBD7","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1380","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#D1BBD7","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1391","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1385","attributes":{"selected":{"type":"object","name":"Selection","id":"p1386","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1387"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"CUQR8V/kpz4JRBHxX+SnPglEEfFf5Kc+CUQR8V/kpz4JRBHxX+SnPiL3mC8O2FM/8MEuTWOoxj8Iplsmw5PDP26g/xvM88A/x5g99HFdwj+vrR1OHSrCPyUeK15p4cQ/QPhEy3Lesz8WRncOw9qEP6+fN7Qz2hI/CUQR8V/kpz4="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1392","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1393"}}},"glyph":{"type":"object","name":"Line","id":"p1388","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#AA6F9E","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1389","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#AA6F9E","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1390","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#AA6F9E","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1401","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1395","attributes":{"selected":{"type":"object","name":"Selection","id":"p1396","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1397"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"BKe6Q6/c3T4Ep7pDr9zdPgSnukOv3N0+BKe6Q6/c3T4Ep7pDr9zdPpCtPRJp8lM/28oI0QCoxj8QUvRcdZPDP2JqgPWP88A/oZLYTyxdwj/SKZwC2SnCP1L7/NIS4cQ/Jyx8zFjesz9zC3P2kt2EP9NSkH64hxQ/BKe6Q6/c3T4="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1402","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1403"}}},"glyph":{"type":"object","name":"Line","id":"p1398","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#882E72","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1399","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#882E72","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1400","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#882E72","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1411","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1405","attributes":{"selected":{"type":"object","name":"Selection","id":"p1406","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1407"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"USoB0AilEj9RKgHQCKUSP1EqAdAIpRI/USoB0AilEj9RKgHQCKUSP5tPAeqp+VQ/Q2qXEymkxj8HOUNfbJDDPxMPAyI38cA/pyXBrHRawj9zIoXULifCP9tNyVyy3cQ/1T2dI1Xdsz+bTwHqqfmEP1EqAdAIpSI/USoB0AilEj8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1412","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1413"}}},"glyph":{"type":"object","name":"Line","id":"p1408","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1965B0","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1409","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1965B0","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1410","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#1965B0","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1421","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1415","attributes":{"selected":{"type":"object","name":"Selection","id":"p1416","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1417"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Tjhti84RRz9OOG2LzhFHP044bYvOEUc/Tjhti84RRz9OOG2LzhFHP2ly09XWJF8/TH2KYSl+xj+qEVUcaXLDPyHI2N8B2sA/CuVJ4ZU/wj/B9OMa1QzCP4Kr6yVOvMQ/Y9zRf03Tsz8KcSCCbQ+GP1Yk+DJjYEk/Tjhti84RRz8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1422","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1423"}}},"glyph":{"type":"object","name":"Line","id":"p1418","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#5289C7","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1419","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#5289C7","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1420","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#5289C7","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1431","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1425","attributes":{"selected":{"type":"object","name":"Selection","id":"p1426","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1427"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"cEIvYrwuej9wQi9ivC56P3BCL2K8Lno/cEIvYrwuej9wQi9ivC56P+9A4HIzon4/fm5Y/6UoxT8ThfkErGTCP7JYI/xsCcA/6dXk6BZOwT/bBzgYAiDBP3HAXFEzkMM/alkG6Sh5sz8fV0v30s+PP7ScKmPDcXo/cEIvYrwuej8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1432","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1433"}}},"glyph":{"type":"object","name":"Line","id":"p1428","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7BAFDE","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1429","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7BAFDE","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1430","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#7BAFDE","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1441","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1435","attributes":{"selected":{"type":"object","name":"Selection","id":"p1436","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1437"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"vKa8B6sKoT+8prwHqwqhP7ymvAerCqE/vKa8B6sKoT+8prwHqwqhPwe9mlzVVKE/2FbUZiG0vT8TTPjt1tK6P6z4gIidXrg/HTE53riwuT+iE0CYu4C5P7WLyzTFCrw/zfBx9/zOsT8BJmOVh3qjP996jd8HD6E/vKa8B6sKoT8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1442","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1443"}}},"glyph":{"type":"object","name":"Line","id":"p1438","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#4EB265","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1439","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#4EB265","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1440","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#4EB265","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1451","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1445","attributes":{"selected":{"type":"object","name":"Selection","id":"p1446","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1447"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Ta4xHPhqrT9NrjEc+GqtP02uMRz4aq0/Ta4xHPhqrT9NrjEc+GqtP8zxgZbFd60/nmnnhJVdsj9FcLqIT96xP1wHi17dcbE/tuDpzzqssT/rllsX8qOxP+tPVzgoFLI/pvAWI+xPsD+YbWt7qdatP+tXJ+e4a60/Ta4xHPhqrT8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1452","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1453"}}},"glyph":{"type":"object","name":"Line","id":"p1448","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#90C987","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1449","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#90C987","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1450","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#90C987","line_alpha":0.2,"line_width":2.5}}}},{"type":"object","name":"GlyphRenderer","id":"p1461","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1455","attributes":{"selected":{"type":"object","name":"Selection","id":"p1456","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1457"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"M0Tm3Fx+xD+ASmDyPAzRP8aOEDzeXNw/huZ4JgaY5z9ctgD1c6DzPxQKX+ejUwBAQh74xL8pC0DPtfJIi5gWQP5M6PHtyyJAAfJ+drNFL0CafELdngM6QMJQu9Heo0VAQy19MGUAUkD2rXzDE/NdQFMk9Nru6WhAqEyRvYu5dEA="},"shape":[16],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"Nreeari4rz82t55quLivPza3nmq4uK8/Nreeari4rz82t55quLivP8tJitQZuq8/ycB5/UxBsD9d00SkkzOwP5/b8QTiJ7A/n7uUKy0usD9d86F9SC2wPwvp7g5iObA/lXrAPJ4IsD+S4vI/VcSvP5mDnTTNuK8/Nreeari4rz8="},"shape":[16],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1462","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1463"}}},"glyph":{"type":"object","name":"Line","id":"p1458","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#CAE0AB","line_width":2.5}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1459","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#CAE0AB","line_alpha":0.1,"line_width":2.5}},"muted_glyph":{"type":"object","name":"Line","id":"p1460","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"#CAE0AB","line_alpha":0.2,"line_width":2.5}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1338","attributes":{"tools":[{"id":"p1351"},{"id":"p1352"},{"id":"p1353"},{"type":"object","name":"SaveTool","id":"p1361"},{"id":"p1362"},{"id":"p1363"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1346","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1347","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1348"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1349"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"right":[{"type":"object","name":"Legend","id":"p1373","attributes":{"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1374","attributes":{"label":{"type":"value","value":"P(x)"},"renderers":[{"id":"p1370"}]}},{"type":"object","name":"LegendItem","id":"p1384","attributes":{"label":{"type":"value","value":"-3.0"},"renderers":[{"id":"p1381"}]}},{"type":"object","name":"LegendItem","id":"p1394","attributes":{"label":{"type":"value","value":"-2.0"},"renderers":[{"id":"p1391"}]}},{"type":"object","name":"LegendItem","id":"p1404","attributes":{"label":{"type":"value","value":"-1.0"},"renderers":[{"id":"p1401"}]}},{"type":"object","name":"LegendItem","id":"p1414","attributes":{"label":{"type":"value","value":"0.0"},"renderers":[{"id":"p1411"}]}},{"type":"object","name":"LegendItem","id":"p1424","attributes":{"label":{"type":"value","value":"1.0"},"renderers":[{"id":"p1421"}]}},{"type":"object","name":"LegendItem","id":"p1434","attributes":{"label":{"type":"value","value":"2.0"},"renderers":[{"id":"p1431"}]}},{"type":"object","name":"LegendItem","id":"p1444","attributes":{"label":{"type":"value","value":"3.0"},"renderers":[{"id":"p1441"}]}},{"type":"object","name":"LegendItem","id":"p1454","attributes":{"label":{"type":"value","value":"4.0"},"renderers":[{"id":"p1451"}]}},{"type":"object","name":"LegendItem","id":"p1464","attributes":{"label":{"type":"value","value":"5.0"},"renderers":[{"id":"p1461"}]}}]}}],"below":[{"type":"object","name":"LogAxis","id":"p1341","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1342","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1343"},"axis_label":"$$\\text{Flow} [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1344"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1345","attributes":{"axis":{"id":"p1341"}}},{"type":"object","name":"Grid","id":"p1350","attributes":{"dimension":1,"axis":{"id":"p1346"}}},{"id":"p1373"}]}},0,0],[{"type":"object","name":"Figure","id":"p1465","attributes":{"width":500,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1466"},"y_range":{"type":"object","name":"DataRange1d","id":"p1467"},"x_scale":{"type":"object","name":"LinearScale","id":"p1474"},"y_scale":{"type":"object","name":"LinearScale","id":"p1475"},"title":{"type":"object","name":"Title","id":"p1472"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1505","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1499","attributes":{"selected":{"type":"object","name":"Selection","id":"p1500","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1501"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAACMAAAAAAAAAAwAAAAAAAAPC/AAAAAAAAAAAAAAAAAADwPwAAAAAAAABAAAAAAAAACEAAAAAAAAAQQAAAAAAAABRA"},"shape":[9],"dtype":"float64","order":"little"}],["y",[6.164147073976107e-07,6.1689733696647345e-06,6.214409805695912e-05,0.0006504055024352093,0.007124539208913346,0.07397331848034853,0.481043425057036,1.016132164919094,1.1459219216115084]]]}}},"view":{"type":"object","name":"CDSView","id":"p1506","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1507"}}},"glyph":{"type":"object","name":"Line","id":"p1502","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"crimson","line_width":3,"line_dash":[2,4]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1503","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"crimson","line_alpha":0.1,"line_width":3,"line_dash":[2,4]}},"muted_glyph":{"type":"object","name":"Line","id":"p1504","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"crimson","line_alpha":0.2,"line_width":3,"line_dash":[2,4]}}}},{"type":"object","name":"GlyphRenderer","id":"p1516","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1510","attributes":{"selected":{"type":"object","name":"Selection","id":"p1511","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1512"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAACMAAAAAAAAAAwAAAAAAAAPC/AAAAAAAAAAAAAAAAAADwPwAAAAAAAABAAAAAAAAACEAAAAAAAAAQQAAAAAAAABRA"},"shape":[9],"dtype":"float64","order":"little"}],["y",[4.157200966808035,3.563159951036342,2.968268844320832,2.3658883538690842,1.7166468287634447,0.9867017693264234,0.6110705021426843,0.7569292764193615,0.8149018647067838]]]}}},"view":{"type":"object","name":"CDSView","id":"p1517","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1518"}}},"glyph":{"type":"object","name":"Line","id":"p1513","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":3}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1514","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":3}},"muted_glyph":{"type":"object","name":"Line","id":"p1515","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":3}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1473","attributes":{"tools":[{"id":"p1486"},{"id":"p1487"},{"id":"p1488"},{"type":"object","name":"SaveTool","id":"p1496"},{"id":"p1497"},{"id":"p1498"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1481","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1482","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1483"},"axis_label":"$$D_\\text{KL}(P||Q_\\text{approx})$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1484"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1476","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1477","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1478"},"axis_label":"$$\\text{Prior } (\\alpha =  10^x) \\text{ Pseudo-Counts} $$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1479"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1480","attributes":{"axis":{"id":"p1476"}}},{"type":"object","name":"Grid","id":"p1485","attributes":{"dimension":1,"axis":{"id":"p1481"}}},{"type":"object","name":"Legend","id":"p1508","attributes":{"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1509","attributes":{"label":{"type":"value","value":"DKL(Q||Q_post)"},"renderers":[{"id":"p1505"}]}},{"type":"object","name":"LegendItem","id":"p1519","attributes":{"label":{"type":"value","value":"DKL(P||Q_post)"},"renderers":[{"id":"p1516"}]}}]}}]}},0,1]]}}]}};
  const render_items = [{"docid":"f9f29eee-9222-4bc2-9a11-3ade9c1fc067","roots":{"p1527":"f846c9fa-e311-4e39-9971-6d55b1f3d575"},"root_ids":["p1527"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>To address incomplete support coverage of the “ground truth” <span class="math notranslate nohighlight">\(P(x)\)</span> by the simulated <span class="math notranslate nohighlight">\(Q(x)\)</span> distribution in the discrete representation, we assume a Dirichlet prior on <span class="math notranslate nohighlight">\(Q(x)\)</span> representing pseud-counts representing the posterior <span class="math notranslate nohighlight">\(Q\)</span> the form <span class="math notranslate nohighlight">\(\text{Dirichlet}(10^\alpha + n_i)\)</span>, where <span class="math notranslate nohighlight">\(n_i\)</span> represents the number of observations in each category <span class="math notranslate nohighlight">\(i\)</span>.</p>
<p>The plot above-left shows the flattening influence of the increasing prior on the approximated distribution <span class="math notranslate nohighlight">\(Q(x)\)</span> against the “ground truth” <span class="math notranslate nohighlight">\(P(X)\)</span>, where the choice of prior has minimal effect below approximately <span class="math notranslate nohighlight">\(10^1\)</span> pseudo-counts.  At right, the dashed red line shows that the influence of the prior (<span class="math notranslate nohighlight">\(D_\text{KL}(Q||Q_\text{post})\)</span>) is very small until the prior grows beyond <span class="math notranslate nohighlight">\(10^1\)</span> t, and eventually the .  The plot above right compares how the noise added by the prior compares to the sensitivity of the discriminant to the prior.  If the noise added by the prior (red dotted line) is greater than the discriminant (black line), then the discriminant isn’t meaningful to use in a decision.</p>
<p>Smaller priors preserve information in the approximate distribution <span class="math notranslate nohighlight">\(Q\)</span> and add negligible noise, but smaller priors (on <span class="math notranslate nohighlight">\(Q\)</span>) inflate the KL divergence between the simulated (<span class="math notranslate nohighlight">\(Q\)</span>) and “ground truth” (<span class="math notranslate nohighlight">\(P\)</span>) distributions, in particular where the simulation does not provide support coverage of the ground truth.  The result at right shows there is more to consider about the effect of the prior than just how it influences the posterior <span class="math notranslate nohighlight">\(Q\)</span>.</p>
<p>In general the prior should be chosen to minimize influence on the input distributions, however the plot at right also shows that where the prior is minimized, the noise added to <span class="math notranslate nohighlight">\(Q\)</span> is roughly equal to the discriminant, which erases its meaning.  Next we run this analysis on a sample of <span class="math notranslate nohighlight">\(6\times10^5\)</span> pairwise comparisons to see how much the prior influence on the discriminant and the posterior <span class="math notranslate nohighlight">\(Q\)</span> varies over a wide range of simple equal unit area runoff regional transfer simulations.</p>
<p>The point of the comparison is that the noise due to the prior can “push” <span class="math notranslate nohighlight">\(Q\)</span> further away from <span class="math notranslate nohighlight">\(P\)</span>, and it can also bring it closer.  Since we can’t know this a priori, we should ensure that regardless of the direction the different sources of epistemic noise “pushes” <strong>both</strong> <span class="math notranslate nohighlight">\(P\)</span> and <span class="math notranslate nohighlight">\(P\)</span> relative to each other should not be significant in comparison to the magnitude of the discriminant.  The example below illustrates how the prior flattens <span class="math notranslate nohighlight">\(Q\)</span> and it can make it more or less similar to the target <span class="math notranslate nohighlight">\(P\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">generate_and_plot_lognormal</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">prior_pseudo_count</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates two log-normal distributions, quantizes them with 2^b symbols,</span>
<span class="sd">    applies a uniform pseudo-count prior to one, and plots the distributions</span>
<span class="sd">    with Bokeh (including the posterior as a dashed line).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - mu1, sigma1: Parameters for the first log-normal distribution.</span>
<span class="sd">    - mu2, sigma2: Parameters for the second log-normal distribution.</span>
<span class="sd">    - b: Number of symbols = 2^b for quantization.</span>
<span class="sd">    - prior_pseudo_count: Uniform pseudo-count to apply to one distribution.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the two log-normal distributions</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mi">5</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>  <span class="c1"># Values over which distributions are evaluated</span>
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">mu1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma1</span><span class="p">)</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">mu2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">sigma2</span><span class="p">)</span>

    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bins_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Create the continuous log-normal distributions evaluated at the midpoints</span>
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu1</span><span class="p">))</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu2</span><span class="p">))</span>

    <span class="n">dist3</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu1</span><span class="p">))</span>
    <span class="n">dist4</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu2</span><span class="p">))</span>

    <span class="c1"># Quantize the distributions</span>
    <span class="c1"># Normalize the distributions to form proper PDFs over the quantized bins</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">dist1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist1</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">dist2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span>

    <span class="c1"># Apply the uniform prior as pseudo-counts to the second distribution</span>
    <span class="n">prior_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">prior_pseudo_count</span><span class="p">)</span>
    <span class="n">posterior_counts</span> <span class="o">=</span> <span class="n">prior_counts</span> <span class="o">+</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span>  <span class="c1"># Bayesian update</span>
    <span class="n">R</span> <span class="o">=</span> <span class="n">posterior_counts</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posterior_counts</span><span class="p">)</span>  <span class="c1"># Renormalize</span>

    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">P</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;P does not sum to 1&#39;</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">Q</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;Q does not sum to 1&#39;</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;Q_hat does not sum to 1&#39;</span>

    <span class="n">kl_pq</span> <span class="o">=</span> <span class="n">kl_div</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>
    <span class="n">kl_pr</span> <span class="o">=</span> <span class="n">kl_div</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

    <span class="c1"># Prepare data for Bokeh plotting</span>
    <span class="n">source1</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">P</span><span class="p">))</span>
    <span class="n">source2</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">Q</span><span class="p">))</span>
    <span class="n">source2_posterior</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">R</span><span class="p">))</span>

    <span class="c1"># Create the Bokeh plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span>
               <span class="n">x_axis_label</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Pr}</span><span class="s1">(X)$$&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">350</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source1</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;P(x)=LN(x|</span><span class="si">{</span><span class="n">mu1</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sigma1</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source2</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q(x)=LN(x|</span><span class="si">{</span><span class="n">mu2</span><span class="si">:</span><span class="s2">.1f</span><span class="si">}</span><span class="s2">,</span><span class="si">{</span><span class="n">sigma2</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;x&#39;</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source2_posterior</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span>
           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Q_hat(X) (Prior=</span><span class="si">{</span><span class="n">prior_pseudo_count</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>

    <span class="c1"># Configure the legend and show the plot</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_right&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>

    <span class="k">return</span> <span class="n">p</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">kl_pq</span><span class="p">),</span> <span class="nb">sum</span><span class="p">(</span><span class="n">kl_pr</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.35</span>
<span class="n">p1</span><span class="p">,</span> <span class="n">klpq1</span><span class="p">,</span> <span class="n">klpr1</span> <span class="o">=</span> <span class="n">generate_and_plot_lognormal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">sigma</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.035</span><span class="p">))</span>
<span class="n">p2</span><span class="p">,</span> <span class="n">klpq2</span><span class="p">,</span> <span class="n">klpr2</span> <span class="o">=</span> <span class="n">generate_and_plot_lognormal</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mf">0.01</span><span class="p">,</span> <span class="n">sigma</span><span class="o">+</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mf">0.03</span><span class="p">)</span>
<span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p1</span><span class="p">),</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span>

<span class="n">kl1_text</span> <span class="o">=</span> <span class="s2">&quot;    --&gt;Q is closer to P than Q_hat&quot;</span>
<span class="k">if</span> <span class="n">klpr1</span> <span class="o">&lt;</span> <span class="n">klpq1</span><span class="p">:</span>
    <span class="n">kl1_text</span> <span class="o">=</span> <span class="s2">&quot;    --&gt;Q hat is closer to P than Q^&quot;</span>
<span class="n">kl2_text</span> <span class="o">=</span> <span class="s2">&quot;    --&gt;Q is closer to P than Q_hat&quot;</span>
<span class="k">if</span> <span class="n">klpr2</span> <span class="o">&lt;</span> <span class="n">klpq2</span><span class="p">:</span>
    <span class="n">kl2_text</span> <span class="o">=</span> <span class="s2">&quot;    --&gt;Q_hat is closer to P than Q_hat&quot;</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DKL_1(P||Q) = </span><span class="si">{</span><span class="n">klpq1</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, DKL(P||Q_hat) = </span><span class="si">{</span><span class="n">klpr1</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kl1_text</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;DKL_2(P||Q) = </span><span class="si">{</span><span class="n">klpq2</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">, DKL(P||Q_hat) = </span><span class="si">{</span><span class="n">klpr2</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">kl2_text</span><span class="p">)</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">([</span><span class="n">p1</span><span class="p">,</span> <span class="n">p2</span><span class="p">],</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">350</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DKL_1(P||Q) = 0.14, DKL(P||Q_hat) = 0.10
    --&gt;Q hat is closer to P than Q^
DKL_2(P||Q) = 0.05, DKL(P||Q_hat) = 0.12
    --&gt;Q is closer to P than Q_hat
</pre></div>
</div>
<div class="output text_html">
  <div id="a25292c7-9219-44a5-8e88-d2745281d310" data-root-id="p1710" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"b7ffda58-9fb6-419e-b2da-287abe148d6c":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"GridPlot","id":"p1710","attributes":{"rows":null,"cols":null,"toolbar":{"type":"object","name":"Toolbar","id":"p1709","attributes":{"tools":[{"type":"object","name":"ToolProxy","id":"p1703","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1583"},{"type":"object","name":"PanTool","id":"p1659"}]}},{"type":"object","name":"ToolProxy","id":"p1704","attributes":{"tools":[{"type":"object","name":"WheelZoomTool","id":"p1584","attributes":{"renderers":"auto"}},{"type":"object","name":"WheelZoomTool","id":"p1660","attributes":{"renderers":"auto"}}]}},{"type":"object","name":"ToolProxy","id":"p1705","attributes":{"tools":[{"type":"object","name":"BoxZoomTool","id":"p1585","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1586","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1592","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1591","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"BoxZoomTool","id":"p1661","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1662","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1668","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1667","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}}]}},{"type":"object","name":"SaveTool","id":"p1706"},{"type":"object","name":"ToolProxy","id":"p1707","attributes":{"tools":[{"type":"object","name":"ResetTool","id":"p1594"},{"type":"object","name":"ResetTool","id":"p1670"}]}},{"type":"object","name":"ToolProxy","id":"p1708","attributes":{"tools":[{"type":"object","name":"HelpTool","id":"p1595"},{"type":"object","name":"HelpTool","id":"p1671"}]}}]}},"children":[[{"type":"object","name":"Figure","id":"p1560","attributes":{"width":500,"height":350,"x_range":{"type":"object","name":"DataRange1d","id":"p1562"},"y_range":{"type":"object","name":"Range1d","id":"p1570","attributes":{"end":0.035}},"x_scale":{"type":"object","name":"LinearScale","id":"p1571"},"y_scale":{"type":"object","name":"LinearScale","id":"p1572"},"title":{"type":"object","name":"Title","id":"p1563"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1602","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1551","attributes":{"selected":{"type":"object","name":"Selection","id":"p1552","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1553"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1603","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1604"}}},"glyph":{"type":"object","name":"Line","id":"p1599","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1600","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1601","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1613","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1554","attributes":{"selected":{"type":"object","name":"Selection","id":"p1555","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1556"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1614","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1615"}}},"glyph":{"type":"object","name":"Line","id":"p1610","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1611","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1612","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1623","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1557","attributes":{"selected":{"type":"object","name":"Selection","id":"p1558","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1559"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1624","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1625"}}},"glyph":{"type":"object","name":"Line","id":"p1620","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_width":2,"line_dash":[6]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1621","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.1,"line_width":2,"line_dash":[6]}},"muted_glyph":{"type":"object","name":"Line","id":"p1622","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.2,"line_width":2,"line_dash":[6]}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1569","attributes":{"tools":[{"id":"p1583"},{"id":"p1584"},{"id":"p1585"},{"type":"object","name":"SaveTool","id":"p1593"},{"id":"p1594"},{"id":"p1595"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1578","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1579","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1580"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1581"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1573","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1574","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1575"},"axis_label":"x","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1576"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1577","attributes":{"axis":{"id":"p1573"}}},{"type":"object","name":"Grid","id":"p1582","attributes":{"dimension":1,"axis":{"id":"p1578"}}},{"type":"object","name":"Legend","id":"p1605","attributes":{"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1606","attributes":{"label":{"type":"value","value":"P(x)=LN(x|0.2,0.35)"},"renderers":[{"id":"p1602"}]}},{"type":"object","name":"LegendItem","id":"p1616","attributes":{"label":{"type":"value","value":"Q(x)=LN(x|0.3,0.25)"},"renderers":[{"id":"p1613"}]}},{"type":"object","name":"LegendItem","id":"p1626","attributes":{"label":{"type":"value","value":"Q_hat(X) (Prior=0.03)"},"renderers":[{"id":"p1623"}]}}]}}]}},0,0],[{"type":"object","name":"Figure","id":"p1636","attributes":{"width":500,"height":350,"x_range":{"type":"object","name":"DataRange1d","id":"p1638"},"y_range":{"type":"object","name":"Range1d","id":"p1646","attributes":{"end":0.035}},"x_scale":{"type":"object","name":"LinearScale","id":"p1647"},"y_scale":{"type":"object","name":"LinearScale","id":"p1648"},"title":{"type":"object","name":"Title","id":"p1639"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1678","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1627","attributes":{"selected":{"type":"object","name":"Selection","id":"p1628","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1629"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1679","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1680"}}},"glyph":{"type":"object","name":"Line","id":"p1675","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1676","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1677","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1689","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1630","attributes":{"selected":{"type":"object","name":"Selection","id":"p1631","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1632"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1690","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1691"}}},"glyph":{"type":"object","name":"Line","id":"p1686","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1687","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1688","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1699","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1633","attributes":{"selected":{"type":"object","name":"Selection","id":"p1634","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1635"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"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"},"shape":[256],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1700","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1701"}}},"glyph":{"type":"object","name":"Line","id":"p1696","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_width":2,"line_dash":[6]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1697","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.1,"line_width":2,"line_dash":[6]}},"muted_glyph":{"type":"object","name":"Line","id":"p1698","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.2,"line_width":2,"line_dash":[6]}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1645","attributes":{"tools":[{"id":"p1659"},{"id":"p1660"},{"id":"p1661"},{"type":"object","name":"SaveTool","id":"p1669"},{"id":"p1670"},{"id":"p1671"}]}},"toolbar_location":null,"left":[{"type":"object","name":"LinearAxis","id":"p1654","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1655","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1656"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1657"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LinearAxis","id":"p1649","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1650","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1651"},"axis_label":"x","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1652"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1653","attributes":{"axis":{"id":"p1649"}}},{"type":"object","name":"Grid","id":"p1658","attributes":{"dimension":1,"axis":{"id":"p1654"}}},{"type":"object","name":"Legend","id":"p1681","attributes":{"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1682","attributes":{"label":{"type":"value","value":"P(x)=LN(x|0.2,0.35)"},"renderers":[{"id":"p1678"}]}},{"type":"object","name":"LegendItem","id":"p1692","attributes":{"label":{"type":"value","value":"Q(x)=LN(x|0.3,0.45)"},"renderers":[{"id":"p1689"}]}},{"type":"object","name":"LegendItem","id":"p1702","attributes":{"label":{"type":"value","value":"Q_hat(X) (Prior=0.03)"},"renderers":[{"id":"p1699"}]}}]}}]}},0,1]]}}]}};
  const render_items = [{"docid":"b7ffda58-9fb6-419e-b2da-287abe148d6c","roots":{"p1710":"a25292c7-9219-44a5-8e88-d2745281d310"},"root_ids":["p1710"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
</section>
<section id="quantization-noise">
<h1>Quantization Noise<a class="headerlink" href="#quantization-noise" title="Link to this heading">#</a></h1>
<p>The discrete representation of a probability distribution also adds noise where the quantization resolution limits the number of unique observed values to the number of symbols defined in the dictionary.  A 4-bit quantization was shown earlier in this notebook which provides 16 distinct symbols which are defined by ranges of continuous values.  Quantization reduces variance because all values mapped to the same symbol through quantization are treated as equal.  As discussed previously in this notebook, a dictionary with enough symbols preserves all unique values from the original time series.  Decreasing the dictionary size has the effect of smoothing the distribution, since the resulting frequency of consolidated bins averages larger subsets of the sample.  The loss of variance from this smoothing changes the frequency estimates, and thus is a form of noise.</p>
<p>The example that follows computes the discrete distribution frequencies estimated from a 5-bit (32 symbol) dictionary and those from a 4-bit (16 symbol) dictionary, and computes the KL divergence between the two to express the divergence of the lower-resolution distribution (<span class="math notranslate nohighlight">\(Q_{b=4}\)</span>) from the higher (<span class="math notranslate nohighlight">\(Q_{b=5}\)</span>).  Also plotted in the example are log-normal, exponential distributions, and 4-parameter kappa distributions fit to the data using Maximum Likelihood Estimation (MLE) for the best-fit parameters.  These extra series are included to compare the fit of several parametric distributions widely used in hydrology, and to serve as a preview and a conceptual link to a subsequent exercise linking the current analysis of quantization noise to an analogous “noise” quantity related to parametric distribution fitting error, or “parametric fit noise”.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">,</span> <span class="n">category</span><span class="o">=</span><span class="ne">RuntimeWarning</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">neg_log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
    <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">params</span>
    <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>  <span class="c1"># Enforce positive scale</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">logpdf</span> <span class="o">=</span> <span class="n">kappa4</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">logpdf</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">logpdf</span><span class="p">)):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">logpdf</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>

<span class="k">def</span> <span class="nf">fit_kappa4_mle</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="c1"># Handle edge cases where MLE is not feasible</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">}</span>
    
    <span class="c1"># Define the initial guesses for the parameters</span>
    <span class="n">initial_params</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)]</span>
    
    <span class="c1"># Bounds for the parameters: h and k between -2 and 2, scale &gt; 1e-5</span>
    <span class="n">bounds</span> <span class="o">=</span> <span class="p">[(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">),</span> <span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">),</span> <span class="p">(</span><span class="mf">1e-5</span><span class="p">,</span> <span class="kc">None</span><span class="p">)]</span>
    
    <span class="c1"># Minimize the negative log-likelihood</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span><span class="n">neg_log_likelihood</span><span class="p">,</span> <span class="n">initial_params</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;L-BFGS-B&#39;</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="n">bounds</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="c1"># Log or handle fitting failure if needed</span>
    
    <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">loc</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">scale</span><span class="p">}</span>

<span class="k">def</span> <span class="nf">compute_pdf_cdf_kde_scipy</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">grid_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">bandwidth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Computes the probability density function (pdf) and cumulative distribution function (cdf)</span>
<span class="sd">    from an array of values using Kernel Density Estimation (KDE) with scipy.stats.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    data (array-like): Input data array.</span>
<span class="sd">    grid_points (int): Number of points in the grid where the pdf and cdf are evaluated.</span>
<span class="sd">    bandwidth (float or str, optional): The bandwidth of the kernel. If None, Scott&#39;s Rule is used.</span>
<span class="sd">                                         Can also be a string for methods like &#39;scott&#39; or &#39;silverman&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">    x_grid (numpy.ndarray): Grid points where the pdf and cdf are evaluated.</span>
<span class="sd">    pdf_values (numpy.ndarray): Estimated pdf values corresponding to x_grid.</span>
<span class="sd">    cdf_values (numpy.ndarray): Estimated cdf values corresponding to x_grid.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert input data to a numpy array</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Create a Gaussian KDE object</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bandwidth</span><span class="p">)</span>
    
    <span class="c1"># Create a grid over which to evaluate the KDE</span>
    <span class="n">x_min</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">x_max</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1.0</span> <span class="o">*</span> <span class="n">data</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
    <span class="n">x_grid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">x_min</span><span class="p">,</span> <span class="n">x_max</span><span class="p">,</span> <span class="n">grid_points</span><span class="p">)</span>
    
    <span class="c1"># Evaluate the pdf over the grid</span>
    <span class="n">pdf_values</span> <span class="o">=</span> <span class="n">kde</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">x_grid</span><span class="p">)</span>
    
    <span class="c1"># Compute the cdf by integrating the pdf</span>
    <span class="n">cdf_values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kde</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">xi</span><span class="p">)</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">x_grid</span><span class="p">])</span>
    
    <span class="k">return</span> <span class="n">x_grid</span><span class="p">,</span> <span class="n">pdf_values</span><span class="p">,</span> <span class="n">cdf_values</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_ecdf</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the empirical CDF of a dataset.&quot;&quot;&quot;</span>
    <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    <span class="k">return</span> <span class="n">sorted_data</span><span class="p">,</span> <span class="n">y</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_discrete_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># 1. Determine the log-spaced bin edges</span>
    <span class="n">bin_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">total_count</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># 1. Compute the histogram using equal-width bins</span>
    <span class="n">counts</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">b</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">densities</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">b</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">bin_widths</span> <span class="o">=</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> 
    <span class="n">bin_dict</span><span class="p">[</span><span class="s1">&#39;equal&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="n">freqs</span><span class="p">,</span> <span class="s1">&#39;densities&#39;</span><span class="p">:</span> <span class="n">densities</span><span class="p">,</span> <span class="s1">&#39;widths&#39;</span><span class="p">:</span> <span class="n">bin_widths</span><span class="p">}</span>

    <span class="c1"># 2. Compute the histogram using log-spaced bins</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">log_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">minx</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">maxx</span><span class="p">),</span> <span class="mi">2</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bin_widths</span> <span class="o">=</span> <span class="n">log_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">log_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">log_densities</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">log_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">log_counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">log_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">log_freqs</span> <span class="o">=</span> <span class="n">log_counts</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">log_counts</span><span class="p">)</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">log_freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="nb">sum</span><span class="p">(</span><span class="n">log_freqs</span><span class="p">)</span>
    <span class="n">bin_dict</span><span class="p">[</span><span class="s1">&#39;log&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">log_edges</span><span class="p">,</span> <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="n">log_freqs</span><span class="p">,</span> <span class="s1">&#39;densities&#39;</span><span class="p">:</span> <span class="n">densities</span><span class="p">,</span> <span class="s1">&#39;widths&#39;</span><span class="p">:</span> <span class="n">bin_widths</span><span class="p">}</span>

    <span class="c1"># 3. Compute the histogram using uniform (probability) bins</span>
    <span class="n">quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">uniform_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">quantiles</span><span class="p">)</span>
    <span class="n">bin_widths</span> <span class="o">=</span> <span class="n">uniform_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">-</span> <span class="n">uniform_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">uniform_freqs</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">uniform_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">uniform_counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">uniform_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">uniform_freqs</span> <span class="o">=</span> <span class="n">uniform_counts</span> <span class="o">/</span> <span class="n">total_count</span>
    <span class="c1"># assert abs(sum(uniform_freqs) - 1) &lt; 0.001, sum(uniform_freqs)</span>
    <span class="n">bin_dict</span><span class="p">[</span><span class="s1">&#39;uniform&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;edges&#39;</span><span class="p">:</span> <span class="n">uniform_edges</span><span class="p">,</span> <span class="s1">&#39;freqs&#39;</span><span class="p">:</span> <span class="n">uniform_freqs</span><span class="p">,</span> <span class="s1">&#39;densities&#39;</span><span class="p">:</span> <span class="n">densities</span><span class="p">,</span> <span class="s1">&#39;widths&#39;</span><span class="p">:</span> <span class="n">bin_widths</span><span class="p">}</span>
    <span class="k">return</span> <span class="n">bin_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remap_low_to_high_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">which_binning</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vectorized distribution of low-resolution frequencies over high-resolution bins.</span>
<span class="sd">    Expands each low-res bin&#39;s frequency uniformly across the corresponding high-res bins.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">b1_bin_dict</span> <span class="o">=</span> <span class="n">compute_discrete_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>  <span class="c1"># Low-res (Q)</span>
    <span class="n">b2_bin_dict</span> <span class="o">=</span> <span class="n">compute_discrete_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b2</span><span class="p">)</span>  <span class="c1"># High-res (P)</span>
    <span class="n">b1_bins</span> <span class="o">=</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">which_binning</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>
    <span class="n">b1_freqs</span> <span class="o">=</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">which_binning</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">]</span>
    <span class="n">b2_bins</span> <span class="o">=</span> <span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">which_binning</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>
    <span class="n">b2_freqs</span> <span class="o">=</span> <span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">which_binning</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">]</span>
    <span class="c1"># Normalize up-scaled low-res frequencies and convert to probabilities</span>
    <span class="n">b1_probs</span> <span class="o">=</span> <span class="n">b1_freqs</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">b1_freqs</span><span class="p">)</span>
    <span class="c1"># Determine the low-res bin for each high-res bin</span>
    <span class="n">bin_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">b2_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">b1_bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Map high-res bins to low-res bins</span>
    
    <span class="c1"># Compute counts of high-res bins falling into each low-res bin</span>
    <span class="n">counts_per_low_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">bin_indices</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">b1_probs</span><span class="p">))</span>

    <span class="c1"># Broadcast low-res frequencies to high-res bins, dividing by the count to distribute uniformly</span>
    <span class="n">high_res_probs</span> <span class="o">=</span> <span class="n">b1_probs</span><span class="p">[</span><span class="n">bin_indices</span><span class="p">]</span> <span class="o">/</span> <span class="n">counts_per_low_bin</span><span class="p">[</span><span class="n">bin_indices</span><span class="p">]</span>
    <span class="c1"># Normalize to ensure the result sums to 1</span>
    <span class="n">high_res_probs</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">high_res_probs</span><span class="p">)</span>
    
    <span class="k">return</span> <span class="n">high_res_probs</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">,</span> <span class="n">b2_bin_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_kl_divergence</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
    <span class="c1"># compute DKL(Q||Q_post), or the divergence</span>
    <span class="c1"># of the posterior from the likelihood due to the prior</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">q</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">p</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
    <span class="n">noise</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">p</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">p</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">q</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span><span class="n">noise</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;simulate the target using the parametric MLE parameters from the proxy&quot;&quot;&quot;</span>
    <span class="c1"># fit and plot a lognormal distribution</span>
    <span class="n">ln_shape</span><span class="p">,</span> <span class="n">ln_loc</span><span class="p">,</span> <span class="n">ln_scale</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fixing location to 0</span>
    <span class="n">ex_loc</span><span class="p">,</span> <span class="n">ex_scale</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">kp</span> <span class="o">=</span> <span class="n">fit_kappa4_mle</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="c1"># kp = constrained_optimization(data)</span>
    <span class="n">kde</span> <span class="o">=</span> <span class="n">gaussian_kde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">bw_method</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">)</span>

    <span class="n">edges</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span>
    <span class="n">ln_cdf_vals</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">ln_shape</span><span class="p">,</span> 
                              <span class="n">loc</span><span class="o">=</span><span class="n">ln_loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ln_scale</span><span class="p">)</span>
    <span class="n">expon_cdf_vals</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">ex_loc</span><span class="p">,</span> 
                               <span class="n">scale</span><span class="o">=</span><span class="n">ex_scale</span><span class="p">)</span>
    <span class="n">kappa4_cdf_vals</span> <span class="o">=</span> <span class="n">kappa4</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
                                 <span class="n">loc</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
    
    <span class="c1"># Compute the KDE-based CDF at the evaluation points</span>
    <span class="n">kde_cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kde</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">])</span>
    
    <span class="n">p_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
    <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_LN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ln_cdf_vals</span><span class="p">)</span>
    <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_EXP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">expon_cdf_vals</span><span class="p">)</span>
    <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KP4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">kappa4_cdf_vals</span><span class="p">)</span>
    <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KDE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">kde_cdf_vals</span><span class="p">)</span>
    <span class="c1"># normalize the distributions </span>
    <span class="n">p_sim</span> <span class="o">/=</span> <span class="n">p_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="c1"># make sure all distributions sum to 1</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">isclose</span><span class="p">(</span><span class="n">p_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">(),</span> <span class="mi">1</span><span class="p">,</span> <span class="n">atol</span><span class="o">=</span><span class="mf">0.0001</span><span class="p">)</span><span class="o">.</span><span class="n">all</span><span class="p">(),</span> <span class="n">p_sim</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="n">bin_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="c1"># replace the last bin midpoint with half the previous bin&#39;s width</span>
    <span class="c1"># because our right bin edge is np.inf</span>
    <span class="c1"># right_bin_midpoint = edges[-2] + (edges[-2] - edges[-3]) / 2.0</span>
    <span class="c1"># bin_midpoints[-1] = right_bin_midpoint</span>
    <span class="n">p_sim</span><span class="p">[</span><span class="s1">&#39;bin_midpoints&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">bin_midpoints</span>
    <span class="k">return</span> <span class="n">p_sim</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_distribution_comparisons</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">):</span>
    <span class="n">bin_dict</span> <span class="o">=</span> <span class="p">{}</span>    
    
    <span class="n">discrete_dict</span> <span class="o">=</span> <span class="n">compute_discrete_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">)</span>
    <span class="n">parametric</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">discrete_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="p">[</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">]:</span>
        <span class="n">bin_dict</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span>
                <span class="s1">&#39;discrete&#39;</span><span class="p">:</span> <span class="n">discrete_dict</span><span class="p">,</span>
                <span class="s1">&#39;continuous&#39;</span><span class="p">:</span> <span class="n">parametric</span>
            <span class="p">}</span>
    <span class="k">return</span> <span class="n">bin_dict</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_distribution_comparison</span><span class="p">(</span><span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">log_axis</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">test_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">log_axis</span><span class="p">:</span>
        <span class="n">test_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                         <span class="n">width</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> 
                          <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
        
    <span class="c1"># plot empirical (discrete) distributions using linear and log binning</span>
    <span class="c1"># bin_dict = compute_distribution_comparisons(data, b1, b2, binning_method)</span>
    <span class="n">high_res_probs</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">,</span> <span class="n">b2_bin_dict</span> <span class="o">=</span> <span class="n">remap_low_to_high_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">which_binning</span><span class="o">=</span><span class="n">binning_method</span><span class="p">)</span>
    <span class="n">continuous_b1</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
    <span class="n">continuous_b2</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>

    <span class="n">b2_edges</span> <span class="o">=</span> <span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">]</span>
    <span class="n">b2_freqs</span> <span class="o">=</span> <span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">]</span>

    <span class="n">test_fig</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">b2_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">b2_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">top</span><span class="o">=</span><span class="n">high_res_probs</span><span class="p">,</span> 
                  <span class="n">bottom</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))],</span>  <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> 
                  <span class="c1"># legend_label=f&#39;{b1} bits (upscaled)&#39;,</span>
                  <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Observed&#39;</span><span class="p">,</span>
                  <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">b2_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">b2_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">top</span><span class="o">=</span><span class="n">b2_freqs</span><span class="p">,</span> 
                  <span class="n">bottom</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">b2_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))],</span> <span class="n">fill_color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> 
                  <span class="c1"># legend_label=f&#39;{b2} bits&#39;,</span>
                  <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;Simulated&#39;</span><span class="p">,</span>
                  <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">)</span>

    <span class="n">b1_bin_midpoints</span> <span class="o">=</span> <span class="n">continuous_b1</span><span class="p">[</span><span class="s1">&#39;bin_midpoints&#39;</span><span class="p">]</span>
    <span class="n">b2_bin_midpoints</span> <span class="o">=</span> <span class="n">continuous_b2</span><span class="p">[</span><span class="s1">&#39;bin_midpoints&#39;</span><span class="p">]</span>
    <span class="c1"># print(parametric_high.keys())</span>
    <span class="c1"># p_sim = parametric_high.copy()</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">b2_bin_midpoints</span><span class="p">,</span> <span class="n">continuous_b2</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_LN&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;LogNorm MLE&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">b2_bin_midpoints</span><span class="p">,</span> <span class="n">continuous_b2</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_EXP&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Expon. MLE&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">b2_bin_midpoints</span><span class="p">,</span> <span class="n">continuous_b2</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KP4&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Kappa MLE&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">b2_bin_midpoints</span><span class="p">,</span> <span class="n">continuous_b2</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KDE&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_right&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s1">&#39;hide&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Mean Daily Flow } [m^3/s]$$&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{Pr}</span><span class="s1">(X)$$&#39;</span>
    <span class="c1"># test_fig.add_layout(LinearAxis(y_range_name=&quot;ecdf&quot;, axis_label=&quot;CDF&quot;), &quot;right&quot;)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
    <span class="n">test_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">test_fig</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">column</span>

<span class="n">test_df</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">get_timeseries_data</span><span class="p">(</span><span class="n">test_target</span><span class="p">)</span>
<span class="n">approximated_bitrate</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">ground_truth_bitrate</span> <span class="o">=</span> <span class="mi">5</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
<span class="n">pmf_comparison_plot_lin</span> <span class="o">=</span> <span class="n">plot_distribution_comparison</span><span class="p">(</span><span class="n">approximated_bitrate</span><span class="p">,</span> <span class="n">ground_truth_bitrate</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span>
<span class="n">pmf_comparison_plot_log</span> <span class="o">=</span> <span class="n">plot_distribution_comparison</span><span class="p">(</span><span class="n">approximated_bitrate</span><span class="p">,</span> <span class="n">ground_truth_bitrate</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">log_axis</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">column</span><span class="p">(</span><span class="n">pmf_comparison_plot_lin</span><span class="p">,</span> <span class="n">pmf_comparison_plot_log</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="a220b394-7207-4c3f-824d-4a458cc59ba2" data-root-id="p1948" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"a37244c0-b5ad-44b0-a12b-e583fb35c96f":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"Column","id":"p1948","attributes":{"children":[{"type":"object","name":"Figure","id":"p1724","attributes":{"width":1000,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1725"},"y_range":{"type":"object","name":"DataRange1d","id":"p1726"},"x_scale":{"type":"object","name":"LinearScale","id":"p1733"},"y_scale":{"type":"object","name":"LinearScale","id":"p1734"},"title":null,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1764","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1758","attributes":{"selected":{"type":"object","name":"Selection","id":"p1759","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1760"},"data":{"type":"map","entries":[["left",{"type":"ndarray","array":{"type":"bytes","data":"/anx0k1iYD/akFh+XGxkP/wT5n9adWk/3fv4wyG8bz/s+vZ/hcdzP1W3mdTfp3g/HDrBg/67fj/Hdtf04CeDP3AhZZ7f4Ic/hm5CmO7DjT+7vK/qRI2SP603l5MlIJc/G/a007DTnD9KFsTBiPehP6kRhRB/ZaY/lPJiFgbrqz8l0ToihWaxP46+Owq7sLU/VEsSPrEJuz9B2cXxE9rAP7BunQGqAcU/yYz0FXcvyj9Xwp9JEFLQP5Ge5vYdWNQ/QG0YRx5c2T/sPrPZrJzfPxH8l13qs+M/QeFYSW+P6D9WOe59h53uP3rYwRDkFPM/f8nFVDTJ9z9uxax1bab9Pw=="},"shape":[32],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"2pBYflxsZD/8E+Z/WnVpP937+MMhvG8/7Pr2f4XHcz9Vt5nU36d4Pxw6wYP+u34/x3bX9OAngz9wIWWe3+CHP4ZuQpjuw40/u7yv6kSNkj+tN5eTJSCXPxv2tNOw05w/ShbEwYj3oT+pEYUQf2WmP5TyYhYG66s/JdE6IoVmsT+OvjsKu7C1P1RLEj6xCbs/QdnF8RPawD+wbp0BqgHFP8mM9BV3L8o/V8KfSRBS0D+Rnub2HVjUP0BtGEceXNk/7D6z2ayc3z8R/Jdd6rPjP0HhWElvj+g/VjnufYed7j962MEQ5BTzP3/JxVQ0yfc/bsWsdW2m/T97FK5H4XoCQA=="},"shape":[32],"dtype":"float64","order":"little"}],["top",{"type":"ndarray","array":{"type":"bytes","data":"4ABwADgAHD/gAHAAOAAcP0CrSgDQqhI/QKtKANCqEj9Aq0oA0KoyP0CrSgDQqjI/Cwpb2oLCtj8LClvagsK2PwAAAAAAAAAAAAAAAAAAAADMKGYUM4qpP8woZhQziqk/4ZlFInhmsT/hmUUieGaxPxm2YTCGbag/GbZhMIZtqD+nE3606YSvP6cTfrTphK8/detkIN06qT9162Qg3TqpP6oYVYwqRqU/qhhVjCpGpT9Mk1D00iSkP0yTUPTSJKQ/KytAwMoKoD8rK0DAygqgP6krf0Dqyo8/qSt/QOrKjz8QVl0AhFV3PxBWXQCEVXc/eKtmAN6qST94q2YA3qpJPw=="},"shape":[32],"dtype":"float64","order":"little"}],["bottom",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]}}},"view":{"type":"object","name":"CDSView","id":"p1765","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1766"}}},"glyph":{"type":"object","name":"Quad","id":"p1761","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.4}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1762","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_alpha":{"type":"value","value":0.1},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1763","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_alpha":{"type":"value","value":0.2},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1775","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1769","attributes":{"selected":{"type":"object","name":"Selection","id":"p1770","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1771"},"data":{"type":"map","entries":[["left",{"type":"ndarray","array":{"type":"bytes","data":"/anx0k1iYD/akFh+XGxkP/wT5n9adWk/3fv4wyG8bz/s+vZ/hcdzP1W3mdTfp3g/HDrBg/67fj/Hdtf04CeDP3AhZZ7f4Ic/hm5CmO7DjT+7vK/qRI2SP603l5MlIJc/G/a007DTnD9KFsTBiPehP6kRhRB/ZaY/lPJiFgbrqz8l0ToihWaxP46+Owq7sLU/VEsSPrEJuz9B2cXxE9rAP7BunQGqAcU/yYz0FXcvyj9Xwp9JEFLQP5Ge5vYdWNQ/QG0YRx5c2T/sPrPZrJzfPxH8l13qs+M/QeFYSW+P6D9WOe59h53uP3rYwRDkFPM/f8nFVDTJ9z9uxax1bab9Pw=="},"shape":[32],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"2pBYflxsZD/8E+Z/WnVpP937+MMhvG8/7Pr2f4XHcz9Vt5nU36d4Pxw6wYP+u34/x3bX9OAngz9wIWWe3+CHP4ZuQpjuw40/u7yv6kSNkj+tN5eTJSCXPxv2tNOw05w/ShbEwYj3oT+pEYUQf2WmP5TyYhYG66s/JdE6IoVmsT+OvjsKu7C1P1RLEj6xCbs/QdnF8RPawD+wbp0BqgHFP8mM9BV3L8o/V8KfSRBS0D+Rnub2HVjUP0BtGEceXNk/7D6z2ayc3z8R/Jdd6rPjP0HhWElvj+g/VjnufYed7j962MEQ5BTzP3/JxVQ0yfc/bsWsdW2m/T97FK5H4XoCQA=="},"shape":[32],"dtype":"float64","order":"little"}],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAADgAHAAOAAsPwAAAAAAAAAAQKtKANCqIj9Aq0oA0KoyP0CrSgDQqjI/4ABwADgAXD8KKlpqgorGPwAAAAAAAAAAAAAAAAAAAADMKGYUM4q5PwAAAAAAAAAAj1BHqCPUsT8y40OczPiwP3XrZCDdOqk/vYBeQC+gpz/qFUpgeoWyP3v7Z6je/qk/R+Z4yJE5rj+i8FB4KDykP2K7W4jY7qY/8nVOkHydoz9E20wY0TajP1NLVNDUEqU/4EVF+HdRoT/sIHYQO4idP5dAS6Al0JI/JdZnQIn1iT/YVUEAdlWAP+AAcAA4AGw/SFZ5AJJVTj+oAFQAKgBFPw=="},"shape":[32],"dtype":"float64","order":"little"}],["bottom",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]}}},"view":{"type":"object","name":"CDSView","id":"p1776","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1777"}}},"glyph":{"type":"object","name":"Quad","id":"p1772","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.4}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1773","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_alpha":{"type":"value","value":0.1},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1774","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_alpha":{"type":"value","value":0.2},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1785","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1779","attributes":{"selected":{"type":"object","name":"Selection","id":"p1780","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1781"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"6zqTVkpZZT8XcJh5TxdwP3IpRRnQl3c/xLP5RMHSgD8ocG69/VWHPxrC6iQIfI8/dfCJJ42olD9/eB1/Ul6aP+tu13JAXqA/RTzMRevDoz+/1xcE/TanP7VQDAxJhao/6ugQi/13rT9CBgeXWdmvP8wAkol5vbA/oKhFbMUdsT/v1pbTtQWxPw5x8udDd7A/+cweXvD7rj+k0DJ3v1qsP0ZUfG0IPak/QTFHLLbZpT/6wquYYWaiP5yitOgiJJ4/Z3mtSh4DmD8M6p2IOZuSP8oJEUvmC4w/DDJ7U12PhD/GFHqvyVF9P/jV89BuVXQ/ugLhVLduaz8y/hOrqv9hPw=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1786","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1787"}}},"glyph":{"type":"object","name":"Line","id":"p1782","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1783","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1784","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1795","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1789","attributes":{"selected":{"type":"object","name":"Selection","id":"p1790","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1791"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"ZrvEeKITaz/LlmQ3PdBwPwFKK0eW3HQ/qpLskuTaeT+n7/+Ufv9/P+X342Hgw4M/n2dzayRdiD9sVW1uJPONP8bek+RTWJI/rzYC4KZglj9VOAYEriabP3H+d4K5XKA/8NxGKtmOoz/xxTIkOyOnP+kUi5qtBas/Io5xyH8Orz8UihyMW36xP85dHZQaObM/IIWcKZJ6tD+E6S8wnv20P5bLQhGqgbQ/eLADqh/fsj8fsN6inh+wP1dVB3oaH6k/IKdCxl1zoT9odo5LoweVPyLfELVUP4U/021bwlZCcT+nFBzfRGlVP2U/LJSpCjM/PCn6GEJ4Bj+H50zNdf3PPg=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1796","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1797"}}},"glyph":{"type":"object","name":"Line","id":"p1792","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1793","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1794","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1805","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1799","attributes":{"selected":{"type":"object","name":"Selection","id":"p1800","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1801"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"O/oJ/q4XXD8T7A9mJZNhP0EbOkIwAmY/1tWL6duWaz+cfTHtWVBxP1YK3Ssvw3U/gSyGy2Rmez/ztM+LH0iBP7mJ5TlZ2IU/jEu5BTasiz/kLZmIE5CRP97U+fbQU5Y/POsGyFlmnD+ocqGDwQmiP9ApQAMy0KY/pm4YAqGWrD9TlBh7lZ+xP0rZ8dVCKrU/denJGtJuuD+6CArOk6i6P3i/ut9U8bo/hP+jx2ynuD+iFf+Zgu6zP4nShQLWwas/WTHX2LQ0oD9EPTSRlcuOP3vu9fjx9HY/w9zrk6GkWT+Pb10h1T00P9dOUzxCAgU/1S2ZXbhHyj52qkDhpNyBPg=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1806","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1807"}}},"glyph":{"type":"object","name":"Line","id":"p1802","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1803","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1804","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1815","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1809","attributes":{"selected":{"type":"object","name":"Selection","id":"p1810","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1811"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"9PXNt3OKDz/cjAjc5j8cP5FriH2xqCE/veUylg/6JT/7tIjvJThRPx6UWBuM9og/VKilaQUIqz+wx0H0rQazPz8vAmVriqM/tKeFE29Knz+iSoDlAF2oPxgltX9ffac/T08SWxwGqT8yY5FrtsqrP5D8RAqNA60/JQINY3GRrT8g/j4QmqKtPxTK2FBcMqw/Ve5bwBDbqT/HwPk20eqnP7a31m6XWqY/5bi90BjRpD/d5EMF4AqkP5loLaXPP6M/Jyttws0NoT9oAdibZ8ubPzAvR4F8ZpQ/3tknNyY/iz/LA/lcBaqAPwn9R7eM1nA/hr3bP1PZWj/0KR4xXXhEPw=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1816","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1817"}}},"glyph":{"type":"object","name":"Line","id":"p1812","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1813","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1814","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1732","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1745"},{"type":"object","name":"WheelZoomTool","id":"p1746","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1747","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1748","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1754","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1753","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"SaveTool","id":"p1755"},{"type":"object","name":"ResetTool","id":"p1756"},{"type":"object","name":"HelpTool","id":"p1757"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1740","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1741","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1742"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1743"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"right":[{"type":"object","name":"Legend","id":"p1767","attributes":{"background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1768","attributes":{"label":{"type":"value","value":"Observed"},"renderers":[{"id":"p1764"}]}},{"type":"object","name":"LegendItem","id":"p1778","attributes":{"label":{"type":"value","value":"Simulated"},"renderers":[{"id":"p1775"}]}},{"type":"object","name":"LegendItem","id":"p1788","attributes":{"label":{"type":"value","value":"LogNorm MLE"},"renderers":[{"id":"p1785"}]}},{"type":"object","name":"LegendItem","id":"p1798","attributes":{"label":{"type":"value","value":"Expon. MLE"},"renderers":[{"id":"p1795"}]}},{"type":"object","name":"LegendItem","id":"p1808","attributes":{"label":{"type":"value","value":"Kappa MLE"},"renderers":[{"id":"p1805"}]}},{"type":"object","name":"LegendItem","id":"p1818","attributes":{"label":{"type":"value","value":"KDE"},"renderers":[{"id":"p1815"}]}}]}}],"below":[{"type":"object","name":"LinearAxis","id":"p1735","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1736","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1737"},"axis_label":"$$\\text{Mean Daily Flow } [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1738"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1739","attributes":{"axis":{"id":"p1735"}}},{"type":"object","name":"Grid","id":"p1744","attributes":{"dimension":1,"axis":{"id":"p1740"}}},{"id":"p1767"}]}},{"type":"object","name":"Figure","id":"p1853","attributes":{"width":1000,"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p1854"},"y_range":{"type":"object","name":"DataRange1d","id":"p1855"},"x_scale":{"type":"object","name":"LogScale","id":"p1862"},"y_scale":{"type":"object","name":"LinearScale","id":"p1863"},"title":null,"renderers":[{"type":"object","name":"GlyphRenderer","id":"p1893","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1887","attributes":{"selected":{"type":"object","name":"Selection","id":"p1888","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1889"},"data":{"type":"map","entries":[["left",{"type":"ndarray","array":{"type":"bytes","data":"/anx0k1iYD/akFh+XGxkP/wT5n9adWk/3fv4wyG8bz/s+vZ/hcdzP1W3mdTfp3g/HDrBg/67fj/Hdtf04CeDP3AhZZ7f4Ic/hm5CmO7DjT+7vK/qRI2SP603l5MlIJc/G/a007DTnD9KFsTBiPehP6kRhRB/ZaY/lPJiFgbrqz8l0ToihWaxP46+Owq7sLU/VEsSPrEJuz9B2cXxE9rAP7BunQGqAcU/yYz0FXcvyj9Xwp9JEFLQP5Ge5vYdWNQ/QG0YRx5c2T/sPrPZrJzfPxH8l13qs+M/QeFYSW+P6D9WOe59h53uP3rYwRDkFPM/f8nFVDTJ9z9uxax1bab9Pw=="},"shape":[32],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"2pBYflxsZD/8E+Z/WnVpP937+MMhvG8/7Pr2f4XHcz9Vt5nU36d4Pxw6wYP+u34/x3bX9OAngz9wIWWe3+CHP4ZuQpjuw40/u7yv6kSNkj+tN5eTJSCXPxv2tNOw05w/ShbEwYj3oT+pEYUQf2WmP5TyYhYG66s/JdE6IoVmsT+OvjsKu7C1P1RLEj6xCbs/QdnF8RPawD+wbp0BqgHFP8mM9BV3L8o/V8KfSRBS0D+Rnub2HVjUP0BtGEceXNk/7D6z2ayc3z8R/Jdd6rPjP0HhWElvj+g/VjnufYed7j962MEQ5BTzP3/JxVQ0yfc/bsWsdW2m/T97FK5H4XoCQA=="},"shape":[32],"dtype":"float64","order":"little"}],["top",{"type":"ndarray","array":{"type":"bytes","data":"4ABwADgAHD/gAHAAOAAcP0CrSgDQqhI/QKtKANCqEj9Aq0oA0KoyP0CrSgDQqjI/Cwpb2oLCtj8LClvagsK2PwAAAAAAAAAAAAAAAAAAAADMKGYUM4qpP8woZhQziqk/4ZlFInhmsT/hmUUieGaxPxm2YTCGbag/GbZhMIZtqD+nE3606YSvP6cTfrTphK8/detkIN06qT9162Qg3TqpP6oYVYwqRqU/qhhVjCpGpT9Mk1D00iSkP0yTUPTSJKQ/KytAwMoKoD8rK0DAygqgP6krf0Dqyo8/qSt/QOrKjz8QVl0AhFV3PxBWXQCEVXc/eKtmAN6qST94q2YA3qpJPw=="},"shape":[32],"dtype":"float64","order":"little"}],["bottom",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]}}},"view":{"type":"object","name":"CDSView","id":"p1894","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1895"}}},"glyph":{"type":"object","name":"Quad","id":"p1890","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.4}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1891","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_alpha":{"type":"value","value":0.1},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1892","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"gray"},"line_alpha":{"type":"value","value":0.2},"line_width":{"type":"value","value":0.5},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1904","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1898","attributes":{"selected":{"type":"object","name":"Selection","id":"p1899","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1900"},"data":{"type":"map","entries":[["left",{"type":"ndarray","array":{"type":"bytes","data":"/anx0k1iYD/akFh+XGxkP/wT5n9adWk/3fv4wyG8bz/s+vZ/hcdzP1W3mdTfp3g/HDrBg/67fj/Hdtf04CeDP3AhZZ7f4Ic/hm5CmO7DjT+7vK/qRI2SP603l5MlIJc/G/a007DTnD9KFsTBiPehP6kRhRB/ZaY/lPJiFgbrqz8l0ToihWaxP46+Owq7sLU/VEsSPrEJuz9B2cXxE9rAP7BunQGqAcU/yYz0FXcvyj9Xwp9JEFLQP5Ge5vYdWNQ/QG0YRx5c2T/sPrPZrJzfPxH8l13qs+M/QeFYSW+P6D9WOe59h53uP3rYwRDkFPM/f8nFVDTJ9z9uxax1bab9Pw=="},"shape":[32],"dtype":"float64","order":"little"}],["right",{"type":"ndarray","array":{"type":"bytes","data":"2pBYflxsZD/8E+Z/WnVpP937+MMhvG8/7Pr2f4XHcz9Vt5nU36d4Pxw6wYP+u34/x3bX9OAngz9wIWWe3+CHP4ZuQpjuw40/u7yv6kSNkj+tN5eTJSCXPxv2tNOw05w/ShbEwYj3oT+pEYUQf2WmP5TyYhYG66s/JdE6IoVmsT+OvjsKu7C1P1RLEj6xCbs/QdnF8RPawD+wbp0BqgHFP8mM9BV3L8o/V8KfSRBS0D+Rnub2HVjUP0BtGEceXNk/7D6z2ayc3z8R/Jdd6rPjP0HhWElvj+g/VjnufYed7j962MEQ5BTzP3/JxVQ0yfc/bsWsdW2m/T97FK5H4XoCQA=="},"shape":[32],"dtype":"float64","order":"little"}],["top",{"type":"ndarray","array":{"type":"bytes","data":"AAAAAAAAAADgAHAAOAAsPwAAAAAAAAAAQKtKANCqIj9Aq0oA0KoyP0CrSgDQqjI/4ABwADgAXD8KKlpqgorGPwAAAAAAAAAAAAAAAAAAAADMKGYUM4q5PwAAAAAAAAAAj1BHqCPUsT8y40OczPiwP3XrZCDdOqk/vYBeQC+gpz/qFUpgeoWyP3v7Z6je/qk/R+Z4yJE5rj+i8FB4KDykP2K7W4jY7qY/8nVOkHydoz9E20wY0TajP1NLVNDUEqU/4EVF+HdRoT/sIHYQO4idP5dAS6Al0JI/JdZnQIn1iT/YVUEAdlWAP+AAcAA4AGw/SFZ5AJJVTj+oAFQAKgBFPw=="},"shape":[32],"dtype":"float64","order":"little"}],["bottom",[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]]]}}},"view":{"type":"object","name":"CDSView","id":"p1905","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1906"}}},"glyph":{"type":"object","name":"Quad","id":"p1901","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.4}}},"nonselection_glyph":{"type":"object","name":"Quad","id":"p1902","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_alpha":{"type":"value","value":0.1},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.1},"hatch_alpha":{"type":"value","value":0.1}}},"muted_glyph":{"type":"object","name":"Quad","id":"p1903","attributes":{"left":{"type":"field","field":"left"},"right":{"type":"field","field":"right"},"bottom":{"type":"field","field":"bottom"},"top":{"type":"field","field":"top"},"line_color":{"type":"value","value":"crimson"},"line_alpha":{"type":"value","value":0.2},"line_width":{"type":"value","value":0.5},"fill_color":{"type":"value","value":"crimson"},"fill_alpha":{"type":"value","value":0.2},"hatch_alpha":{"type":"value","value":0.2}}}}},{"type":"object","name":"GlyphRenderer","id":"p1914","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1908","attributes":{"selected":{"type":"object","name":"Selection","id":"p1909","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1910"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"6zqTVkpZZT8XcJh5TxdwP3IpRRnQl3c/xLP5RMHSgD8ocG69/VWHPxrC6iQIfI8/dfCJJ42olD9/eB1/Ul6aP+tu13JAXqA/RTzMRevDoz+/1xcE/TanP7VQDAxJhao/6ugQi/13rT9CBgeXWdmvP8wAkol5vbA/oKhFbMUdsT/v1pbTtQWxPw5x8udDd7A/+cweXvD7rj+k0DJ3v1qsP0ZUfG0IPak/QTFHLLbZpT/6wquYYWaiP5yitOgiJJ4/Z3mtSh4DmD8M6p2IOZuSP8oJEUvmC4w/DDJ7U12PhD/GFHqvyVF9P/jV89BuVXQ/ugLhVLduaz8y/hOrqv9hPw=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1915","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1916"}}},"glyph":{"type":"object","name":"Line","id":"p1911","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1912","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1913","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1924","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1918","attributes":{"selected":{"type":"object","name":"Selection","id":"p1919","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1920"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"ZrvEeKITaz/LlmQ3PdBwPwFKK0eW3HQ/qpLskuTaeT+n7/+Ufv9/P+X342Hgw4M/n2dzayRdiD9sVW1uJPONP8bek+RTWJI/rzYC4KZglj9VOAYEriabP3H+d4K5XKA/8NxGKtmOoz/xxTIkOyOnP+kUi5qtBas/Io5xyH8Orz8UihyMW36xP85dHZQaObM/IIWcKZJ6tD+E6S8wnv20P5bLQhGqgbQ/eLADqh/fsj8fsN6inh+wP1dVB3oaH6k/IKdCxl1zoT9odo5LoweVPyLfELVUP4U/021bwlZCcT+nFBzfRGlVP2U/LJSpCjM/PCn6GEJ4Bj+H50zNdf3PPg=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1925","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1926"}}},"glyph":{"type":"object","name":"Line","id":"p1921","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1922","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1923","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"gray","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1934","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1928","attributes":{"selected":{"type":"object","name":"Selection","id":"p1929","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1930"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"O/oJ/q4XXD8T7A9mJZNhP0EbOkIwAmY/1tWL6duWaz+cfTHtWVBxP1YK3Ssvw3U/gSyGy2Rmez/ztM+LH0iBP7mJ5TlZ2IU/jEu5BTasiz/kLZmIE5CRP97U+fbQU5Y/POsGyFlmnD+ocqGDwQmiP9ApQAMy0KY/pm4YAqGWrD9TlBh7lZ+xP0rZ8dVCKrU/denJGtJuuD+6CArOk6i6P3i/ut9U8bo/hP+jx2ynuD+iFf+Zgu6zP4nShQLWwas/WTHX2LQ0oD9EPTSRlcuOP3vu9fjx9HY/w9zrk6GkWT+Pb10h1T00P9dOUzxCAgU/1S2ZXbhHyj52qkDhpNyBPg=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1935","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1936"}}},"glyph":{"type":"object","name":"Line","id":"p1931","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1932","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1933","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"purple","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p1944","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p1938","attributes":{"selected":{"type":"object","name":"Selection","id":"p1939","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p1940"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"bB2lKFVnYj9rUh9/2/BmP+yH7yG+mGw/bbz5MMvScT8gWUiqsjd2P7h4LSzvsXs/6glcG/BCgT8cTJ5JYISFP/vHUxtn0oo//3loG563kD80eiM/tdaUP+QWpjPr+Zk/rEjPlbAwoD/6kyTpgy6kPx4CdJNCKKk/b0psLQhcrz/aRzsWoIuzP/EEJyQ2Xbg/6/7OkOxevj/4o7H53u3CP7z9yIuQmMc/vAia1MtpzT90MEMgF1XSP+iF/x4e2tY/FtZlkGV83D/EzThlIMHhP6lueNOsIeY/TI2jY3uW6z+Setzn0zHxP/zQwzIMb/U/dkc55dC3+j+ZO0IBDKcAQA=="},"shape":[32],"dtype":"float64","order":"little"}],["y",{"type":"ndarray","array":{"type":"bytes","data":"9PXNt3OKDz/cjAjc5j8cP5FriH2xqCE/veUylg/6JT/7tIjvJThRPx6UWBuM9og/VKilaQUIqz+wx0H0rQazPz8vAmVriqM/tKeFE29Knz+iSoDlAF2oPxgltX9ffac/T08SWxwGqT8yY5FrtsqrP5D8RAqNA60/JQINY3GRrT8g/j4QmqKtPxTK2FBcMqw/Ve5bwBDbqT/HwPk20eqnP7a31m6XWqY/5bi90BjRpD/d5EMF4AqkP5loLaXPP6M/Jyttws0NoT9oAdibZ8ubPzAvR4F8ZpQ/3tknNyY/iz/LA/lcBaqAPwn9R7eM1nA/hr3bP1PZWj/0KR4xXXhEPw=="},"shape":[32],"dtype":"float64","order":"little"}]]}}},"view":{"type":"object","name":"CDSView","id":"p1945","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p1946"}}},"glyph":{"type":"object","name":"Line","id":"p1941","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p1942","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p1943","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"magenta","line_alpha":0.2,"line_width":2}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p1861","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p1874"},{"type":"object","name":"WheelZoomTool","id":"p1875","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p1876","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p1877","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p1883","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p1882","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"SaveTool","id":"p1884"},{"type":"object","name":"ResetTool","id":"p1885"},{"type":"object","name":"HelpTool","id":"p1886"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p1869","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p1870","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p1871"},"axis_label":"$$\\text{Pr}(X)$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1872"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"right":[{"type":"object","name":"Legend","id":"p1896","attributes":{"background_fill_alpha":0.6,"click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p1897","attributes":{"label":{"type":"value","value":"Observed"},"renderers":[{"id":"p1893"}]}},{"type":"object","name":"LegendItem","id":"p1907","attributes":{"label":{"type":"value","value":"Simulated"},"renderers":[{"id":"p1904"}]}},{"type":"object","name":"LegendItem","id":"p1917","attributes":{"label":{"type":"value","value":"LogNorm MLE"},"renderers":[{"id":"p1914"}]}},{"type":"object","name":"LegendItem","id":"p1927","attributes":{"label":{"type":"value","value":"Expon. MLE"},"renderers":[{"id":"p1924"}]}},{"type":"object","name":"LegendItem","id":"p1937","attributes":{"label":{"type":"value","value":"Kappa MLE"},"renderers":[{"id":"p1934"}]}},{"type":"object","name":"LegendItem","id":"p1947","attributes":{"label":{"type":"value","value":"KDE"},"renderers":[{"id":"p1944"}]}}]}}],"below":[{"type":"object","name":"LogAxis","id":"p1864","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p1865","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p1866"},"axis_label":"$$\\text{Mean Daily Flow } [m^3/s]$$","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p1867"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p1868","attributes":{"axis":{"id":"p1864"}}},{"type":"object","name":"Grid","id":"p1873","attributes":{"dimension":1,"axis":{"id":"p1869"}}},{"id":"p1896"}]}}]}}]}};
  const render_items = [{"docid":"a37244c0-b5ad-44b0-a12b-e583fb35c96f","roots":{"p1948":"a220b394-7207-4c3f-824d-4a458cc59ba2"},"root_ids":["p1948"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>The above plots compare discrete and continuous methods for representing observed data as probability distributions. Two discrete distributions are shown, quantized to different dictionary sizes: the first (pink) uses five bits, while the second uses four bits. The frequencies from the four-bit distribution are remapped to the larger dictionary and renormalized to align with the states of the five-bit distribution. Additionally, four continuous distributions are fit to the data: three parametric models (log-normal, exponential, and 4-parameter Kappa) using MLE best-fit parameters, and a KDE-based distribution. These continuous distributions are mapped to the bin midpoints of the five-bit discrete distribution and normalized to sum to 1 to allow comparison with the discrete empirical estimates.</p>
<p>The plot illustrates the point that all methods for representing observational data as distributions involve decisions that affect interpretation. The three parametric fits limit the interpretation to single-mode distributions. KDE, while more flexible, can exhibit limitations in regions with sparse data or sharp changes in density, particularly for small values approaching zero, where the kernel may under- or over-smooth depending on its size. Discrete binning, on the other hand, preserves as much of the variability in the data as the chosen quantization allows, while parametric fits inherently smooth the distribution, embedding assumptions about long-term behavior rather than simply acting as a low-pass filter to remove high-frequency variability to emphasize broader trends or more general patterns. The KDE can act as an intermediate approach: larger kernels emphasize smoothing, similar to parametric fits, while smaller kernels approach the variance-preserving characteristics of discrete binning.</p>
<p>A limitation of KDE is that typically the Kernel applied is constant, which is why the KDE fit is very different between the left and right sides of the distribution (more evident when viewed in log space).</p>
<section id="quantization-noise-and-representation-bias">
<h2>Quantization Noise and Representation Bias<a class="headerlink" href="#quantization-noise-and-representation-bias" title="Link to this heading">#</a></h2>
<p>The representation that retains the most information and introduces the least noise or error is the discrete quantization with a dictionary large enough to preserve the full precision of the observations. Assuming the larger of the two discrete distributions is the “ground truth” the next example compares two sources of approximation error: the quantization noise introduced by reducing the number of bins, and the error from continuous representations. The parametric continuous fits impose structural assumptions on the data, and the nonparametric methods impose a degree of smoothing, depending on the kernel choice using KDE or by the reduction in dictionary size for the discrete representation.  By computing KL divergence against the higher precision quantization, the deviation of each representation from the “ground truth” distribution is quantified in information terms.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">continuous_klds</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">continuous</span><span class="p">,</span> <span class="n">binning_method</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span> <span class="n">print_results</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
        
    <span class="c1"># compute the KL divergence between the discrete and continuous forms, </span>
    <span class="c1"># where the discrete form is the &quot;ground truth&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># adj_freqs = np.array(list(discrete[&#39;freqs&#39;]) + [0])</span>
    <span class="n">kld_ln</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_LN&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;LN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kld_ln</span>
    <span class="n">kld_exp</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_EXP&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;EXP&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kld_exp</span>
    <span class="n">kld_kp4</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KP4&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;KP4&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kld_kp4</span>
    <span class="n">kld_kde</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">freqs</span><span class="p">,</span> <span class="n">continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_KDE&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">d</span><span class="p">[</span><span class="s1">&#39;KDE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kld_kde</span>
    
    <span class="k">return</span> <span class="n">d</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">b2</span><span class="o">=</span> <span class="mi">16</span>
<span class="n">binning_method</span> <span class="o">=</span> <span class="s1">&#39;log&#39;</span>
<span class="n">quant_noise</span><span class="p">,</span> <span class="n">ln_noise</span><span class="p">,</span> <span class="n">exp_noise</span><span class="p">,</span> <span class="n">kp4_noise</span><span class="p">,</span> <span class="n">kde_noise</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[]</span>
<span class="n">bitrates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">]</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mf">3.</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">kld_dict</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">b1</span> <span class="ow">in</span> <span class="n">bitrates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Computing quantization noise for </span><span class="si">{</span><span class="n">b2</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">b1</span><span class="si">}</span><span class="s1"> bit downscaling&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">var</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;KDE cannot be computed for data with zero variance.&quot;</span><span class="p">)</span>
    <span class="c1"># bin_dict, remapped_discrete_freqs = compute_distribution_comparisons(data, b1, b2, binning_method)</span>
    <span class="n">upsampled_freqs</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">,</span> <span class="n">b2_bin_dict</span> <span class="o">=</span> <span class="n">remap_low_to_high_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">which_binning</span><span class="o">=</span><span class="n">binning_method</span><span class="p">)</span>
    <span class="n">continuous_b1</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
    <span class="c1"># continuous_b2 = fit_continuous_distributions(data, b2_bin_dict[binning_method][&#39;edges&#39;])</span>
    <span class="c1"># compute quantization noise from b2 to b1 downscaling</span>
    <span class="n">kld_discrete</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">],</span> <span class="n">upsampled_freqs</span><span class="p">)</span>      
    <span class="n">kld_dict</span><span class="p">[</span><span class="n">b1</span><span class="p">]</span> <span class="o">=</span> <span class="n">kld_discrete</span>
    <span class="n">quant_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kld_discrete</span><span class="p">)</span>
    
    <span class="n">kld_dict_continuous</span> <span class="o">=</span> <span class="n">continuous_klds</span><span class="p">(</span><span class="n">stn</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">],</span> <span class="n">continuous_b1</span><span class="p">)</span>
    <span class="n">kld_dict</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kld_dict_continuous</span><span class="p">)</span>    
    <span class="n">ln_n</span><span class="p">,</span> <span class="n">exp_n</span><span class="p">,</span> <span class="n">kp4_n</span><span class="p">,</span> <span class="n">kde_n</span> <span class="o">=</span> <span class="n">kld_dict</span><span class="p">[</span><span class="s1">&#39;LN&#39;</span><span class="p">],</span> <span class="n">kld_dict</span><span class="p">[</span><span class="s1">&#39;EXP&#39;</span><span class="p">],</span> <span class="n">kld_dict</span><span class="p">[</span><span class="s1">&#39;KP4&#39;</span><span class="p">],</span> <span class="n">kld_dict</span><span class="p">[</span><span class="s1">&#39;KDE&#39;</span><span class="p">]</span>
    <span class="n">ln_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ln_n</span><span class="p">)</span>
    <span class="n">exp_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">exp_n</span><span class="p">)</span>
    <span class="n">kp4_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kp4_n</span><span class="p">)</span>
    <span class="n">kde_noise</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kde_n</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 4 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 5 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 6 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 7 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 8 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 9 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 10 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 11 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 12 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 13 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 14 bit downscaling
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Computing quantization noise for 16 to 15 bit downscaling
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">KeyboardInterrupt</span><span class="g g-Whitespace">                         </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">30</span><span class="p">],</span> <span class="n">line</span> <span class="mi">13</span>
<span class="g g-Whitespace">     </span><span class="mi">11</span> <span class="c1"># bin_dict, remapped_discrete_freqs = compute_distribution_comparisons(data, b1, b2, binning_method)</span>
<span class="g g-Whitespace">     </span><span class="mi">12</span> <span class="n">upsampled_freqs</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">,</span> <span class="n">b2_bin_dict</span> <span class="o">=</span> <span class="n">remap_low_to_high_resolution</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1</span><span class="p">,</span> <span class="n">b2</span><span class="p">,</span> <span class="n">which_binning</span><span class="o">=</span><span class="n">binning_method</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">13</span> <span class="n">continuous_b1</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">b1_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;edges&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">14</span> <span class="c1"># continuous_b2 = fit_continuous_distributions(data, b2_bin_dict[binning_method][&#39;edges&#39;])</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="c1"># compute quantization noise from b2 to b1 downscaling</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span> <span class="n">kld_discrete</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">b2_bin_dict</span><span class="p">[</span><span class="n">binning_method</span><span class="p">][</span><span class="s1">&#39;freqs&#39;</span><span class="p">],</span> <span class="n">upsampled_freqs</span><span class="p">)</span>      

<span class="nn">Cell In[25], line 19,</span> in <span class="ni">fit_continuous_distributions</span><span class="nt">(data, bin_edges)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">kappa4_cdf_vals</span> <span class="o">=</span> <span class="n">kappa4</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                              <span class="n">loc</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="c1"># Compute the KDE-based CDF at the evaluation points</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="n">kde_cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kde</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">p_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_LN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ln_cdf_vals</span><span class="p">)</span>

<span class="nn">Cell In[25], line 19,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">     </span><span class="mi">15</span> <span class="n">kappa4_cdf_vals</span> <span class="o">=</span> <span class="n">kappa4</span><span class="o">.</span><span class="n">cdf</span><span class="p">(</span><span class="n">edges</span><span class="p">,</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;h&#39;</span><span class="p">],</span> <span class="n">kp</span><span class="p">[</span><span class="s1">&#39;k&#39;</span><span class="p">],</span>
<span class="g g-Whitespace">     </span><span class="mi">16</span>                              <span class="n">loc</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;loc&#39;</span><span class="p">],</span> <span class="n">scale</span><span class="o">=</span><span class="n">kp</span><span class="p">[</span><span class="s1">&#39;scale&#39;</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">18</span> <span class="c1"># Compute the KDE-based CDF at the evaluation points</span>
<span class="ne">---&gt; </span><span class="mi">19</span> <span class="n">kde_cdf_vals</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kde</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">edges</span><span class="p">])</span>
<span class="g g-Whitespace">     </span><span class="mi">21</span> <span class="n">p_sim</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="g g-Whitespace">     </span><span class="mi">22</span> <span class="n">p_sim</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_LN&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">ln_cdf_vals</span><span class="p">)</span>

<span class="nn">File ~/code_5820/data_analysis/lib/python3.10/site-packages/scipy/stats/_kde.py:361,</span> in <span class="ni">gaussian_kde.integrate_box_1d</span><span class="nt">(self, low, high)</span>
<span class="g g-Whitespace">    </span><span class="mi">356</span> <span class="n">normalized_low</span> <span class="o">=</span> <span class="n">ravel</span><span class="p">((</span><span class="n">low</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span> <span class="o">/</span> <span class="n">stdev</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">357</span> <span class="n">normalized_high</span> <span class="o">=</span> <span class="n">ravel</span><span class="p">((</span><span class="n">high</span> <span class="o">-</span> <span class="bp">self</span><span class="o">.</span><span class="n">dataset</span><span class="p">)</span> <span class="o">/</span> <span class="n">stdev</span><span class="p">)</span>
<span class="g g-Whitespace">    </span><span class="mi">359</span> <span class="n">value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">weights</span><span class="o">*</span><span class="p">(</span>
<span class="g g-Whitespace">    </span><span class="mi">360</span>                 <span class="n">special</span><span class="o">.</span><span class="n">ndtr</span><span class="p">(</span><span class="n">normalized_high</span><span class="p">)</span> <span class="o">-</span>
<span class="ne">--&gt; </span><span class="mi">361</span>                 <span class="n">special</span><span class="o">.</span><span class="n">ndtr</span><span class="p">(</span><span class="n">normalized_low</span><span class="p">)))</span>
<span class="g g-Whitespace">    </span><span class="mi">362</span> <span class="k">return</span> <span class="n">value</span>

<span class="ne">KeyboardInterrupt</span>: 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">extra_y_ranges</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;delta&quot;</span><span class="p">:</span> <span class="n">Range1d</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)}</span>

<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bitrates</span><span class="p">,</span> <span class="n">quant_noise</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Discrete&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bitrates</span><span class="p">,</span> <span class="n">ln_noise</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;LogNorm&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bitrates</span><span class="p">,</span> <span class="n">exp_noise</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Exponential&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bitrates</span><span class="p">,</span> <span class="n">kp4_noise</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Kappa 4&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bitrates</span><span class="p">,</span> <span class="n">kde_noise</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;KDE&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;magenta&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

<span class="n">noise_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Downsampled Dictionary Size } (10^b \text</span><span class="si">{symbols}</span><span class="s1">)$$&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Representation Noise } (\text{bits/sample})$$&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">LinearAxis</span><span class="p">(</span><span class="n">y_range_name</span><span class="o">=</span><span class="s2">&quot;delta&quot;</span><span class="p">,</span> <span class="n">axis_label</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;Continuous minus Discrete Noise&quot;</span><span class="p">),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;center_left&#39;</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
<span class="n">noise_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s1">&#39;hide&#39;</span>
<span class="n">noise_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">noise_fig</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">14</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">noise_fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The plot above shows that the ‘representation noise’ as a function of the dictionary size used to approximate the “ground truth” distribution.The dictionary size does not affect the continuous distribution fits relative to each other (differences are negligble compared to the magnitude of the noise itself).  The preceding analysis examined the noise from individual distribution representations, and the next step is to compare the <em>total</em> noise (epistemic uncertainty) to the discriminant value.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span> <span class="o">=</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">filtered_stns</span><span class="p">[</span><span class="mi">16</span><span class="p">]</span>

<span class="c1"># Retrieve the data for both stations</span>
<span class="c1"># this is all data, including non-concurrent</span>
<span class="n">adf</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">retrieve_nonconcurrent_data</span><span class="p">(</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">)</span>

<span class="c1"># add a very small amount of noise to prevent duplicate bin edges</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">]:</span>
    <span class="n">depth</span> <span class="o">=</span> <span class="mf">1e-9</span>
    <span class="n">noise</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="o">-</span><span class="n">depth</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">adf</span><span class="p">))</span>
    <span class="n">adf</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">+=</span> <span class="n">noise</span>

<span class="n">df</span> <span class="o">=</span> <span class="n">adf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">,</span> <span class="n">test_target</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
    <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">count_complete_years</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">test_proxy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">num_complete_concurrent_years</span><span class="p">,</span> <span class="s1">&#39;concurrent years of record&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># simulate runoff at the target based on equal unit area runoff scaling</span>
<span class="n">target_da</span> <span class="o">=</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_target</span><span class="p">,</span> <span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">proxy_da</span> <span class="o">=</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">test_proxy</span><span class="p">,</span> <span class="s1">&#39;drainage_area_km2&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="c1"># by the equal unit area runoff model assumption, the simulated target runoff</span>
<span class="c1"># is equal to the observed proxy unit area runoff</span>
<span class="n">sim_target</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_sim&#39;</span>
<span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">test_proxy</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">target_da</span> <span class="o">/</span> <span class="n">proxy_da</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_discrete_probabilities</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">):</span>
    <span class="c1"># define states / binning</span>
    <span class="n">target_bin_edges</span> <span class="o">=</span> <span class="n">digitize_by_log_binning</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">n_bins</span><span class="p">)</span>

    <span class="c1"># quantize the observed and simulated series according to the defined states</span>
    <span class="n">obs_q_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_quantized&#39;</span>
    <span class="n">sim_q_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">test_target</span><span class="si">}</span><span class="s1">_sim_quantized&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="n">obs_q_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">target_bin_edges</span><span class="p">)</span>    
    <span class="n">df</span><span class="p">[</span><span class="n">sim_q_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">],</span> <span class="n">target_bin_edges</span><span class="p">)</span>

    <span class="c1"># convert quantized series to discrete distributions</span>
    <span class="n">obs_count_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">obs_q_label</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">sim_count_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">sim_q_label</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    
    <span class="n">count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="n">n_bins</span><span class="p">))</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    
    <span class="n">count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span> <span class="o">+=</span> <span class="n">obs_count_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">+=</span> <span class="n">sim_count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span>
    <span class="n">count_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># assume a prior on the surrogate/proxy distribution</span>
    <span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">:</span>
        <span class="n">pseudo_counts</span> <span class="o">=</span> <span class="mi">10</span><span class="o">**</span><span class="n">prior</span>
        <span class="n">post_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_pseudo_counts&#39;</span>
        <span class="n">count_df</span><span class="p">[</span><span class="n">post_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">count_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span> <span class="o">+</span> <span class="n">pseudo_counts</span>
        <span class="c1"># count_df[post_label] /= count_df[post_label].sum()</span>
    
    <span class="c1"># normalize the counts to probabilities</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">count_df</span> <span class="o">/</span> <span class="n">count_df</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">probabilities</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">probabilities</span><span class="p">,</span> <span class="n">target_bin_edges</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">remap_probabilities</span><span class="p">(</span><span class="n">b2_bins</span><span class="p">,</span> <span class="n">b1_bins</span><span class="p">,</span> <span class="n">b1_probs</span><span class="p">):</span>
    <span class="n">bin_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">b2_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">b1_bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>  <span class="c1"># Map high-res bins to low-res bins</span>
    
    <span class="c1"># Compute counts of high-res bins falling into each low-res bin</span>
    <span class="n">counts_per_low_bin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">bincount</span><span class="p">(</span><span class="n">bin_indices</span><span class="p">,</span> <span class="n">minlength</span><span class="o">=</span><span class="nb">len</span><span class="p">(</span><span class="n">b1_probs</span><span class="p">))</span>

    <span class="c1"># Broadcast low-res frequencies to high-res bins, dividing by the count to distribute uniformly</span>
    <span class="n">high_res_probs</span> <span class="o">=</span> <span class="n">b1_probs</span><span class="p">[</span><span class="n">bin_indices</span><span class="p">]</span> <span class="o">/</span> <span class="n">counts_per_low_bin</span><span class="p">[</span><span class="n">bin_indices</span><span class="p">]</span>
    <span class="c1"># Normalize to ensure the result sums to 1</span>
    <span class="n">high_res_probs</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">high_res_probs</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">high_res_probs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the &quot;baseline&quot; probabilities using a large dictionary</span>
<span class="n">bitrates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mf">16.25</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>
<span class="n">large_dict_bins</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="mi">16</span>
<span class="n">large_dict_probabilities</span><span class="p">,</span> <span class="n">large_dict_edges</span> <span class="o">=</span> <span class="n">compute_discrete_probabilities</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">(),</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">large_dict_bins</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">large_dict_edges</span><span class="p">)</span><span class="si">}</span><span class="s1"> edges&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;discrete&#39;</span><span class="p">:</span> <span class="p">{},</span> <span class="s1">&#39;continuous&#39;</span><span class="p">:</span> <span class="p">{}}</span>
<span class="n">noise_ratios</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">noise_decomp</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bitrates</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> bits&#39;</span><span class="p">)</span>
    <span class="n">n_bins</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">b</span> <span class="o">-</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># compute the quantization noise of the observed TARGET series</span>
    <span class="c1"># mapped by log-binning to the TARGET obseved range</span>
    <span class="n">prob_df</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">compute_discrete_probabilities</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="nb">int</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">b</span><span class="p">))</span>
    <span class="n">obs_remapped_discrete</span> <span class="o">=</span> <span class="n">remap_probabilities</span><span class="p">(</span><span class="n">large_dict_edges</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">prob_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">quantization_noise_observed</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">large_dict_probabilities</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">obs_remapped_discrete</span><span class="p">)</span>
    <span class="c1"># print(f&#39;Target quantization noise ({max(bitrates) + 1} to {b} bits quantization): {quantization_noise_observed:.2f}&#39;)</span>
    <span class="c1"># noise_dict[&#39;discrete&#39;][b] = {&#39;obs&#39;: quantization_noise_observed}</span>
    
    <span class="c1"># compute the parametric fits of OBSERVED data aligned with the discrete bin edges</span>
    <span class="n">obs_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="n">obs_continuous</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">obs_data</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">)</span>
    <span class="c1"># compute the parametric fits of SIMULATED data aligned with the discrete TARGET bin edges</span>
    <span class="n">sim_data</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">values</span>
    <span class="n">sim_continuous</span> <span class="o">=</span> <span class="n">fit_continuous_distributions</span><span class="p">(</span><span class="n">sim_data</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">)</span>
    
    <span class="n">rep_noise_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="c1"># compute the &quot;noise&quot; associated with continuous distribution representation </span>
    <span class="c1"># of both observed and simulated distributions</span>
    <span class="k">for</span> <span class="n">cd</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;LN&#39;</span><span class="p">,</span> <span class="s1">&#39;EXP&#39;</span><span class="p">,</span> <span class="s1">&#39;KP4&#39;</span><span class="p">,</span> <span class="s1">&#39;KDE&#39;</span><span class="p">]:</span>
        <span class="n">rep_noise_obs</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">prob_df</span><span class="p">[</span><span class="n">test_target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">obs_continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="n">rep_noise_sim</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">prob_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">sim_continuous</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="n">cd</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
        <span class="c1"># print(f&#39;    Representation noise: obs (sim) = {rep_noise_obs:.2f} ({rep_noise_sim:.2f}) ({cd} continuous to {b} bits discrete)&#39;)</span>
        <span class="c1"># noise_dict[&#39;continuous&#39;][b] = {&#39;obs&#39;: rep_noise_obs, &#39;sim&#39;: rep_noise_sim} </span>
        <span class="n">rep_noise_dict</span><span class="p">[</span><span class="n">cd</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;obs&#39;</span><span class="p">:</span> <span class="n">rep_noise_obs</span><span class="p">,</span> <span class="s1">&#39;sim&#39;</span><span class="p">:</span> <span class="n">rep_noise_sim</span><span class="p">}</span>

    <span class="c1"># compute prior noise and DKL(observed || simulated_with_prior)</span>
    <span class="c1"># prior_noise, discriminants = [], []</span>
    <span class="n">prior_dict</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="n">noise_ratios</span><span class="p">[</span><span class="n">b</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">prior</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">:</span>
        <span class="n">post_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">prior</span><span class="si">}</span><span class="s1">_pseudo_counts&#39;</span>
        <span class="n">prior_noise</span> <span class="o">=</span> <span class="n">compute_noise</span><span class="p">(</span><span class="n">prob_df</span><span class="p">,</span> <span class="n">sim_target</span><span class="p">,</span> <span class="n">post_label</span><span class="p">)</span>
        <span class="n">dkl_discriminant</span> <span class="o">=</span> <span class="n">compute_noise</span><span class="p">(</span><span class="n">prob_df</span><span class="p">,</span> <span class="n">test_target</span><span class="p">,</span> <span class="n">post_label</span><span class="p">)</span> 
        <span class="c1"># in this case it&#39;s the DKL(Target || Posterior Simulated)</span>
        <span class="n">prior_dict</span><span class="p">[</span><span class="n">prior</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;prior_noise&#39;</span><span class="p">:</span> <span class="n">prior_noise</span><span class="p">,</span> <span class="s1">&#39;discriminant&#39;</span><span class="p">:</span> <span class="n">dkl_discriminant</span><span class="p">}</span>

        <span class="c1"># compute the quantization (discrete) noise</span>
        <span class="c1"># relative to a baseline (large) dictionary for the OBSERVED data</span>
        <span class="c1"># remap the current dictionary frequencies to the higher resolution &quot;baseline&quot; bins</span>
        <span class="c1"># observed_probs = probabilities[test_target]</span>
        <span class="c1"># obs_remapped_discrete = remap_probabilities(large_dict_edges, bin_edges, observed_probs.values)</span>
        <span class="c1"># quantization_noise_observed = compute_kl_divergence(large_dict_probabilities[test_target], obs_remapped_discrete)</span>

        <span class="n">simulated_probs</span> <span class="o">=</span> <span class="n">prob_df</span><span class="p">[</span><span class="n">sim_target</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">sim_remapped_discrete</span> <span class="o">=</span> <span class="n">remap_probabilities</span><span class="p">(</span><span class="n">large_dict_edges</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">simulated_probs</span><span class="p">)</span>
        <span class="n">quantization_noise_simulated</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">large_dict_probabilities</span><span class="p">[</span><span class="n">sim_target</span><span class="p">],</span> <span class="n">sim_remapped_discrete</span><span class="p">)</span>
        <span class="c1"># print(f&#39;    quantization noise: observed={quantization_noise_observed:.2f}, simulated={quantization_noise_simulated:.2f} + {prior_noise:.2f} prior ({max(bitrates) + 1} to {b} bits quantization)&#39;)</span>

        <span class="c1"># compute the difference between the noise added from quantization and prior on the simulated data </span>
        <span class="c1"># and the noise added from quantization on the observed data</span>
        <span class="n">discrete_noise_diff</span> <span class="o">=</span> <span class="nb">abs</span><span class="p">(</span><span class="n">quantization_noise_observed</span> <span class="o">-</span> <span class="p">(</span><span class="n">quantization_noise_simulated</span> <span class="o">+</span> <span class="n">prior_noise</span><span class="p">))</span>
        <span class="n">SNR</span> <span class="o">=</span> <span class="n">dkl_discriminant</span> <span class="o">/</span> <span class="n">discrete_noise_diff</span>
        <span class="c1"># print(f&#39;    Noise ratio = {noise_ratio:.2f} (prior: 10^{prior} pseudo-counts)&#39;)</span>
        <span class="n">noise_ratios</span><span class="p">[</span><span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">SNR</span><span class="p">)</span>
        <span class="n">noise_decomp</span> <span class="o">+=</span> <span class="p">[(</span><span class="n">b</span><span class="p">,</span> <span class="n">prior</span><span class="p">,</span> <span class="n">quantization_noise_observed</span><span class="p">,</span> <span class="n">quantization_noise_simulated</span><span class="p">,</span> <span class="n">prior_noise</span><span class="p">,</span> <span class="n">dkl_discriminant</span><span class="p">)]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">noise_comp_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">noise_decomp</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;bitrate&#39;</span><span class="p">,</span> <span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;obs_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;sim_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;prior_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;dkl_discriminant&#39;</span><span class="p">])</span>
<span class="n">noise_comp_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Sunset11</span><span class="p">,</span> <span class="n">TolRainbow23</span>

<span class="n">noise_ratio_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">1200</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">y_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="p">[</span><span class="mf">1e4</span><span class="p">,</span> <span class="mf">1e4</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Signal &gt; Noise&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;lightgreen&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="mf">3.75</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Signal &lt;= Noise&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.3</span><span class="p">)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span>
<span class="n">line_switch</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bitrates</span><span class="p">:</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">TolRainbow23</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
    <span class="n">nrs</span> <span class="o">=</span> <span class="n">noise_ratios</span><span class="p">[</span><span class="n">b</span><span class="p">]</span>
    <span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">priors</span><span class="p">,</span> <span class="n">nrs</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">c</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">:</span><span class="s1">.2f</span><span class="si">}</span><span class="s1"> bits&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="n">line_dash</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">&gt;</span> <span class="mi">22</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">line_switch</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span>
        <span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">line_switch</span> <span class="o">=</span> <span class="mi">1</span>        
    
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Prior } (\alpha =  10^x) \text{ Pseudo-Counts} $$&#39;</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text</span><span class="si">{SNR}</span><span class="s1">$$&#39;</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s1">&#39;hide&#39;</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_left&#39;</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">ncols</span> <span class="o">=</span> <span class="mi">4</span>
<span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">noise_ratio_plot</span><span class="o">.</span><span class="n">legend</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>
<span class="n">noise_ratio_plot</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">noise_ratio_plot</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">noise_ratio_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The plot above shows how the combination of quantization noise and the prior influence compares to the discriminant <span class="math notranslate nohighlight">\(D_\text{KL}(T||S_\text{post})\)</span>.  The discriminant can’t be considered meaningful if it is not greater than the epistemic uncertainty introduced by the models and methods.</p>
<p>The quantization noise has the same “flattening” effect on both the simulated and observed distributions, but different amounts of noise are added to each because they are distinct to begin with.  So it is the difference in how much the distributions are influenced that is important in comparison to the discriminant.</p>
<p><strong>Observation</strong>: Somewhere between 6 and 7 bits there is a threshold.  Below this threshold, the quantization adds more noise to the observed series, and above the threshold the quantization adds more noise to the simulated series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_adjusted_noise</span><span class="p">(</span><span class="n">row</span><span class="p">):</span>
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;obs_noise&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;sim_noise&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;prior_noise&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">b</span> <span class="o">+</span> <span class="n">c</span> <span class="o">-</span> <span class="n">a</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">tol</span>
<span class="c1"># noise_ratio_plot = figure(width=800, height=500)</span>
<span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="n">noise_decomp_plots</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">N</span> <span class="o">=</span> <span class="mi">8</span>
<span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">bitrates</span><span class="p">:</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">b</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">b</span> <span class="o">&gt;=</span> <span class="mi">8</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="c1"># c = Sunset10[n]</span>
    <span class="c1"># nrs = noise_ratios[b]</span>
    <span class="c1"># noise_ratio_plot.line(priors, nrs, color=c, legend_label=f&#39;{b} bits&#39;, line_width=2)</span>
    <span class="n">noise_decomp_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> bits dictionary&#39;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
    <span class="n">dat</span> <span class="o">=</span> <span class="n">noise_comp_df</span><span class="p">[</span><span class="n">noise_comp_df</span><span class="p">[</span><span class="s1">&#39;bitrate&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">b</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="c1"># dat[&#39;quant_noise_diff&#39;] = abs(dat[&#39;obs_noise&#39;] - dat[&#39;sim_noise&#39;])</span>
    <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;adjusted_error&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dat</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">compute_adjusted_noise</span><span class="p">(</span><span class="n">row</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">pstrings</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;adjusted_error&#39;</span><span class="p">,</span> <span class="s1">&#39;prior_noise&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">b</span> <span class="o">%</span> <span class="mi">1</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">dat</span><span class="p">[[</span><span class="s1">&#39;obs_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;sim_noise&#39;</span><span class="p">,</span> <span class="s1">&#39;prior&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pstrings</span><span class="p">]</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
    <span class="c1"># print(asdf)</span>
    
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">varea_stack</span><span class="p">(</span><span class="n">stackers</span><span class="o">=</span><span class="n">pstrings</span><span class="p">,</span> <span class="n">x</span><span class="o">=</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">tol</span><span class="p">[</span><span class="s1">&#39;Sunset&#39;</span><span class="p">][</span><span class="n">N</span><span class="p">][</span><span class="o">-</span><span class="mi">2</span><span class="p">:],</span> 
                                  <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.75</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="n">pstrings</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">dat</span><span class="p">)</span>
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">dat</span><span class="p">[</span><span class="s1">&#39;prior&#39;</span><span class="p">],</span> <span class="n">dat</span><span class="p">[</span><span class="s1">&#39;dkl_discriminant&#39;</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> 
                           <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;DKL(P||Q_post)&#39;</span><span class="p">)</span>
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Prior } (\alpha =  10^x) \text{ Pseudo-Counts} $$&#39;</span>
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Noise (bits/sample)}$$&#39;</span>
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_center&#39;</span>
    <span class="n">noise_decomp_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.5</span>
    <span class="n">noise_decomp_plots</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">noise_decomp_plot</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">(</span><span class="n">noise_decomp_plots</span><span class="p">,</span> <span class="n">ncols</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="formalize-the-problem-statement">
<h1>Formalize the problem statement<a class="headerlink" href="#formalize-the-problem-statement" title="Link to this heading">#</a></h1>
<ol class="arabic simple">
<li><p>Let <span class="math notranslate nohighlight">\(X_S\)</span> be the time series runoff at a (<strong>S</strong>urrogate) catchment used as a source/basis for regional information transfer.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(X_T\)</span> be the time series runoff at a (<strong>T</strong>arget) catchment where we want to simulate streamflow.</p></li>
<li><p>Let <span class="math notranslate nohighlight">\(\hat X_T\)</span> be a simulation of <span class="math notranslate nohighlight">\(X_T\)</span> based on a simple equal unit area runoff regional transfer model using the surrogate catchment:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(\hat X_T = \frac{A_T}{A_S} X_S\)</span></p></li>
</ul>
</li>
</ol>
<p>We want to evaluate how well the surrogate catchment represents the overall catchment response of the target.  A perfect representation corresponds to an exact match between FDCs, and otherwise the difference in overall basin response is quantified by the (Kullback-Leibler) divergence of the simulated distribution (<span class="math notranslate nohighlight">\(\hat T = \text{Pr}(\hat X_T)\)</span>) from the “ground truth” observed distribution (<span class="math notranslate nohighlight">\(T = \text{Pr}(X_T)\)</span>), expressed as <span class="math notranslate nohighlight">\(D_\text{KL}(T||\hat T)\)</span>.  The divergence represents the additional description length required to encode the simulated values, reflecting the errors in frequency estimation relative to the ‘ground truth’ distribution. The KL divergence can be interpreted as a discriminant function, quantifying how well a surrogate model approximates the ‘ground truth’ distribution. Comparing the divergence values for different surrogate catchments simulating the same target, the model with the lower divergence is preferred since it represents a closer match.  To compute the KL divergence, we first need to represent <span class="math notranslate nohighlight">\(X_T\)</span> and <span class="math notranslate nohighlight">\(\hat X_T\)</span> as distributions.  The problem setup is formalized as follows:</p>
<ol class="arabic simple" start="4">
<li><p>Let <span class="math notranslate nohighlight">\(T(b)\)</span> be a quantized representation of <span class="math notranslate nohighlight">\(X_T\)</span> to a dictionary size of <span class="math notranslate nohighlight">\(2^b\)</span> intervals, each representing a range of continuous values for b-bit precision</p>
<ul class="simple">
<li><p>A dictionary size of <span class="math notranslate nohighlight">\(2^b\)</span> symbols is defined by <span class="math notranslate nohighlight">\(2^b + 1\)</span> bin edges, where</p></li>
<li><p>the set of bin edges <span class="math notranslate nohighlight">\(B_T\)</span> are logarithmically spaced, i.e. <span class="math notranslate nohighlight">\([\log(\max(X_T)) - \log(\min(X_T))] / (2^b - 2)\)</span></p></li>
<li><p>The <span class="math notranslate nohighlight">\((2^b - 2)\)</span> denominator reserves two bins, one at each end of the distribution.</p></li>
<li><p>The quantization is 1-indexed, so</p>
<ul>
<li><p>the quantized representation of <span class="math notranslate nohighlight">\(X_T\)</span> will fall in the range <span class="math notranslate nohighlight">\([1, 2^b - 2]\)</span> (i.e. 14-symbol dictionary if b = 4).</p></li>
<li><p>simulated values <span class="math notranslate nohighlight">\(t_i &lt; \min(X_T)\)</span> are assigned index 0 (ie. the 15th symbol if b=4), and</p></li>
<li><p>simulated values <span class="math notranslate nohighlight">\(t_i &gt; \max(X_T)\)</span> are assigned index <span class="math notranslate nohighlight">\(2^b - 1\)</span> (i.e. the 16th symbol if b=4)</p></li>
</ul>
</li>
</ul>
</li>
<li><p><span class="math notranslate nohighlight">\(\hat T(b)\)</span> is then quantized representation of the simulated series <span class="math notranslate nohighlight">\(\hat X_T\)</span> using the bin edges <span class="math notranslate nohighlight">\(B_T\)</span> defined on the “ground truth” range.</p></li>
<li><p>Compute the discriminant, the quantization noise, and the noise due to the prior:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(D_\text{KL}(T(b)||\hat T(b))\)</span>: the discriminant quantifies the divergence between simulation <span class="math notranslate nohighlight">\(\hat T(b)\)</span> and ground truth distributions</p></li>
<li><p><span class="math notranslate nohighlight">\(D_\text{KL}(T(b)|| T(b_\text{max}))\)</span>: the quantization noise for <span class="math notranslate nohighlight">\(T\)</span>,</p></li>
<li><p><span class="math notranslate nohighlight">\(D_\text{KL}(\hat T(b)|| \hat T(b_\text{max}))\)</span>: the quantization noise for <span class="math notranslate nohighlight">\(T_hat\)</span>.</p></li>
<li><p><span class="math notranslate nohighlight">\(b_{\max}\)</span> is the size of dictionary where the noise added is uniform across all samples.  It represents a dictionary size that retains the full variance of the original series by assigning a unique symbol to each unique observation.  For the sample of observed series in the dataset, a dictionary size of <span class="math notranslate nohighlight">\(2^12\)</span> adds constant noise within 1% to all streamflow time series.</p></li>
</ul>
</li>
<li><p>Compute the (signal to epistemic noise) ratio of the discriminant to the total noise to determine the strength of “genuine difference” between the simulated and observed distributions <span class="math notranslate nohighlight">\(T\)</span> and <span class="math notranslate nohighlight">\(\hat T\)</span>.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new output filename </span>
<span class="n">attributes_filename</span> <span class="o">=</span> <span class="s1">&#39;BCUB_watershed_attributes_updated.csv&#39;</span>
<span class="n">attributes_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">attributes_filename</span><span class="p">)</span>
<span class="n">attr_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">attributes_fpath</span><span class="p">)</span>
<span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">e</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">attr_df</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
<span class="c1"># df.columns</span>
<span class="n">filtered_stns</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_kl_divergence</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">Q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the KL divergence DKL(P || Q).&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">P</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">P</span> <span class="o">/</span> <span class="n">Q</span><span class="p">),</span> <span class="n">where</span><span class="o">=</span><span class="p">(</span><span class="n">P</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">generate_and_plot_kl_vs_prior</span><span class="p">(</span><span class="n">mu1</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">mu2</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">priors</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mf">0.02</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates two log-normal distributions, quantizes them with 2^b symbols,</span>
<span class="sd">    computes the posterior with varying priors, and plots KL divergences DKL(P||R) and DKL(Q||R).</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - mu1, sigma1: Parameters for the first log-normal distribution.</span>
<span class="sd">    - mu2, sigma2: Parameters for the second log-normal distribution.</span>
<span class="sd">    - b: Number of symbols = 2^b for quantization.</span>
<span class="sd">    - priors: Array of prior pseudo-counts to apply to Q.</span>
<span class="sd">    - y_range: Range for the y-axis in the plot.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create the two log-normal distributions</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="mf">5.0</span>
    <span class="n">bins</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span><span class="p">,</span> <span class="mi">2</span> <span class="o">**</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">bins_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bins</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Evaluate the distributions at the bin midpoints</span>
    <span class="n">dist1</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma1</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu1</span><span class="p">))</span>
    <span class="n">dist2</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">bins_midpoints</span><span class="p">,</span> <span class="n">sigma2</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">mu2</span><span class="p">))</span>

    <span class="c1"># Normalize to create PDFs</span>
    <span class="n">P</span> <span class="o">=</span> <span class="n">dist1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist1</span><span class="p">)</span>
    <span class="n">Q</span> <span class="o">=</span> <span class="n">dist2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span>

    <span class="n">kl_p_r_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">kl_q_r_list</span><span class="p">,</span> <span class="n">ratio_list</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[]</span>

    <span class="c1"># Compute KL divergences for each prior value</span>
    <span class="k">for</span> <span class="n">prior_pseudo_count</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">:</span>
        <span class="n">prior_counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">prior_pseudo_count</span><span class="p">)</span>
        <span class="n">posterior_counts</span> <span class="o">=</span> <span class="n">Q</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">dist2</span><span class="p">)</span> <span class="o">+</span> <span class="n">prior_counts</span>  <span class="c1"># Adding pseudo-counts</span>
        <span class="n">R</span> <span class="o">=</span> <span class="n">posterior_counts</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">posterior_counts</span><span class="p">)</span>  <span class="c1"># Renormalize</span>

        <span class="c1"># Ensure valid PDFs</span>
        <span class="k">assert</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">R</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.001</span><span class="p">,</span> <span class="s1">&#39;R does not sum to 1&#39;</span>

        <span class="c1"># Compute KL divergences</span>
        <span class="n">kl_p_r</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>
        <span class="n">kl_q_r</span> <span class="o">=</span> <span class="n">compute_kl_divergence</span><span class="p">(</span><span class="n">Q</span><span class="p">,</span> <span class="n">R</span><span class="p">)</span>

        <span class="n">kl_p_r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kl_p_r</span><span class="p">)</span>
        <span class="n">kl_q_r_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">kl_q_r</span><span class="p">)</span>
        
        <span class="c1"># Compute ratio as percentage</span>
        <span class="n">ratio</span> <span class="o">=</span> <span class="p">(</span><span class="n">kl_q_r</span> <span class="o">/</span> <span class="n">kl_p_r</span><span class="p">)</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">if</span> <span class="n">kl_p_r</span> <span class="o">!=</span> <span class="mi">0</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="n">ratio_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ratio</span><span class="p">)</span>

    <span class="c1"># Prepare data for plotting</span>
    <span class="n">source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span>
        <span class="n">prior</span><span class="o">=</span><span class="n">priors</span><span class="p">,</span>
        <span class="n">kl_p_r</span><span class="o">=</span><span class="n">kl_p_r_list</span><span class="p">,</span>
        <span class="n">kl_q_r</span><span class="o">=</span><span class="n">kl_q_r_list</span><span class="p">,</span>
        <span class="n">ratio</span><span class="o">=</span><span class="n">ratio_list</span><span class="p">,</span>
    <span class="p">))</span>

    <span class="n">ratio_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ratio_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.98</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">ratio_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">1.02</span><span class="p">)</span>
    <span class="n">ratio_range</span> <span class="o">=</span> <span class="p">(</span><span class="nb">min</span><span class="p">(</span><span class="n">ratio_list</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.98</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

    <span class="c1"># Create the Bokeh plot</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span>
               <span class="n">x_axis_label</span><span class="o">=</span><span class="s1">&#39;Prior Pseudo-count&#39;</span><span class="p">,</span>
               <span class="n">y_axis_label</span><span class="o">=</span><span class="s1">&#39;KL Divergence&#39;</span><span class="p">,</span>
               <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">,</span>
               <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span>
               <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>

    <span class="c1"># Add secondary y-axis for the ratio</span>
    <span class="n">p</span><span class="o">.</span><span class="n">extra_y_ranges</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ratio&quot;</span><span class="p">:</span> <span class="n">Range1d</span><span class="p">(</span><span class="o">*</span><span class="n">ratio_range</span><span class="p">)}</span>
    <span class="n">p</span><span class="o">.</span><span class="n">add_layout</span><span class="p">(</span><span class="n">LinearAxis</span><span class="p">(</span><span class="n">y_range_name</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span> <span class="n">axis_label</span><span class="o">=</span><span class="s1">&#39;Noise (%)&#39;</span><span class="p">),</span> <span class="s1">&#39;right&#39;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;kl_p_r&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;DKL(P || R)&#39;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;kl_q_r&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;DKL(Q || R)&#39;</span><span class="p">)</span>

    <span class="c1"># Plot the ratio on the secondary y-axis</span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;prior&#39;</span><span class="p">,</span> <span class="s1">&#39;ratio&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">source</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> 
           <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">y_range_name</span><span class="o">=</span><span class="s2">&quot;ratio&quot;</span><span class="p">,</span>
           <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Prior Influence (%)&#39;</span><span class="p">)</span>

    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">priors</span><span class="p">,</span> <span class="p">[</span><span class="mi">5</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">priors</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span>
           <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dotted&#39;</span><span class="p">,</span> <span class="n">y_range_name</span><span class="o">=</span><span class="s1">&#39;ratio&#39;</span><span class="p">,</span>
           <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;5% noise limit&#39;</span><span class="p">)</span>

    <span class="c1"># Configure the legend and show the plot</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span> <span class="o">=</span> <span class="s2">&quot;hide&quot;</span>
    <span class="k">return</span> <span class="n">p</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">=</span> <span class="mf">0.25</span><span class="p">,</span> <span class="mf">0.35</span>
<span class="n">priors</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">6</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="n">prior_vs_kld</span> <span class="o">=</span> <span class="n">generate_and_plot_kl_vs_prior</span><span class="p">(</span><span class="n">mu</span><span class="p">,</span> <span class="n">sigma</span><span class="p">,</span> <span class="n">mu</span><span class="o">+</span><span class="mf">0.025</span><span class="p">,</span> <span class="n">sigma</span> <span class="o">-</span> <span class="mf">0.02</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="n">priors</span><span class="p">)</span>
<span class="n">prior_vs_kld</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">prior_vs_kld</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">prior_vs_kld</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
  <div id="ef3b955d-70d2-4646-8ec1-a7baa8092998" data-root-id="p2028" style="display: contents;"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
  const docs_json = {"d155c18e-e5c6-477e-bc28-b4323a6884d1":{"version":"3.6.0","title":"Bokeh Application","roots":[{"type":"object","name":"Figure","id":"p2028","attributes":{"height":400,"x_range":{"type":"object","name":"DataRange1d","id":"p2030"},"y_range":{"type":"object","name":"Range1d","id":"p2038","attributes":{"end":0.02}},"x_scale":{"type":"object","name":"LogScale","id":"p2039"},"y_scale":{"type":"object","name":"LinearScale","id":"p2040"},"extra_y_ranges":{"type":"map","entries":[["ratio",{"type":"object","name":"Range1d","id":"p2064","attributes":{"start":0.0030549570142611895,"end":10}}]]},"title":{"type":"object","name":"Title","id":"p2031"},"renderers":[{"type":"object","name":"GlyphRenderer","id":"p2075","attributes":{"data_source":{"type":"object","name":"ColumnDataSource","id":"p2025","attributes":{"selected":{"type":"object","name":"Selection","id":"p2026","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p2027"},"data":{"type":"map","entries":[["prior",{"type":"ndarray","array":{"type":"bytes","data":"je21oPfGsD6YBnWnuGmyPtg28aVNNbQ+hDL6qbEttj5BZ6McQ1e4PoQmLHLNtro+3ICxy5NRvT7cYh5RrhbAPuj/hko/qME+tsbDO/dgwz5iVvJep0TFPoxUdzWAV8c+AgEd0hqeyT6k5Q4Lgx3MPnrgTapC284+zwO22rbu0D7xk+XzV5XSPlEioL4tZdQ+WDL0tjxi1j4azpaf7ZDYPg3ZvkgX9to+aOYGSwmX3T5ILxDnyzzgPqFMujoU0uE+qieuR+CO4z4yiDBTCnflPii5hsvMjuc+1x8XqMva6T70PYyzHmDsPp/sytZcJO8++ArjPtQW8T5DmNWYXsHyPldYSEN/lfQ+fTfgPkSX9j4HHXnAIMv4PtHFKg/3Nfs+w0CWWCPd/T4mnL/JQ2MAP97EhUVM/AE/2bjKFza9Az+aP2em5KkFP0vkBGScxgc/kbN0RgwYCj+jyTIpWKMMPw2LHTMkbg8/9Q9TrFA/ET8rSRuLze0SP98an0BDxhQ//GGmaMnMFj+nO/PC3QUZP2JGpyhudhs/Kf84euMjHj9KoxrPFoogP8P/slXoJiI//0nHrfnrIz9G4mNzN90lP53jUTXw/ic/2afYAd5VKj/dodvhMOcsP7v1kVmauC8/PaMsBC1oMT+E59DBpRozP8JE1sV69zQ/PHzpXc0CNz8V2qztJUE5P8w/tft9tzs/7ihkOUtrPj++EArPRbFAP//QN1jpUUI/zCK0DSwbRD+70pHXAxFGP4EUrXjJN0g/QOkMMkKUSj/8jtVWqitNPzo4IHTgAVA/LL2rKWqRUT+iHVo26EdTPxUuouQmKVU/4nENS1E5Vz/IiVOK+nxZPyjsJvIn+Vs/fukwI1yzXj+rM3aj0dhgP2FuOzxQfWI/E6kJPs5KZD/JowDzSkVmPx/yO2opcWg/C90JMjrTaj8NO+0ExnBtP+Yji8DMJ3A/gq0mAgm7cT8hamnklXVzPxWeP7FIW3U/odY9X1Zwdz/j5qHlXLl5P7C2J3ltO3w/uzBlyBf8fj8EmksouwCBP/ehG/MdqYI/exSuR+F6hD8="},"shape":[100],"dtype":"float64","order":"little"}],["kl_p_r",[0.006460910939676022,0.006460768270300183,0.006460612800077066,0.006460443395947962,0.006460258827337774,0.006460057758296772,0.0064598387391071104,0.0064596001973528305,0.006459340428433209,0.006459057585520792,0.006458749668967996,0.006458414515175204,0.006458049784951165,0.006457652951407825,0.006457221287455269,0.006456751852984421,0.0064562414818516755,0.006455686768821207,0.006455084056649251,0.006454429423551299,0.006453718671344115,0.0064529473146125,0.006452110571339662,0.006451203355499669,0.0064502202722341775,0.006449155616319604,0.0064480033747695495,0.0064467572345428695,0.006445410596483748,0.006443956596780053,0.006442388137407802,0.006440697927222001,0.0064388785355594105,0.006436922460443786,0.006434822213715243,0.006432570425658325,0.006430159971962545,0.0064275841261364815,0.006424836740788068,0.006421912461504257,0.006418806977412993,0.006415517312880853,0.006412042165217706,0.006408382293725569,0.006404540965944487,0.006400524467548551,0.006396342683008824,0.006392009754920559,0.006387544830756365,0.00638297290682037,0.006378325780295504,0.006373643121565035,0.006368973680414299,0.006364376641323045,0.006359923144838165,0.006355697993978709,0.006351801566803098,0.006348351958637767,0.006345487380088329,0.006343368839793931,0.006342183144006854,0.006342146248458708,0.006343507001656987,0.006346551322765738,0.0063516068615468435,0.006359048192538482,0.006369302600710631,0.006382856521297675,0.006400262702371031,0.0064221481649886026,0.006449223042451045,0.00648229038729311,0.006522257042122987,0.006570145678269347,0.006627108114343309,0.006694440035210047,0.006773597240372574,0.006866213559289799,0.006974120579484534,0.007099369341227865,0.0072442541598370155,0.00741133874282511,0.0076034847738639475,0.007823883138232115,0.008076087964450482,0.008364053653391953,0.008692175058349306,0.009065330966236301,0.009488931010000225,0.009968966113915737,0.010512062534975372,0.011125539513103787,0.011817470478164708,0.012596747680234683,0.013473150008657613,0.014457413642082376,0.015561305023000797,0.016797695473174876,0.018180636557867114,0.019725435064330655]],["kl_q_r",[2.0140617544571546e-07,2.2258742011852267e-07,2.46027360410894e-07,2.719726334658222e-07,3.006978858232366e-07,3.3250915669688234e-07,3.677476970741844e-07,4.067943006318757e-07,4.5007420998099044e-07,4.98062686831101e-07,5.512913437308706e-07,6.103553475297785e-07,6.759216284229658e-07,7.487382430494947e-07,8.296450682752494e-07,9.195860276808594e-07,1.0196230819973183e-06,1.1309522590907922e-06,1.254922029923762e-06,1.3930543931336486e-06,1.547069083385304e-06,1.7189113739240954e-06,1.9107840311075103e-06,2.1251840332538943e-06,2.364944784420023e-06,2.633284630026847e-06,2.933862611215958e-06,3.2708425103575584e-06,3.6489663845128007e-06,4.073638933893206e-06,4.551024221872864e-06,5.088156447232335e-06,5.693066666619153e-06,6.374927586088028e-06,7.144218771893794e-06,8.012914886674818e-06,8.994699827668474e-06,1.0105209946598246e-05,1.1362309844698757e-05,1.2786404587921185e-05,1.4400792571197255e-05,1.6232063674580504e-05,1.8310547816689803e-05,2.0670819526507722e-05,2.3352264718069055e-05,2.6399716501332633e-05,2.9864167568583572e-05,3.380356751080604e-05,3.828371431136495e-05,4.337925029148038e-05,4.9174773903940905e-05,5.5766080050475154e-05,6.326154300198095e-05,7.178365757150356e-05,8.147075592393618e-05,9.247891931487884e-05,0.00010498410616562341,0.00011918452018090789,0.00013530324476235755,0.00015359117272928575,0.00017433026339476,0.00019783716233607966,0.0002244672227864771,0.0002546189714880625,0.0002887390660637702,0.00032732779555562017,0.000370945180720415,0.0004202177360042642,0.0004758459608393349,0.0005386126340249629,0.0006093919914783744,0.00068915987455106,0.0007790049433865228,0.0008801410574141039,0.0009939209329741143,0.0011218511961834103,0.00126560895736303,0.0014270600415437242,0.0016082790175490033,0.0018115711757057426,0.0020394966110737255,0.0022948965748472608,0.0025809222608354017,0.0029010661961371463,0.0032591964046282526,0.003659593507901738,0.004106990919913624,0.004606618277667281,0.005164248229537356,0.005786246673777995,0.00647962650064292,0.0072521048403904765,0.008112163754028345,0.009069114221510612,0.01013316318052236,0.011315483245101647,0.012628284584151647,0.014084888262339796,0.015699800137087,0.017488784162712545]],["ratio",[0.003117303075776724,0.0034452159682269597,0.003808111831248565,0.004209813735639344,0.004654579543326935,0.005147154547803148,0.005692830919259373,0.006297515143407508,0.0069678044526004556,0.00771107363940528,0.008535573787286263,0.009450544651410018,0.010466342795901456,0.011594587827552164,0.012848329511132564,0.014242238955734546,0.015792827527648275,0.01751869784873874,0.01944083173682444,0.02158292083961117,0.023971746556828082,0.026637616737264752,0.029614868033961347,0.03294244369838643,0.03666455848957964,0.04083146363166232,0.04550032685615357,0.05073624446150699,0.05661340468369029,0.06321642414427095,0.0706418819357885,0.07900007894683173,0.08841705329862289,0.09903688641991994,0.11102433811872123,0.12456785322882426,0.13988298684462136,0.15721630006377413,0.17684978316359617,0.19910586861107918,0.2243531020931445,0.25301254572238985,0.2855649938800443,0.32255908869148564,0.3646204285715777,0.41246176989374,0.46689442777846196,0.5288409875279697,0.5993494421679336,0.6796088738701763,0.7709667959553904,0.8749482672130207,0.9932768790758422,1.1278976970882253,1.2810022081801318,1.455055281142873,1.6528240855997423,1.8774088292118347,2.132275058759539,2.4212871205874142,2.7487421828790315,3.119403977544018,3.5385351151633317,4.011926454840407,4.545921565325785,5.147433792681378,5.823952855985021,6.583537239198842,7.434787960548148,8.386798625439667,9.449076074236274,10.631425520553407,11.943793971250138,13.396066092189654,14.99780772887849,16.75795421697598,18.68444361911038,20.783799239872913,23.06067122326516,25.517353565273503,28.15330006477314,30.96466987248345,33.943939359318605,37.07962075712536,40.35612810279756,43.75382630906042,47.24928907142334,50.81577600227247,54.42392008219726,58.04259546735684,61.639915849854674,65.18429809043296,68.64551740592282,71.99568056555412,75.21005239317431,78.26768691299489,81.1518350516623,83.85012268398778,86.35451287481676,88.66108202772863]]]}}},"view":{"type":"object","name":"CDSView","id":"p2076","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p2077"}}},"glyph":{"type":"object","name":"Line","id":"p2072","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_p_r"},"line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p2073","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_p_r"},"line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p2074","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_p_r"},"line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p2086","attributes":{"data_source":{"id":"p2025"},"view":{"type":"object","name":"CDSView","id":"p2087","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p2088"}}},"glyph":{"type":"object","name":"Line","id":"p2083","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_q_r"},"line_color":"red","line_width":2}},"nonselection_glyph":{"type":"object","name":"Line","id":"p2084","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_q_r"},"line_color":"red","line_alpha":0.1,"line_width":2}},"muted_glyph":{"type":"object","name":"Line","id":"p2085","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"kl_q_r"},"line_color":"red","line_alpha":0.2,"line_width":2}}}},{"type":"object","name":"GlyphRenderer","id":"p2096","attributes":{"y_range_name":"ratio","data_source":{"id":"p2025"},"view":{"type":"object","name":"CDSView","id":"p2097","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p2098"}}},"glyph":{"type":"object","name":"Line","id":"p2093","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"ratio"},"line_color":"red","line_width":2,"line_dash":[6]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p2094","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"ratio"},"line_color":"red","line_alpha":0.1,"line_width":2,"line_dash":[6]}},"muted_glyph":{"type":"object","name":"Line","id":"p2095","attributes":{"x":{"type":"field","field":"prior"},"y":{"type":"field","field":"ratio"},"line_color":"red","line_alpha":0.2,"line_width":2,"line_dash":[6]}}}},{"type":"object","name":"GlyphRenderer","id":"p2106","attributes":{"y_range_name":"ratio","data_source":{"type":"object","name":"ColumnDataSource","id":"p2100","attributes":{"selected":{"type":"object","name":"Selection","id":"p2101","attributes":{"indices":[],"line_indices":[]}},"selection_policy":{"type":"object","name":"UnionRenderers","id":"p2102"},"data":{"type":"map","entries":[["x",{"type":"ndarray","array":{"type":"bytes","data":"je21oPfGsD6YBnWnuGmyPtg28aVNNbQ+hDL6qbEttj5BZ6McQ1e4PoQmLHLNtro+3ICxy5NRvT7cYh5RrhbAPuj/hko/qME+tsbDO/dgwz5iVvJep0TFPoxUdzWAV8c+AgEd0hqeyT6k5Q4Lgx3MPnrgTapC284+zwO22rbu0D7xk+XzV5XSPlEioL4tZdQ+WDL0tjxi1j4azpaf7ZDYPg3ZvkgX9to+aOYGSwmX3T5ILxDnyzzgPqFMujoU0uE+qieuR+CO4z4yiDBTCnflPii5hsvMjuc+1x8XqMva6T70PYyzHmDsPp/sytZcJO8++ArjPtQW8T5DmNWYXsHyPldYSEN/lfQ+fTfgPkSX9j4HHXnAIMv4PtHFKg/3Nfs+w0CWWCPd/T4mnL/JQ2MAP97EhUVM/AE/2bjKFza9Az+aP2em5KkFP0vkBGScxgc/kbN0RgwYCj+jyTIpWKMMPw2LHTMkbg8/9Q9TrFA/ET8rSRuLze0SP98an0BDxhQ//GGmaMnMFj+nO/PC3QUZP2JGpyhudhs/Kf84euMjHj9KoxrPFoogP8P/slXoJiI//0nHrfnrIz9G4mNzN90lP53jUTXw/ic/2afYAd5VKj/dodvhMOcsP7v1kVmauC8/PaMsBC1oMT+E59DBpRozP8JE1sV69zQ/PHzpXc0CNz8V2qztJUE5P8w/tft9tzs/7ihkOUtrPj++EArPRbFAP//QN1jpUUI/zCK0DSwbRD+70pHXAxFGP4EUrXjJN0g/QOkMMkKUSj/8jtVWqitNPzo4IHTgAVA/LL2rKWqRUT+iHVo26EdTPxUuouQmKVU/4nENS1E5Vz/IiVOK+nxZPyjsJvIn+Vs/fukwI1yzXj+rM3aj0dhgP2FuOzxQfWI/E6kJPs5KZD/JowDzSkVmPx/yO2opcWg/C90JMjrTaj8NO+0ExnBtP+Yji8DMJ3A/gq0mAgm7cT8hamnklXVzPxWeP7FIW3U/odY9X1Zwdz/j5qHlXLl5P7C2J3ltO3w/uzBlyBf8fj8EmksouwCBP/ehG/MdqYI/exSuR+F6hD8="},"shape":[100],"dtype":"float64","order":"little"}],["y",[5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5]]]}}},"view":{"type":"object","name":"CDSView","id":"p2107","attributes":{"filter":{"type":"object","name":"AllIndices","id":"p2108"}}},"glyph":{"type":"object","name":"Line","id":"p2103","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_width":2,"line_dash":[2,4]}},"nonselection_glyph":{"type":"object","name":"Line","id":"p2104","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.1,"line_width":2,"line_dash":[2,4]}},"muted_glyph":{"type":"object","name":"Line","id":"p2105","attributes":{"x":{"type":"field","field":"x"},"y":{"type":"field","field":"y"},"line_color":"red","line_alpha":0.2,"line_width":2,"line_dash":[2,4]}}}}],"toolbar":{"type":"object","name":"Toolbar","id":"p2037","attributes":{"tools":[{"type":"object","name":"PanTool","id":"p2051"},{"type":"object","name":"WheelZoomTool","id":"p2052","attributes":{"renderers":"auto"}},{"type":"object","name":"BoxZoomTool","id":"p2053","attributes":{"overlay":{"type":"object","name":"BoxAnnotation","id":"p2054","attributes":{"syncable":false,"line_color":"black","line_alpha":1.0,"line_width":2,"line_dash":[4,4],"fill_color":"lightgrey","fill_alpha":0.5,"level":"overlay","visible":false,"left":{"type":"number","value":"nan"},"right":{"type":"number","value":"nan"},"top":{"type":"number","value":"nan"},"bottom":{"type":"number","value":"nan"},"left_units":"canvas","right_units":"canvas","top_units":"canvas","bottom_units":"canvas","handles":{"type":"object","name":"BoxInteractionHandles","id":"p2060","attributes":{"all":{"type":"object","name":"AreaVisuals","id":"p2059","attributes":{"fill_color":"white","hover_fill_color":"lightgray"}}}}}}}},{"type":"object","name":"SaveTool","id":"p2061"},{"type":"object","name":"ResetTool","id":"p2062"},{"type":"object","name":"HelpTool","id":"p2063"}]}},"left":[{"type":"object","name":"LinearAxis","id":"p2046","attributes":{"ticker":{"type":"object","name":"BasicTicker","id":"p2047","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p2048"},"axis_label":"KL Divergence","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p2049"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"right":[{"type":"object","name":"LinearAxis","id":"p2065","attributes":{"y_range_name":"ratio","ticker":{"type":"object","name":"BasicTicker","id":"p2066","attributes":{"mantissas":[1,2,5]}},"formatter":{"type":"object","name":"BasicTickFormatter","id":"p2067"},"axis_label":"Noise (%)","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p2068"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"below":[{"type":"object","name":"LogAxis","id":"p2041","attributes":{"ticker":{"type":"object","name":"LogTicker","id":"p2042","attributes":{"num_minor_ticks":10,"mantissas":[1,5]}},"formatter":{"type":"object","name":"LogTickFormatter","id":"p2043"},"axis_label":"Prior Pseudo-count","axis_label_text_font":"Bitstream Charter","axis_label_text_font_size":"20pt","major_label_policy":{"type":"object","name":"AllLabels","id":"p2044"},"major_label_text_font":"Bitstream Charter","major_label_text_font_size":"18pt"}}],"center":[{"type":"object","name":"Grid","id":"p2045","attributes":{"axis":{"id":"p2041"}}},{"type":"object","name":"Grid","id":"p2050","attributes":{"dimension":1,"axis":{"id":"p2046"}}},{"type":"object","name":"Legend","id":"p2078","attributes":{"location":"top_left","click_policy":"hide","label_text_font":"Bitstream Charter","label_text_font_size":"18pt","items":[{"type":"object","name":"LegendItem","id":"p2079","attributes":{"label":{"type":"value","value":"DKL(P || R)"},"renderers":[{"id":"p2075"}]}},{"type":"object","name":"LegendItem","id":"p2089","attributes":{"label":{"type":"value","value":"DKL(Q || R)"},"renderers":[{"id":"p2086"}]}},{"type":"object","name":"LegendItem","id":"p2099","attributes":{"label":{"type":"value","value":"Prior Influence (%)"},"renderers":[{"id":"p2096"}]}},{"type":"object","name":"LegendItem","id":"p2109","attributes":{"label":{"type":"value","value":"5% noise limit"},"renderers":[{"id":"p2106"}]}}]}}]}}]}};
  const render_items = [{"docid":"d155c18e-e5c6-477e-bc28-b4323a6884d1","roots":{"p2028":"ef3b955d-70d2-4646-8ec1-a7baa8092998"},"root_ids":["p2028"]}];
  void root.Bokeh.embed.embed_items_notebook(docs_json, render_items);
  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    let attempts = 0;
    const timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
<p>Let’s run through an example computation to see the difference between 4, 6, and 8 bit quantization, how each represents the total measurement range, and how each quantization aligns with your own expectation of heteroscedastic rating curve uncertainty.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Step 1: Compute L-moments</span>
<span class="k">def</span> <span class="nf">compute_l_moments</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
    
    <span class="c1"># Calculate L-moment ratios using probability weighted moments (PWM)</span>
    <span class="n">b0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">)</span>
    <span class="n">b1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">k</span> <span class="o">/</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">*</span> <span class="n">sorted_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">b2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">([(</span><span class="n">k</span> <span class="o">*</span> <span class="p">(</span><span class="n">k</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span> <span class="o">/</span> <span class="p">((</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">n</span> <span class="o">-</span> <span class="mi">2</span><span class="p">))</span> <span class="o">*</span> <span class="n">sorted_data</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">n</span><span class="p">)])</span> <span class="o">/</span> <span class="n">n</span>
    <span class="n">l1</span> <span class="o">=</span> <span class="n">b0</span>
    <span class="n">l2</span> <span class="o">=</span> <span class="mi">2</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">-</span> <span class="n">b0</span>
    <span class="n">l3</span> <span class="o">=</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">b2</span> <span class="o">-</span> <span class="mi">6</span> <span class="o">*</span> <span class="n">b1</span> <span class="o">+</span> <span class="n">b0</span>

    <span class="c1"># L-moment ratios (L-skewness and L-kurtosis)</span>
    <span class="n">tau3</span> <span class="o">=</span> <span class="n">l3</span> <span class="o">/</span> <span class="n">l2</span>
    <span class="n">tau4</span> <span class="o">=</span> <span class="p">(</span><span class="n">l3</span> <span class="o">-</span> <span class="n">l2</span><span class="p">)</span> <span class="o">/</span> <span class="n">l2</span>  <span class="c1"># Approximation for L-kurtosis</span>

    <span class="k">return</span> <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">tau3</span><span class="p">,</span> <span class="n">tau4</span>

<span class="c1"># Step 2: Estimate initial Kappa parameters using L-moments</span>
<span class="k">def</span> <span class="nf">initial_kappa_params</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">l1</span><span class="p">,</span> <span class="n">l2</span><span class="p">,</span> <span class="n">tau3</span><span class="p">,</span> <span class="n">tau4</span> <span class="o">=</span> <span class="n">compute_l_moments</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    
    <span class="c1"># Use L-moment formulas to estimate the shape and scale of Kappa distribution</span>
    <span class="n">h</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tau3</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">tau3</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.1</span>  <span class="c1"># Example heuristic</span>
    <span class="n">k</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">tau4</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span> <span class="k">if</span> <span class="n">tau4</span> <span class="o">&lt;</span> <span class="mi">1</span> <span class="k">else</span> <span class="mf">0.1</span>  <span class="c1"># Example heuristic</span>

    <span class="n">loc</span> <span class="o">=</span> <span class="n">l1</span>  <span class="c1"># Initial guess for location</span>
    <span class="n">scale</span> <span class="o">=</span> <span class="n">l2</span>  <span class="c1"># Initial guess for scale</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;initial params: &#39;</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span>

<span class="c1"># Step 3: Define constraints based on Castellarin (e.g., ensuring kK &lt;= 0 and hK &gt; 0)</span>
<span class="k">def</span> <span class="nf">constrained_optimization</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">initial_params</span> <span class="o">=</span> <span class="n">initial_kappa_params</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>

    <span class="c1"># Define the objective function as the negative log-likelihood</span>
    <span class="k">def</span> <span class="nf">neg_log_likelihood</span><span class="p">(</span><span class="n">params</span><span class="p">):</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">params</span>
        <span class="k">if</span> <span class="n">scale</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1"># Enforce positive scale</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span>
        <span class="k">return</span> <span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">kappa4</span><span class="o">.</span><span class="n">logpdf</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="n">loc</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">scale</span><span class="p">))</span>

    <span class="c1"># Constrain h &gt; 0, k &lt;= 0, and enforce scale &gt; 0</span>
    <span class="n">constraints</span> <span class="o">=</span> <span class="p">[</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]},</span>  <span class="c1"># h &gt; 0</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]},</span>  <span class="c1"># k &lt;= 0</span>
        <span class="p">{</span><span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;ineq&#39;</span><span class="p">,</span> <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">-</span> <span class="mf">1e-5</span><span class="p">}</span>  <span class="c1"># scale &gt; 0</span>
    <span class="p">]</span>
    
    <span class="c1"># Run the constrained optimization</span>
    <span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
        <span class="n">neg_log_likelihood</span><span class="p">,</span>
        <span class="n">initial_params</span><span class="p">,</span>
        <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span>
        <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="n">result</span><span class="o">.</span><span class="n">success</span><span class="p">:</span>
        <span class="n">h</span><span class="p">,</span> <span class="n">k</span><span class="p">,</span> <span class="n">loc</span><span class="p">,</span> <span class="n">scale</span> <span class="o">=</span> <span class="n">result</span><span class="o">.</span><span class="n">x</span>
        <span class="k">return</span> <span class="p">{</span><span class="s1">&#39;h&#39;</span><span class="p">:</span> <span class="n">h</span><span class="p">,</span> <span class="s1">&#39;k&#39;</span><span class="p">:</span> <span class="n">k</span><span class="p">,</span> <span class="s1">&#39;loc&#39;</span><span class="p">:</span> <span class="n">loc</span><span class="p">,</span> <span class="s1">&#39;scale&#39;</span><span class="p">:</span> <span class="n">scale</span><span class="p">}</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Optimization did not converge&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_MLE_fit_plot</span><span class="p">(</span><span class="n">b</span><span class="p">,</span> <span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">):</span>
    <span class="n">test_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                     <span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  

    <span class="c1"># plot empirical (discrete) distributions using linear and log binning</span>
    <span class="n">b</span><span class="o">=</span><span class="mi">8</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">_bit_log&#39;</span>
    <span class="n">bin_edges</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">log_bin_edges</span><span class="p">,</span> <span class="n">log_freqs</span> <span class="o">=</span> <span class="n">compute_discrete_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">stn</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">top</span><span class="o">=</span><span class="n">freqs</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">],</span> 
                  <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="w"> </span><span class="si">}</span><span class="s1">bits linear bins&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Sunset10</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">left</span><span class="o">=</span><span class="n">log_bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">log_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span> <span class="n">top</span><span class="o">=</span><span class="n">log_freqs</span><span class="p">,</span> 
                  <span class="n">bottom</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span> <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="n">freqs</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1"> bits log bins&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">Sunset10</span><span class="p">[</span><span class="mi">8</span><span class="p">],</span> 
                  <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.6</span><span class="p">)</span>

    <span class="c1"># fit and plot a lognormal distribution</span>
    <span class="n">ln_shape</span><span class="p">,</span> <span class="n">ln_loc</span><span class="p">,</span> <span class="n">ln_scale</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>  <span class="c1"># Fixing location to 0</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1000</span><span class="p">)</span>
    <span class="n">ln_mle_pdf</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ln_shape</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ln_scale</span><span class="p">)</span>

    <span class="c1"># fit and plot an exponential distribution</span>
    <span class="n">ex_loc</span><span class="p">,</span> <span class="n">ex_scale</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">ex_mle_pdf</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">pdf</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="n">ex_scale</span><span class="p">)</span>

    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ln_mle_pdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;LN MLE pdf&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">ex_mle_pdf</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;EXP MLE pdf&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">background_fill_alpha</span> <span class="o">=</span> <span class="mf">0.6</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s1">&#39;top_right&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">click_policy</span><span class="o">=</span><span class="s1">&#39;hide&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$\text{Mean Daily Flow } [m^3/s]$$&#39;</span>
    <span class="n">test_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s1">&#39;$$P(X)$$&#39;</span>
    <span class="n">test_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">test_fig</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">test_fig</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">create_logspace_bins</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">num_bins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create linearly spaced bins in log space over the range of `data`.&quot;&quot;&quot;</span>
    <span class="n">min_val</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">data</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">min_val</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">max_val</span><span class="p">)</span>
    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span><span class="p">,</span> <span class="n">num_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">bin_edges</span>

<span class="k">def</span> <span class="nf">calculate_probabilities</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the probabilities of data falling into each bin given `bin_edges`.&quot;&quot;&quot;</span>
    <span class="n">counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">)</span>
    <span class="n">probabilities</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>  <span class="c1"># Normalize to get probabilities</span>
    <span class="k">return</span> <span class="n">probabilities</span>

<span class="k">def</span> <span class="nf">aggregate_probabilities</span><span class="p">(</span><span class="n">high_res_probs</span><span class="p">,</span> <span class="n">high_res_bins</span><span class="p">,</span> <span class="n">low_res_bins</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aggregate high-resolution probabilities to match low-resolution bins.</span>
<span class="sd">    This will sum the high_res_probs that fall within each low-res bin.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">low_res_probs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">low_res_bins</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">):</span>
        <span class="c1"># Find indices of high-resolution bins that fall within the current low-res bin</span>
        <span class="n">indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">((</span><span class="n">high_res_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&gt;=</span> <span class="n">low_res_bins</span><span class="p">[</span><span class="n">i</span><span class="p">])</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">high_res_bins</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">low_res_bins</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]))[</span><span class="mi">0</span><span class="p">]</span>
        <span class="c1"># Sum probabilities within the range</span>
        <span class="n">low_res_probs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">high_res_probs</span><span class="p">[</span><span class="n">indices</span><span class="p">]))</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">low_res_probs</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">compute_kl_divergence</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">q</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute KL divergence between two probability distributions `p` and `q`.&quot;&quot;&quot;</span>
    <span class="c1"># Avoid division by zero and log of zero by adding a small epsilon</span>
    <span class="c1"># epsilon = 1e-10</span>
    <span class="c1"># p = np.maximum(p, epsilon)</span>
    <span class="c1"># q = np.maximum(q, epsilon)</span>
    <span class="n">kl_divergence</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">p</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span> <span class="o">/</span> <span class="n">q</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">kl_divergence</span>

<span class="k">def</span> <span class="nf">compute_discrete_distributions</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">label</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">log_bins</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
    <span class="c1"># 1. Determine the log-spaced bin edges</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">vals</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">vals</span><span class="p">)</span>
    <span class="n">log_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">minx</span><span class="p">)</span>  <span class="c1"># Avoid log(0) error</span>
    <span class="n">log_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">maxx</span><span class="p">)</span>
    <span class="n">log_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">log_min</span><span class="p">,</span> <span class="n">log_max</span><span class="p">,</span> <span class="mi">2</span><span class="o">**</span><span class="n">b</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>

    <span class="c1"># 2. Compute the histogram using log-spaced bins</span>
    <span class="n">log_freqs</span><span class="p">,</span> <span class="n">log_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">log_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># 3. Calculate the bin midpoints in log space</span>
    <span class="n">log_bin_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">log_bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="n">log_bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">**</span> <span class="mf">0.5</span>  <span class="c1"># Geometric mean</span>

    <span class="n">freqs</span><span class="p">,</span> <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">2</span><span class="o">**</span><span class="n">b</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">bin_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">bin_edges</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">bin_edges</span><span class="p">[</span><span class="mi">1</span><span class="p">:])</span> <span class="o">/</span> <span class="mi">2</span>
    
    <span class="k">return</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">log_bin_edges</span><span class="p">,</span> <span class="n">log_freqs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">quantization_noise_results</span> <span class="o">=</span> <span class="p">{}</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">filtered_stns</span><span class="p">:</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">get_timeseries_data</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">test_bs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
    <span class="n">quantization_noise_results</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kl_divergence_between_quantizations</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_bs</span><span class="p">),</span> <span class="n">stn</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">test_bs</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">35</span><span class="p">],</span> <span class="n">line</span> <span class="mi">6</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">test_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">test_bs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">quantization_noise_results</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kl_divergence_between_quantizations</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_bs</span><span class="p">),</span> <span class="n">stn</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">test_bs</span><span class="p">]</span>

<span class="nn">Cell In[35], line 6,</span> in <span class="ni">&lt;listcomp&gt;</span><span class="nt">(.0)</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="n">test_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="g g-Whitespace">      </span><span class="mi">5</span> <span class="n">test_bs</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">,</span> <span class="mi">15</span><span class="p">,</span> <span class="mi">16</span><span class="p">]</span>
<span class="ne">----&gt; </span><span class="mi">6</span> <span class="n">quantization_noise_results</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">kl_divergence_between_quantizations</span><span class="p">(</span><span class="n">test_df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_bs</span><span class="p">),</span> <span class="n">stn</span><span class="p">)</span> <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">test_bs</span><span class="p">]</span>

<span class="ne">NameError</span>: name &#39;kl_divergence_between_quantizations&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">qn_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="o">.</span><span class="n">from_dict</span><span class="p">(</span><span class="n">quantization_noise_results</span><span class="p">,</span> <span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">test_bs</span><span class="p">)</span>
<span class="n">bounds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">qn_fig</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">)</span>
<span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mf">98.5</span><span class="p">]:</span>
    <span class="n">bounds</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">qn_df</span><span class="p">[</span><span class="n">c</span><span class="p">],</span> <span class="n">p</span><span class="p">)</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">test_bs</span><span class="p">]</span>
<span class="n">bounds</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">test_bs</span>
<span class="n">qn_fig</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">test_bs</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mf">2.5</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mf">98.5</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;95% CI&#39;</span><span class="p">)</span>
<span class="n">qn_fig</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">test_bs</span><span class="p">,</span> <span class="n">y1</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mi">25</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mi">75</span><span class="p">],</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;IQR&#39;</span><span class="p">)</span>
<span class="n">qn_fig</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">test_bs</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">bounds</span><span class="p">[</span><span class="mi">50</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;crimson&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Median&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
<span class="n">qn_fig</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$$\text{Noise [bits/sample]}$$&quot;</span>
<span class="n">qn_fig</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$$\text{Dictionary Size (b)} [2^b = \text{N symbols}]$$&quot;</span>
<span class="n">qn_fig</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">qn_fig</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">qn_fig</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">export_png</span>

<span class="n">test_stn</span> <span class="o">=</span> <span class="n">filtered_stns</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">filtered_stns</span><span class="p">:</span>
    <span class="n">output_folder</span> <span class="o">=</span> <span class="s1">&#39;MLE_plots&#39;</span>
    <span class="n">plot_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">output_folder</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s2">_LN_and_expon_fits.png&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">plot_fpath</span><span class="p">):</span>
        <span class="k">continue</span>
    <span class="n">test_df</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">get_timeseries_data</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span>
    <span class="n">test_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">minx</span><span class="p">,</span> <span class="n">maxx</span> <span class="o">=</span> <span class="n">test_df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">test_df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span>
    <span class="c1"># print(f&#39;X range is {minx:.1f} to {maxx:.1f} cms&#39;)</span>
    <span class="c1"># print(&#39;&#39;)</span>
    
    <span class="n">test_fig</span> <span class="o">=</span> <span class="n">create_MLE_fit_plot</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="n">test_df</span><span class="p">,</span> <span class="n">stn</span><span class="p">)</span>
    
    <span class="n">export_png</span><span class="p">(</span><span class="n">test_fig</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">plot_fpath</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">n</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="n">filtered_stns</span><span class="p">:</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">get_timeseries_data</span><span class="p">(</span><span class="n">stn</span><span class="p">)</span>
    <span class="n">ln_shape</span><span class="p">,</span> <span class="n">ln_loc</span><span class="p">,</span> <span class="n">ln_scale</span> <span class="o">=</span> <span class="n">lognorm</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">expon_loc</span><span class="p">,</span> <span class="n">expon_scale</span> <span class="o">=</span> <span class="n">expon</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">floc</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="c1"># kh, kk, k_loc, k_scale = fit_kappa4_mle(df[stn])</span>
    <span class="c1"># kh, kk, k_loc, k_scale = constrained_optimization(df[stn])</span>
    <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stn</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;ln_shape&#39;</span><span class="p">,</span> <span class="s1">&#39;ln_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;ln_scale&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">ln_shape</span><span class="p">,</span> <span class="n">ln_loc</span><span class="p">,</span> <span class="n">ln_scale</span><span class="p">)</span>
    <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stn</span><span class="p">,</span> <span class="p">[</span><span class="s1">&#39;expon_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;expon_scale&#39;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">(</span><span class="n">expon_loc</span><span class="p">,</span> <span class="n">expon_scale</span><span class="p">)</span>
    <span class="c1"># attr_df.loc[attr_df[&#39;official_id&#39;] == stn, [&#39;kappa_h&#39;, &#39;kappa_k&#39;, &#39;kappa_loc&#39;, &#39;kappa_scale&#39;]] = (kh, kk, k_loc, k_scale)</span>
    <span class="k">for</span> <span class="n">b</span> <span class="ow">in</span> <span class="n">test_bs</span><span class="p">:</span>
        <span class="n">attr_df</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">attr_df</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">stn</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">b</span><span class="si">}</span><span class="s1">_quantization_noise&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kl_divergence_between_quantizations</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="nb">max</span><span class="p">(</span><span class="n">test_bs</span><span class="p">),</span> <span class="n">stn</span><span class="p">)</span> 
    <span class="n">n</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">if</span> <span class="n">n</span> <span class="o">%</span> <span class="mi">150</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    ...</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">filtered_stns</span><span class="p">)</span><span class="si">}</span><span class="s1"> completed.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># convert the MLE parameters to dicts for easier access</span>
<span class="n">ln_dict</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">attr_df</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;official_id&#39;</span><span class="p">)[[</span><span class="s1">&#39;ln_shape&#39;</span><span class="p">,</span> <span class="s1">&#39;ln_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;ln_scale&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="p">)</span>
<span class="n">expon_dict</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">attr_df</span>
    <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;official_id&#39;</span><span class="p">)[[</span><span class="s1">&#39;expon_loc&#39;</span><span class="p">,</span> <span class="s1">&#39;expon_scale&#39;</span><span class="p">]]</span>
    <span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># kappa_dict = (</span>
<span class="c1">#     attr_df</span>
<span class="c1">#     .set_index(&#39;official_id&#39;)[[&#39;kappa_a&#39;, &#39;kappa_b&#39;, &#39;kappa_c&#39;, &#39;kappa_d&#39;]]</span>
<span class="c1">#     .to_dict(orient=&#39;index&#39;)</span>
<span class="c1"># )</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compute-the-noise-added-to-a-discriminant-value-due-to-assuming-an-error-distribution-as-a-prior">
<h1>Compute the noise added to a discriminant value due to assuming an error distribution as a prior<a class="headerlink" href="#compute-the-noise-added-to-a-discriminant-value-due-to-assuming-an-error-distribution-as-a-prior" title="Link to this heading">#</a></h1>
<p>Rating curve uncertainty is a hard problem in hydrology.  Instead of treating daily flow observations as discrete measurements with the fixed (often overzealous) precision that it is published by governing agencies, we can assume some kind of basic error model and test how much the error model distorts the information in the distribution.  In other words, how much noise/uncertainty is added for any model error.</p>
<p>Below we’ll test a range of uniform error distributions as models for the observations.  We’ll take an example streamflow record, and we’ll quantize it to a range of dictionary sizes in two ways.  One way is to bin the observations as they are, we’ll refer to this as the “deterministic” treatment.  The second way is to apply a series of error distribution models, calling it the “stochastic treatment”, and bin the observations by counting the fraction of the observation distribution interval that lies in each bin.  In other words, we’ll count partial observations in proportion to where they fall over the binning intervals as opposed to counting a whole observation based on the interval alone.</p>
<p>The quantization will take in a bitrate <span class="math notranslate nohighlight">\(b\)</span>, and it will divide and log-transform the measured interval <span class="math notranslate nohighlight">\((\log(x_\text{min}),\log(x_\text{max}))\)</span> into <span class="math notranslate nohighlight">\(2^b\)</span> log-spaced bins.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_log_uniform_bins</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="p">):</span>
    <span class="n">n_bins</span> <span class="o">=</span> <span class="mi">2</span><span class="o">**</span><span class="n">bitrate</span>
    <span class="n">min_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>
    <span class="n">max_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>

    <span class="c1"># set the bin edges to be evenly spaced between the</span>
    <span class="c1"># observed range of the proxy/donor series</span>
    <span class="c1"># np.digitize will assign 0 for out-of-range values at left</span>
    <span class="c1"># and n_bins + 1 for out-of-range values at right</span>
    <span class="n">log_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">min_log_val</span><span class="p">,</span>
        <span class="n">max_log_val</span><span class="p">,</span>
        <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># convert back to linear space</span>
    <span class="n">bin_edges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">log_bin_edges</span><span class="p">]</span>

    <span class="c1"># there should be n_bins edges which define n_bins - 1 bins</span>
    <span class="c1"># this is to reserve 2 bin for out-of-range values to the right</span>
    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">)</span> <span class="o">==</span> <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="k">return</span> <span class="n">bin_edges</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">apply_error_to_observations</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="mf">0.1</span><span class="p">):</span>
    <span class="n">min_q</span><span class="p">,</span> <span class="n">max_q</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">min</span><span class="p">()</span> <span class="o">-</span> <span class="mf">1e-9</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">+</span> <span class="mf">1e-9</span>
    <span class="k">assert</span> <span class="n">min_q</span> <span class="o">&gt;</span> <span class="mi">0</span>
    <span class="c1"># use equal width bins in log10 space</span>
    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">compute_log_uniform_bins</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="p">)</span>
    <span class="c1"># df[f&#39;{bitrate}_bits_quantized&#39;] = np.digitize(df[stn], bin_edges)</span>
    <span class="n">fractional_obs_counts</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">error_adjusted_fractional_bin_counts</span><span class="p">(</span>
        <span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">bin_edges</span><span class="p">),</span> <span class="n">bitrate</span><span class="p">,</span> <span class="n">error_factor</span><span class="o">=</span><span class="n">error</span>
    <span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_</span><span class="si">{</span><span class="nb">int</span><span class="p">(</span><span class="mi">100</span><span class="o">*</span><span class="n">error</span><span class="p">)</span><span class="si">}</span><span class="s1">_error&#39;</span>
    <span class="n">count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitrate</span><span class="p">))</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fractional_obs_counts</span>
    <span class="n">count_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">n_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">])</span>
    <span class="c1"># normalize p_obs and p_sim</span>
    <span class="k">return</span> <span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span><span class="o">.</span><span class="n">values</span> <span class="o">/</span> <span class="n">n_obs</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_unadjusted_counts</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="p">):</span>
    <span class="n">bin_edges</span> <span class="o">=</span> <span class="n">compute_log_uniform_bins</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="p">)</span>
    <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">stn</span><span class="si">}</span><span class="s1">_simple_</span><span class="si">{</span><span class="n">bitrate</span><span class="si">}</span><span class="s1">bits&#39;</span>
    <span class="n">df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">digitize</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">stn</span><span class="p">],</span> <span class="n">bin_edges</span><span class="p">)</span>
    <span class="c1"># print(df[[stn, f&#39;{stn}_quantized_{bitrate}bits&#39;]].head(4))</span>
    <span class="c1"># count the occurrences of each quantized value</span>
    <span class="c1"># the &quot;simulated&quot; series is the proxy/donor series</span>
    <span class="c1"># and the &quot;observed&quot; series is the target location</span>
    <span class="n">obs_count_df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">label</span><span class="p">)</span><span class="o">.</span><span class="n">count</span><span class="p">()</span>
    <span class="n">count_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">2</span><span class="o">**</span><span class="n">bitrate</span><span class="p">))</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">count_df</span><span class="p">[</span><span class="n">label</span><span class="p">]</span> <span class="o">+=</span> <span class="n">obs_count_df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span>
    <span class="n">count_df</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">adjusted_p</span> <span class="o">=</span> <span class="n">count_df</span> <span class="o">/</span> <span class="n">obs_count_df</span><span class="p">[</span><span class="n">stn</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">adjusted_p</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_distortion</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>
    <span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">err</span> <span class="o">=</span> <span class="n">inputs</span>
    <span class="n">simple_frequencies</span> <span class="o">=</span> <span class="n">compute_unadjusted_counts</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
    <span class="n">error_adjusted_frequencies</span> <span class="o">=</span> <span class="n">apply_error_to_observations</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">stn</span><span class="p">,</span> <span class="n">bitrate</span><span class="o">=</span><span class="n">b</span><span class="p">,</span> <span class="n">error</span><span class="o">=</span><span class="n">err</span><span class="p">)</span>
    <span class="c1"># compute KL divergence between the simple and adjusted frequencies</span>
    <span class="c1"># this represents the distortion due to the error model</span>
    <span class="n">mask</span> <span class="o">=</span> <span class="p">(</span><span class="n">simple_frequencies</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">error_adjusted_frequencies</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">distortion</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">simple_frequencies</span><span class="p">)</span>
    <span class="n">distortion</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">simple_frequencies</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">simple_frequencies</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">/</span> <span class="n">error_adjusted_frequencies</span><span class="p">[</span><span class="n">mask</span><span class="p">])</span>
    <span class="n">kld</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">distortion</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">stn</span><span class="p">,</span> <span class="n">kld</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">err</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="pairwise-processing">
<h1>Pairwise Processing<a class="headerlink" href="#pairwise-processing" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">itertools</span>

<span class="c1"># generate all combinations of pairs of station ids</span>
<span class="n">id_pairs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">itertools</span><span class="o">.</span><span class="n">combinations</span><span class="p">(</span><span class="n">filtered_stns</span><span class="p">,</span> <span class="mi">2</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39; There are </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">id_pairs</span><span class="p">)</span><span class="si">}</span><span class="s1"> unique pairings in the dataset&#39;</span><span class="p">)</span>
<span class="c1"># shuffle the pairs to make testing smaller batches more robust</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">shuffle</span><span class="p">(</span><span class="n">id_pairs</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span> There are 877150 unique pairings in the dataset
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the attributes file with catchment geometries</span>
<span class="n">geom_file</span> <span class="o">=</span> <span class="s1">&#39;BCUB_watershed_attributes_updated.geojson&#39;</span>
<span class="n">bcub_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data&#39;</span><span class="p">,</span> <span class="n">geom_file</span><span class="p">))</span>
<span class="n">bcub_gdf</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">bcub_gdf</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set a revision date for the results output file</span>
<span class="n">revision_date</span> <span class="o">=</span> <span class="s1">&#39;20241125&#39;</span>

<span class="c1"># how many pairs to compute in each batch</span>
<span class="n">batch_size</span> <span class="o">=</span> <span class="mi">5000</span>
<span class="c1"># batch_size = 10</span>

<span class="c1"># # what percentage of 365 observations in a year counts as a &quot;complete&quot; year</span>
<span class="c1"># completeness_threshold = 0.9</span>
<span class="c1"># min_observations = 365 * 0.9</span>

<span class="c1"># station pairs with less than min_years concurrent years of data are excluded (for concurrent analysis),</span>
<span class="c1"># stations with less than min_years are excluded (for non-concurrent analysis),</span>
<span class="n">min_years</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1">#[2, 3, 4, 5, 10]</span>

<span class="c1"># a prior is applied to q in the form of a uniform array of 10**c pseudo-counts &quot;c&quot;</span>
<span class="c1"># this prior is used to test the effect of the choice of prior on the model</span>
<span class="n">pseudo_counts</span> <span class="o">=</span> <span class="p">[</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span> <span class="o">-</span><span class="mi">4</span><span class="p">,</span> <span class="o">-</span><span class="mi">3</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">,</span> <span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>

<span class="c1"># set the number of quantization levels to test, equal to 2^bitrate</span>
<span class="n">bitrates</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">8</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">11</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">,</span> <span class="mi">14</span><span class="p">]</span>

<span class="c1"># Preload all records into a dictionary for fast lookup</span>
<span class="n">records_dict</span> <span class="o">=</span> <span class="n">bcub_gdf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;official_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">to_dict</span><span class="p">(</span><span class="n">orient</span><span class="o">=</span><span class="s1">&#39;index&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">temp_dir</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span> <span class="s1">&#39;data/&#39;</span><span class="p">,</span> <span class="s1">&#39;temp&#39;</span><span class="p">)</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">):</span>
    <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">input_batch_generator</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_pairs_filtered</span><span class="p">,</span> <span class="n">min_years</span><span class="p">,</span> <span class="n">use_partial_counts</span><span class="p">):</span>
    <span class="n">batch_inputs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">proxy</span><span class="p">,</span> <span class="n">target</span> <span class="ow">in</span> <span class="n">id_pairs_filtered</span><span class="p">:</span>
        
        <span class="n">proxy_dict</span> <span class="o">=</span> <span class="n">records_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="p">{})</span>
        <span class="n">target_dict</span> <span class="o">=</span> <span class="n">records_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="p">{})</span>

        <span class="n">proxy_dict</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span>
        <span class="n">target_dict</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">assert</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">proxy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">proxy_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        <span class="k">assert</span> <span class="s1">&#39;geometry&#39;</span> <span class="ow">in</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">(),</span> <span class="n">target_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
        
        <span class="n">batch</span> <span class="o">=</span> <span class="p">[</span><span class="n">proxy_dict</span><span class="p">,</span> <span class="n">target_dict</span><span class="p">,</span> <span class="n">min_years</span><span class="p">,]</span>
        <span class="n">batch_inputs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">batch_inputs</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_kl_estimates</span><span class="p">(</span><span class="n">P_dd</span><span class="p">,</span> <span class="n">Q_dd</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute row-wise KL divergence estimates while ensuring positivity and handling edge cases.</span>

<span class="sd">    Args:</span>
<span class="sd">        P_dd: 2D array of P_dd values (with NaNs).</span>
<span class="sd">        Q_dd: 2D array of Q_dd values (with NaNs).</span>
<span class="sd">        epsilon: Small constant to prevent division by zero.</span>

<span class="sd">    Returns:</span>
<span class="sd">        kl_estimates: 1D array of row-wise KL divergence estimates.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Replace NaNs with 0 in P_dd and epsilon in Q_dd</span>
    <span class="n">P_dd_safe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">P_dd</span><span class="p">),</span> <span class="n">P_dd</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>
    <span class="n">Q_dd_safe</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">Q_dd</span><span class="p">),</span> <span class="n">Q_dd</span><span class="p">,</span> <span class="n">epsilon</span><span class="p">)</span>

    <span class="c1"># Ensure rows are normalized</span>
    <span class="n">P_dd_safe</span> <span class="o">=</span> <span class="n">P_dd_safe</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">P_dd_safe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">Q_dd_safe</span> <span class="o">=</span> <span class="n">Q_dd_safe</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Q_dd_safe</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Compute log2(P_dd / Q_dd) safely</span>
    <span class="n">log_ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log2</span><span class="p">(</span><span class="n">P_dd_safe</span> <span class="o">/</span> <span class="n">Q_dd_safe</span><span class="p">)</span>
    <span class="n">log_ratios</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">P_dd_safe</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="n">log_ratios</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>  <span class="c1"># Ignore invalid ratios</span>

    <span class="c1"># Compute row-wise KL divergence</span>
    <span class="n">kl_estimates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">P_dd_safe</span> <span class="o">*</span> <span class="n">log_ratios</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">kl_estimates</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">adjust_kde_bandwidth</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">existing_bw</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Adjust the bandwidth of a Gaussian KDE by scaling Scott&#39;s bandwidth.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: 1D array of data points for KDE.</span>
<span class="sd">        factor: Scaling factor for the bandwidth (default is 1.0, i.e., no adjustment).</span>

<span class="sd">    Returns:</span>
<span class="sd">        proxy_kde: KDE object with adjusted bandwidth.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Compute Scott&#39;s bandwidth</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">size</span>
    <span class="k">if</span> <span class="n">existing_bw</span> <span class="o">==</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">scott_bw</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">data</span><span class="p">)</span> <span class="o">*</span> <span class="n">n</span><span class="o">**</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="mi">5</span><span class="p">)</span>  <span class="c1"># Scott&#39;s rule</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">scott_bw</span> <span class="o">=</span> <span class="n">existing_bw</span>

    <span class="c1"># Scale the bandwidth</span>
    <span class="n">adjusted_bw</span> <span class="o">=</span> <span class="n">factor</span> <span class="o">*</span> <span class="n">scott_bw</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    KDE bandwidth adjusted from </span><span class="si">{</span><span class="n">scott_bw</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">adjusted_bw</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">adjusted_bw</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">assert_alignment</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">):</span>
    <span class="c1"># Define a mask for valid kde_density values</span>
    <span class="n">valid_mask_1</span> <span class="o">=</span> <span class="o">~</span><span class="n">jnp</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    
    <span class="c1"># Define a mask for valid x1_diffs values</span>
    <span class="n">valid_mask_2</span> <span class="o">=</span> <span class="o">~</span><span class="n">jnp</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
    
    <span class="c1"># Assert that wherever kde_density is valid, x1_diffs is also valid</span>
    <span class="k">assert</span> <span class="n">jnp</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">valid_mask_1</span><span class="p">)</span> <span class="o">|</span> <span class="n">valid_mask_2</span><span class="p">),</span> <span class="p">(</span>
        <span class="s2">&quot;x1_diffs contains invalid (NaN) values where kde_density is valid.&quot;</span>
    <span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">justify</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">invalid_val</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;right&#39;</span><span class="p">):</span>    
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Justifies a 2D array</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    A : ndarray</span>
<span class="sd">        Input array to be justified</span>
<span class="sd">    axis : int</span>
<span class="sd">        Axis along which justification is to be made</span>
<span class="sd">    side : str</span>
<span class="sd">        Direction of justification. It could be &#39;left&#39;, &#39;right&#39;, &#39;up&#39;, &#39;down&#39;</span>
<span class="sd">        It should be &#39;left&#39; or &#39;right&#39; for axis=1 and &#39;up&#39; or &#39;down&#39; for axis=0.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">invalid_val</span> <span class="ow">is</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">a</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">a</span><span class="o">!=</span><span class="n">invalid_val</span>
    <span class="n">justified_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">side</span><span class="o">==</span><span class="s1">&#39;up&#39;</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">side</span><span class="o">==</span><span class="s1">&#39;left&#39;</span><span class="p">):</span>
        <span class="n">justified_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">flip</span><span class="p">(</span><span class="n">justified_mask</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="n">axis</span><span class="p">)</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">invalid_val</span><span class="p">)</span> 
    <span class="k">if</span> <span class="n">axis</span><span class="o">==</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">out</span><span class="p">[</span><span class="n">justified_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">out</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">justified_mask</span><span class="o">.</span><span class="n">T</span><span class="p">]</span> <span class="o">=</span> <span class="n">a</span><span class="o">.</span><span class="n">T</span><span class="p">[</span><span class="n">mask</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span>


<span class="k">def</span> <span class="nf">compute_adjusted_cdf_and_density</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute adjusted CDF and density for each row of a 2D array using JAX.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: 2D JAX array, where each row represents a sample set.</span>

<span class="sd">    Returns:</span>
<span class="sd">        adjusted_cdfs: 2D array of adjusted CDFs, padded with NaN where necessary.</span>
<span class="sd">        adjusted_densities: 2D array of adjusted densities, padded with NaN where necessary.</span>
<span class="sd">        unique_vals: 2D array of unique values per row, padded with NaN where necessary.</span>
<span class="sd">    &quot;&quot;&quot;</span>
   <span class="c1"># Sort rows and handle NaNs by sorting them to the end</span>
    <span class="n">sorted_data</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Count consecutive duplicates to determine unique values and counts</span>
    <span class="n">diffs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_data</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">prepend</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">unique_mask</span> <span class="o">=</span> <span class="n">diffs</span> <span class="o">!=</span> <span class="mi">0</span>  <span class="c1"># Marks unique values in each row</span>

    <span class="c1"># Create unique values and compute their counts</span>
    <span class="n">unique_vals</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">unique_mask</span><span class="p">,</span> <span class="n">sorted_data</span><span class="p">,</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="n">counts_per_row</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">unique_mask</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">keepdims</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Compute cumulative counts for unique values only</span>
    <span class="n">adjusted_cdf</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">where</span><span class="p">(</span>
        <span class="n">unique_mask</span><span class="p">,</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">unique_mask</span> <span class="o">/</span> <span class="n">counts_per_row</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
        <span class="n">jnp</span><span class="o">.</span><span class="n">nan</span>
    <span class="p">)</span>

    <span class="n">sorted_cdf</span> <span class="o">=</span> <span class="n">justify</span><span class="p">(</span><span class="n">adjusted_cdf</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>
    <span class="n">sorted_unique</span> <span class="o">=</span> <span class="n">justify</span><span class="p">(</span><span class="n">unique_vals</span><span class="p">,</span> <span class="n">side</span><span class="o">=</span><span class="s1">&#39;left&#39;</span><span class="p">)</span>

    <span class="c1"># Compute the density (difference of CDF)</span>
    <span class="n">density</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">jnp</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">sorted_cdf</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">1</span><span class="p">]),</span> <span class="n">sorted_cdf</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>    

    <span class="k">return</span> <span class="n">sorted_cdf</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">sorted_unique</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">compute_hist_and_log_edges</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">n_bins</span><span class="o">=</span><span class="mi">64</span><span class="p">):</span>
    <span class="n">min_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>
    <span class="n">max_log_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">nanmax</span><span class="p">(</span><span class="n">x</span><span class="p">))</span>

    <span class="c1"># set the bin edges to be evenly spaced between the</span>
    <span class="c1"># observed range of the proxy/donor series</span>
    <span class="c1"># np.digitize will assign 0 for out-of-range values at left</span>
    <span class="c1"># and n_bins + 1 for out-of-range values at right</span>
    <span class="n">log_bin_edges</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span>
        <span class="n">min_log_val</span><span class="p">,</span>
        <span class="n">max_log_val</span><span class="p">,</span>
        <span class="n">n_bins</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">bin_edges</span> <span class="o">=</span> <span class="p">[</span><span class="mi">10</span><span class="o">**</span><span class="n">e</span> <span class="k">for</span> <span class="n">e</span> <span class="ow">in</span> <span class="n">log_bin_edges</span><span class="p">]</span>
    <span class="c1"># hist, edges = np.histogram(x, bins=bin_edges) </span>
    <span class="n">log_counts</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">histogram</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="n">bin_edges</span><span class="p">,</span> <span class="n">density</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="n">freqs</span> <span class="o">=</span> <span class="n">log_counts</span> <span class="o">/</span> <span class="nb">sum</span><span class="p">(</span><span class="n">log_counts</span><span class="p">)</span>
    <span class="c1"># hist = hist / np.nansum(hist)</span>
    <span class="k">assert</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">sum</span><span class="p">(</span><span class="n">freqs</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.0001</span>
    <span class="k">return</span> <span class="n">freqs</span><span class="p">,</span> <span class="n">bin_edges</span><span class="p">,</span> <span class="n">n_bins</span>
    
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kde_test</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">sim_kde</span><span class="p">):</span>

    <span class="k">return</span> <span class="n">hist_obs</span><span class="p">,</span> <span class="n">hist_sim</span><span class="p">,</span> <span class="n">edges</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">reset_output</span>

<span class="k">def</span> <span class="nf">plot_and_save_cdf_kde_histogram</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">sim_kde</span><span class="p">,</span> <span class="n">output_path</span><span class="o">=</span><span class="s2">&quot;plot.png&quot;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot and save the empirical CDF, KDE fit, and histogram using Bokeh.</span>

<span class="sd">    Args:</span>
<span class="sd">        x: 1D array of x values (for KDE and CDF).</span>
<span class="sd">        cdf: Empirical CDF values corresponding to x.</span>
<span class="sd">        kde: KDE fit values corresponding to x.</span>
<span class="sd">        hist: Histogram heights.</span>
<span class="sd">        bins: Bin edges for the histogram.</span>
<span class="sd">        output_path: Path to save the PNG output.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hist_obs</span><span class="p">,</span> <span class="n">edges_obs</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="n">compute_hist_and_log_edges</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="n">hist_sim</span><span class="p">,</span> <span class="n">edges_sim</span><span class="p">,</span> <span class="n">n_bins</span> <span class="o">=</span> <span class="n">compute_hist_and_log_edges</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>

    <span class="c1"># Create the figure</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span>
        <span class="n">title</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;KL divergence (median: </span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">-</span><span class="si">{</span><span class="n">ci</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2"> 95% CI)&quot;</span><span class="p">,</span>
        <span class="n">x_axis_label</span><span class="o">=</span><span class="s2">&quot;X&quot;</span><span class="p">,</span> <span class="n">y_axis_label</span><span class="o">=</span><span class="s2">&quot;Density / Probability&quot;</span><span class="p">,</span>
              <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>

    <span class="c1"># Add histogram (muted grey with alpha)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">hist_obs</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">edges_obs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">edges_obs</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
           <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;grey&quot;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">hist_sim</span><span class="p">,</span> <span class="n">bottom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">left</span><span class="o">=</span><span class="n">edges_sim</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">right</span><span class="o">=</span><span class="n">edges_sim</span><span class="p">[</span><span class="mi">1</span><span class="p">:],</span>
           <span class="n">fill_color</span><span class="o">=</span><span class="s2">&quot;crimson&quot;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Simulated&quot;</span><span class="p">)</span>

    <span class="c1"># Compute the KDE-based CDF at the evaluation points    </span>
    <span class="n">kde_obs_fit</span> <span class="o">=</span> <span class="n">jkde</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x1</span><span class="p">))</span>
    
    <span class="c1"># x_obs_range = np.percentile(x1, np.linspace(0, 100, n_bins))</span>
    <span class="n">bin_midpoints</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edges_obs</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">edges_obs</span><span class="p">[</span><span class="mi">1</span><span class="p">:]))</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">kde_obs_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">kde_obs_fit</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">edges_obs</span><span class="p">])</span>
    <span class="c1"># kde_obs = np.diff(np.concatenate(([0], kde_obs_cdf)))</span>
    <span class="n">kde_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">kde_obs_cdf</span><span class="p">)</span>
    <span class="c1"># kde_obs = kde_obs_fit.evaluate(np.log10(x_obs_range))</span>
    <span class="n">kde_sim_cdf</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">sim_kde</span><span class="o">.</span><span class="n">integrate_box_1d</span><span class="p">(</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">xi</span><span class="p">))</span> <span class="k">for</span> <span class="n">xi</span> <span class="ow">in</span> <span class="n">edges_obs</span><span class="p">])</span><span class="c1">#vmap_kde(np.log10(x_obs_range))</span>
    <span class="c1"># kde_sim = np.diff(np.concatenate(([0], kde_sim_cdf)))</span>
    <span class="n">kde_sim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">kde_sim_cdf</span><span class="p">)</span>

    <span class="c1"># kde_obs = kde_obs / np.nansum(kde_obs)</span>
    <span class="c1"># kde_sim = kde_sim / np.nansum(kde_sim)</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;kde  sim =</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">kde_obs</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1"> obs=</span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">kde_sim</span><span class="p">)</span><span class="si">:</span><span class="s1">.3f</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># Add KDE lines series </span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bin_midpoints</span><span class="p">,</span> <span class="n">kde_obs</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;KDE (obs)&quot;</span><span class="p">,)</span>
    <span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bin_midpoints</span><span class="p">,</span> <span class="n">kde_sim</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;KDE (sim)&quot;</span><span class="p">,)</span>

    <span class="c1"># Add empirical CDF (orange line)</span>
    <span class="c1"># p.line(x, cdf, line_width=2, line_color=&quot;orange&quot;, legend_label=&quot;Empirical CDF&quot;,)</span>

    <span class="c1"># Style the legend</span>
    <span class="n">p</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_right&quot;</span>
    <span class="c1"># p.legend.title = &quot;Legend&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>

    <span class="c1"># Save as PNG</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">export_png</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="n">output_path</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="c1"># Clean up Bokeh output state</span>
        <span class="n">reset_output</span><span class="p">()</span>

    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Plot saved to </span><span class="si">{</span><span class="n">output_path</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">kl_divergence_convergence</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">n_resamples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">epsilon</span><span class="o">=</span><span class="mf">1e-10</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="s1">&#39;scott&#39;</span><span class="p">,</span> <span class="n">existing_bw</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">min_q_allowed</span><span class="o">=</span><span class="mf">1e-7</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Vectorized estimation of KL divergence convergence using bootstrap resampling.</span>

<span class="sd">    Parameters:</span>
<span class="sd">    - x1, x2: Arrays of observations from distributions P and Q.</span>
<span class="sd">    - n_resamples: Number of bootstrap resamples.</span>

<span class="sd">    Returns:</span>
<span class="sd">    - kl_estimates: Array of KL divergence estimates.</span>
<span class="sd">    - mean_kl: Mean of the bootstrap estimates.</span>
<span class="sd">    - ci_lower, ci_upper: 95% confidence interval bounds.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;N=</span><span class="si">{</span><span class="n">n</span><span class="si">}</span><span class="s1"> samples&#39;</span><span class="p">)</span>
    <span class="c1"># Empirical CDF for each resample</span>
    <span class="n">cdf1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">n</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">n</span>
    
    <span class="n">P_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">cdf1</span><span class="p">,</span> <span class="p">(</span><span class="n">n_resamples</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">P_density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">P_density</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)),</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;edge&quot;</span><span class="p">)</span>

    <span class="c1"># Precompute bootstrap indices for x1 and x2</span>
    <span class="c1"># resample_size = min(n, 365)</span>
    <span class="n">resample_size</span><span class="o">=</span><span class="n">n</span>
    <span class="n">x1_resampled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">choice</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="p">(</span><span class="n">n_resamples</span><span class="p">,</span> <span class="n">resample_size</span><span class="p">),</span> <span class="n">replace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Sort the resampled data for empirical CDF calculation</span>
    <span class="n">sorted_x1_vals_raw</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">x1_resampled</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Compute adjusted CDFs, densities, and unique x1 values. vectorize and compute over rows</span>
    <span class="n">adjusted_cdfs</span><span class="p">,</span> <span class="n">adjusted_densities</span><span class="p">,</span> <span class="n">sorted_x1_vals</span> <span class="o">=</span> <span class="n">compute_adjusted_cdf_and_density</span><span class="p">(</span><span class="n">x1_resampled</span><span class="p">)</span>

    <span class="c1"># now fit the KDE to X2 (simulated values)</span>
    <span class="n">log_x2</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">x2</span><span class="p">)</span>
    <span class="n">sim_kde_jax</span> <span class="o">=</span> <span class="n">jkde</span><span class="p">(</span><span class="n">log_x2</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">bw_method</span><span class="p">)</span>
    <span class="c1"># evaluate the KDE fit at all points in X1</span>
    <span class="n">vmap_kde</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">sim_kde_jax</span><span class="o">.</span><span class="n">evaluate</span><span class="p">)</span>
    
    <span class="c1"># evaluate on the observed values</span>
    <span class="n">log_x1_sorted</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">sorted_x1_vals</span><span class="p">)</span>
    <span class="n">kde_density</span> <span class="o">=</span> <span class="n">vmap_kde</span><span class="p">(</span><span class="n">log_x1_sorted</span><span class="p">)</span>
    
    <span class="n">min_kde_density</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">nanmin</span><span class="p">(</span><span class="n">kde_density</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>

    <span class="k">if</span> <span class="n">min_kde_density</span> <span class="o">&lt;</span> <span class="n">min_q_allowed</span><span class="p">:</span>
        <span class="n">smoothing_factor</span> <span class="o">=</span> <span class="mf">1.01</span>
        <span class="n">adj_bw</span> <span class="o">=</span> <span class="n">adjust_kde_bandwidth</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">factor</span><span class="o">=</span><span class="n">smoothing_factor</span><span class="p">,</span> <span class="n">existing_bw</span><span class="o">=</span><span class="n">existing_bw</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;KDE returned P(x_i) = 0, adjusting bandwidth by a factor of </span><span class="si">{</span><span class="n">smoothing_factor</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">kl_divergence_convergence</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">bw_method</span><span class="o">=</span><span class="n">adj_bw</span><span class="p">,</span> <span class="n">existing_bw</span><span class="o">=</span><span class="n">adj_bw</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;min Q(x) = </span><span class="si">{</span><span class="n">min_kde_density</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="c1"># prepend a zero so the diff works out</span>
    <span class="n">zeros_to_prepend</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">sorted_x1_vals</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">))</span>
    <span class="n">sorted_x1_vals_with_zero</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">zeros_to_prepend</span><span class="p">,</span> <span class="n">sorted_x1_vals</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">log_x1_with_zero</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">concatenate</span><span class="p">([</span><span class="n">zeros_to_prepend</span><span class="p">,</span> <span class="n">log_x1_sorted</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    
    <span class="c1"># Compute the differences</span>
    <span class="n">x1_diffs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">sorted_x1_vals_with_zero</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">log_x1_diffs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">log_x1_with_zero</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Assert no values are zero</span>
    <span class="k">assert</span> <span class="ow">not</span> <span class="n">jnp</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">x1_diffs</span> <span class="o">==</span> <span class="mi">0</span><span class="p">),</span> <span class="s2">&quot;The array contains zero values!&quot;</span>
   
    <span class="c1"># divide each density point by the width delta x</span>
    <span class="n">assert_alignment</span><span class="p">(</span><span class="n">adjusted_densities</span><span class="p">,</span> <span class="n">x1_diffs</span><span class="p">)</span>
    <span class="n">P_dd</span> <span class="o">=</span> <span class="n">adjusted_densities</span> <span class="o">/</span> <span class="n">x1_diffs</span> <span class="c1"># delta_x1i</span>
    
    <span class="c1"># assert that where kde_density is valid that x1_diffs is also valid</span>
    <span class="n">assert_alignment</span><span class="p">(</span><span class="n">kde_density</span><span class="p">,</span> <span class="n">x1_diffs</span><span class="p">)</span>

    <span class="n">Q_dd</span> <span class="o">=</span> <span class="n">kde_density</span> <span class="o">/</span> <span class="n">log_x1_diffs</span> <span class="c1"># delta_x1i</span>
    
    <span class="c1"># Compute KL divergence for all resamples</span>
    <span class="n">kl_estimates</span> <span class="o">=</span> <span class="n">compute_kl_estimates</span><span class="p">(</span><span class="n">P_dd</span><span class="p">,</span> <span class="n">Q_dd</span><span class="p">)</span>

    <span class="c1"># Compute median and confidence intervals</span>
    <span class="n">ci</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">kl_estimates</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mf">97.5</span><span class="p">])</span>
    <span class="n">output_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;KDE_fit_plots/sim_</span><span class="si">{</span><span class="n">target</span><span class="si">}</span><span class="s1">_using_</span><span class="si">{</span><span class="n">proxy</span><span class="si">}</span><span class="s1">.png&#39;</span>
    <span class="n">plot_and_save_cdf_kde_histogram</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">,</span> <span class="n">ci</span><span class="p">,</span> <span class="n">sim_kde_jax</span><span class="p">,</span> <span class="n">output_path</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">kl_estimates</span><span class="p">,</span> <span class="n">ci</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">process_batch</span><span class="p">(</span><span class="n">inputs</span><span class="p">):</span>    
    <span class="n">proxy</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">min_concurrent_years</span> <span class="o">=</span> <span class="n">inputs</span>
    
    <span class="n">proxy_id</span><span class="p">,</span> <span class="n">target_id</span> <span class="o">=</span> <span class="n">proxy</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">],</span> <span class="n">target</span><span class="p">[</span><span class="s1">&#39;official_id&#39;</span><span class="p">]</span>

    <span class="c1"># create a result dict object for tracking results of the batch comparison</span>
    <span class="n">result</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;proxy&quot;</span><span class="p">:</span> <span class="n">proxy_id</span><span class="p">,</span>
        <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target_id</span><span class="p">,</span>
        <span class="s2">&quot;min_concurrent_years&quot;</span><span class="p">:</span> <span class="n">min_concurrent_years</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="n">station_info</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;proxy&quot;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">target</span><span class="p">}</span>

    <span class="c1"># check if the polygons are nested</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;nested_catchments&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">check_if_nested</span><span class="p">(</span><span class="n">proxy</span><span class="p">,</span> <span class="n">target</span><span class="p">)</span>

    <span class="c1"># for stn in pair:</span>
    <span class="n">proxy</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">Station</span><span class="p">(</span><span class="n">station_info</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">])</span>
    <span class="n">target</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">Station</span><span class="p">(</span><span class="n">station_info</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">])</span>
    <span class="n">target</span><span class="o">.</span><span class="n">ln_pdf_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_sim_lognorm_pdf&#39;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">ln_cdf_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_sim_lognorm_cdf&#39;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">expon_pdf_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_sim_expon_pdf&#39;</span>
    <span class="n">target</span><span class="o">.</span><span class="n">expon_cdf_label</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_sim_expon_cdf&#39;</span>

    <span class="c1"># compute spatial distance</span>
    <span class="n">p1</span><span class="p">,</span> <span class="n">p2</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">station_info</span><span class="p">[</span><span class="s2">&quot;proxy&quot;</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">centroid</span><span class="p">,</span>
        <span class="n">station_info</span><span class="p">[</span><span class="s2">&quot;target&quot;</span><span class="p">][</span><span class="s2">&quot;geometry&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">centroid</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="c1"># compute the distance between catchment centroids (km)</span>
    <span class="n">centroid_distance</span> <span class="o">=</span> <span class="n">p1</span><span class="o">.</span><span class="n">distance</span><span class="p">(</span><span class="n">p2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;centroid_distance&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">centroid_distance</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">centroid_distance</span> <span class="o">&gt;</span> <span class="mi">1000</span><span class="p">:</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">target</span><span class="o">.</span><span class="n">drainage_area_km2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No drainage area for </span><span class="si">{</span><span class="n">target_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">drainage_area_km2</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;No drainage area for </span><span class="si">{</span><span class="n">proxy_id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Retrieve the data for both stations</span>
    <span class="c1"># this is all data, including non-concurrent</span>
    <span class="n">adf</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">retrieve_nonconcurrent_data</span><span class="p">(</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">target_id</span><span class="p">)</span>

    <span class="k">assert</span> <span class="o">~</span><span class="n">adf</span><span class="o">.</span><span class="n">empty</span><span class="p">,</span> <span class="s2">&quot;No data returned.&quot;</span>

    <span class="k">for</span> <span class="n">stn</span> <span class="ow">in</span> <span class="p">[</span><span class="n">proxy</span><span class="p">,</span> <span class="n">target</span><span class="p">]:</span>
        <span class="n">adf</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">transform_and_jitter</span><span class="p">(</span><span class="n">adf</span><span class="p">,</span> <span class="n">stn</span><span class="p">)</span>

    <span class="c1"># simulate flow at the target based on equal unit area runoff scaling</span>
    <span class="n">adf</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">sim_label</span><span class="p">]</span> <span class="o">=</span> <span class="n">adf</span><span class="p">[</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span>
        <span class="n">target</span><span class="o">.</span><span class="n">drainage_area_km2</span> <span class="o">/</span> <span class="n">proxy</span><span class="o">.</span><span class="n">drainage_area_km2</span>
    <span class="p">)</span>

    <span class="c1"># filter for the concurrent data</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">adf</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">target_id</span><span class="p">],</span> <span class="n">how</span><span class="o">=</span><span class="s2">&quot;any&quot;</span><span class="p">)</span>
    <span class="n">result</span><span class="p">[</span><span class="s2">&quot;num_concurrent_obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
        <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">num_complete_concurrent_years</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">count_complete_years</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="s1">&#39;time&#39;</span><span class="p">,</span> <span class="n">proxy_id</span><span class="p">)</span>
        
    <span class="n">counts</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="n">proxy_id</span><span class="p">,</span> <span class="n">target_id</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">adf</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="n">proxy</span><span class="o">.</span><span class="n">n_obs</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">n_obs</span> <span class="o">=</span> <span class="n">counts</span><span class="p">[</span><span class="n">proxy_id</span><span class="p">],</span> <span class="n">counts</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span>
    
    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;proxy_n_obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">proxy</span><span class="o">.</span><span class="n">n_obs</span>
    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;target_n_obs&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">n_obs</span>
    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;proxy_frac_concurrent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="n">proxy</span><span class="o">.</span><span class="n">n_obs</span>
    <span class="n">result</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;target_frac_concurrent&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">df</span><span class="p">)</span> <span class="o">/</span> <span class="n">target</span><span class="o">.</span><span class="n">n_obs</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">proxy_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="n">counts</span><span class="p">[</span><span class="n">target_id</span><span class="p">]</span> <span class="o">==</span> <span class="mi">0</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;   Zero observations.  Skipping.&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># process the PMFs and divergences for concurrent data </span>
    <span class="c1"># using a range of uniform priors via pseudo counts    </span>
    <span class="k">if</span> <span class="n">num_complete_concurrent_years</span> <span class="o">&gt;</span> <span class="n">min_concurrent_years</span><span class="p">:</span>
        <span class="c1"># df is concurrent data, so the results</span>
        <span class="c1"># are updating concurrent data here    </span>
        <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">],</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="c1"># x1 is the observed, x2 is the simulated</span>
        <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">df</span><span class="p">[</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s1">_sim&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="c1"># fit kde to proxy values</span>
        <span class="n">_</span><span class="p">,</span> <span class="n">dkl_interval</span>  <span class="o">=</span> <span class="n">kl_divergence_convergence</span><span class="p">(</span><span class="n">proxy</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">target</span><span class="o">.</span><span class="n">id</span><span class="p">,</span> <span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;kld_lb&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dkl_interval</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;kld_median&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dkl_interval</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">result</span><span class="p">[</span><span class="s1">&#39;kld_ub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dkl_interval</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span>
    
    <span class="k">return</span> <span class="n">result</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the &#39;process&#39; variable is here so jupyter doesn&#39;t go computing </span>
<span class="c1"># a million rows per iteration when the book is built for pushing to github pages.</span>

    <span class="c1"># Evaluate KDE on grid points for each sample set</span>
<span class="k">def</span> <span class="nf">kde_per_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>
    <span class="c1"># Compute Gaussian kernel values for each grid point</span>
    <span class="n">kernels</span> <span class="o">=</span> <span class="n">norm</span><span class="o">.</span><span class="n">pdf</span><span class="p">((</span><span class="n">grid_points</span><span class="p">[:,</span> <span class="kc">None</span><span class="p">]</span> <span class="o">-</span> <span class="n">row</span><span class="p">)</span> <span class="o">/</span> <span class="n">bw</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">kernels</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">bw</span>

<span class="k">def</span> <span class="nf">kde_fit_per_row</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="n">bw</span><span class="p">):</span>    
    <span class="c1"># Vectorized computation across all rows</span>
    <span class="n">kde_values</span> <span class="o">=</span> <span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">kde_per_row</span><span class="p">)(</span><span class="n">samples</span><span class="p">,</span> <span class="n">bandwidth</span><span class="p">)</span>

<span class="n">process</span> <span class="o">=</span> <span class="kc">True</span>
<span class="n">partial_counts</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">if</span> <span class="n">process</span><span class="p">:</span> 
    
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing empirical CDF pairs (partial counts=</span><span class="si">{</span><span class="n">partial_counts</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>
    <span class="n">results_fname</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;KL_kde_fits_</span><span class="si">{</span><span class="n">revision_date</span><span class="si">}</span><span class="s1">.csv&#39;</span>

    <span class="n">out_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="s1">&#39;data/&#39;</span><span class="p">,</span> <span class="s1">&#39;nonparametric_divergence_test&#39;</span><span class="p">,</span> <span class="n">results_fname</span><span class="p">)</span>

    <span class="n">n_batches</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">id_pairs</span><span class="p">)</span> <span class="o">//</span> <span class="n">batch_size</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">batches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array_split</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">id_pairs</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="nb">object</span><span class="p">),</span> <span class="n">n_batches</span><span class="p">)</span>
    <span class="n">n_pairs</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">id_pairs</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Processing </span><span class="si">{</span><span class="n">n_pairs</span><span class="si">}</span><span class="s2"> pairs in </span><span class="si">{</span><span class="n">n_batches</span><span class="si">}</span><span class="s2"> batches.&quot;</span><span class="p">)</span>
    <span class="n">batch_no</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">batch_files</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
    <span class="c1"># error_df = error_model_df[error_model_df[&#39;bitrate&#39;] == bitrate].copy()</span>
    <span class="k">for</span> <span class="n">batch_ids</span> <span class="ow">in</span> <span class="n">batches</span><span class="p">[:</span><span class="mi">1</span><span class="p">]:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Starting batch </span><span class="si">{</span><span class="n">batch_no</span><span class="si">}</span><span class="s1">/</span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batches</span><span class="p">)</span><span class="si">}</span><span class="s1"> processing.&#39;</span><span class="p">)</span>
        <span class="n">batch_fname</span> <span class="o">=</span> <span class="n">results_fname</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_batch_</span><span class="si">{</span><span class="n">batch_no</span><span class="si">:</span><span class="s1">04d</span><span class="si">}</span><span class="s1">.csv&#39;</span><span class="p">)</span>
        <span class="n">batch_output_fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">temp_dir</span><span class="p">,</span> <span class="n">batch_fname</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">batch_output_fpath</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">batch_output_fpath</span><span class="p">):</span>
            <span class="n">batch_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_output_fpath</span><span class="p">)</span>
            <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>
        <span class="c1">#     continue</span>
        
        <span class="c1"># define the input array for multiprocessing</span>
        <span class="n">inputs</span> <span class="o">=</span> <span class="n">input_batch_generator</span><span class="p">(</span><span class="n">bcub_gdf</span><span class="p">,</span> <span class="n">batch_ids</span><span class="p">,</span> <span class="n">min_years</span><span class="p">,</span> <span class="n">partial_counts</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">inputs</span><span class="p">))</span>

        <span class="c1"># with mp.Pool(20) as pool:</span>
        <span class="c1">#     results = pool.map(process_batch, inputs)</span>
        <span class="c1">#     results = [r for r in results if r is not None]</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">inp</span> <span class="ow">in</span> <span class="n">inputs</span><span class="p">[:</span><span class="mi">10</span><span class="p">]:</span>
            <span class="n">res</span> <span class="o">=</span> <span class="n">process_batch</span><span class="p">(</span><span class="n">inp</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">res</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">res</span><span class="p">)</span>
            <span class="c1"># results = [r for r in res if r is not None]</span>

        <span class="n">batch_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">batch_result</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">asdf</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty batch.  Skipping&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">batch_result</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">batch_output_fpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;    Saved </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_result</span><span class="p">)</span><span class="si">}</span><span class="s2"> new results to file.&quot;</span><span class="p">)</span>
        
        <span class="n">batch_files</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">batch_output_fpath</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">time</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    Processed </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_ids</span><span class="p">)</span><span class="si">}</span><span class="s1"> pairs in </span><span class="si">{</span><span class="n">t2</span><span class="w"> </span><span class="o">-</span><span class="w"> </span><span class="n">t0</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> seconds&#39;</span><span class="p">)</span>
        <span class="n">batch_no</span> <span class="o">+=</span> <span class="mi">1</span>
        
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    Concatenating </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">batch_files</span><span class="p">)</span><span class="si">}</span><span class="s1"> batch files.&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">batch_files</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">all_results</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pyarrow&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">batch_files</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="n">all_results</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">out_fpath</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">out_fpath</span><span class="p">):</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">batch_files</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">f</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;    Wrote </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_results</span><span class="p">)</span><span class="si">}</span><span class="s1"> results to </span><span class="si">{</span><span class="n">out_fpath</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;    No new results to write to file.&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing empirical CDF pairs (partial counts=False)
    Processing 877150 pairs in 175 batches.
Starting batch 1/175 processing.
/home/danbot2/code_5820/24/divergence_measures/docs/notebooks/data/temp/KL_kde_fits_20241125_batch_0001.csv
5013
N=5557 samples
min Q(x) = 0.0557931549847126
Plot saved to KDE_fit_plots/sim_08LF051_using_05CA001.png
N=20241 samples
    KDE bandwidth adjusted from 0.677 to 0.683
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=20241 samples
min Q(x) = 1.648605518766999e-07
Plot saved to KDE_fit_plots/sim_12205000_using_08LE031.png
N=1138 samples
min Q(x) = 0.05337715148925781
Plot saved to KDE_fit_plots/sim_12458000_using_08MH004.png
N=1921 samples
    KDE bandwidth adjusted from 0.178 to 0.180
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.180 to 0.182
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.182 to 0.184
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.184 to 0.186
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.186 to 0.188
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.188 to 0.189
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.189 to 0.191
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.191 to 0.193
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.193 to 0.195
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.195 to 0.197
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.197 to 0.199
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.199 to 0.201
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.201 to 0.203
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.203 to 0.205
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.205 to 0.207
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.207 to 0.209
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.209 to 0.211
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.211 to 0.213
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.213 to 0.216
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.216 to 0.218
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.218 to 0.220
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.220 to 0.222
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.222 to 0.224
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.224 to 0.227
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.227 to 0.229
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.229 to 0.231
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.231 to 0.233
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.233 to 0.236
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.236 to 0.238
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.238 to 0.240
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.240 to 0.243
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.243 to 0.245
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.245 to 0.248
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.248 to 0.250
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.250 to 0.253
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.253 to 0.255
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.255 to 0.258
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.258 to 0.260
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.260 to 0.263
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.263 to 0.266
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.266 to 0.268
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.268 to 0.271
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.271 to 0.274
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.274 to 0.276
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.276 to 0.279
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.279 to 0.282
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.282 to 0.285
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.285 to 0.288
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.288 to 0.291
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.291 to 0.293
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.293 to 0.296
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.296 to 0.299
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.299 to 0.302
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.302 to 0.305
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.305 to 0.308
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.308 to 0.311
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.311 to 0.315
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.315 to 0.318
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.318 to 0.321
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.321 to 0.324
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.324 to 0.327
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.327 to 0.331
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.331 to 0.334
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.334 to 0.337
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.337 to 0.341
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.341 to 0.344
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.344 to 0.347
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.347 to 0.351
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.351 to 0.354
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.354 to 0.358
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.358 to 0.362
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.362 to 0.365
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.365 to 0.369
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.369 to 0.373
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.373 to 0.376
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.376 to 0.380
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.380 to 0.384
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.384 to 0.388
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.388 to 0.392
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.392 to 0.395
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.395 to 0.399
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.399 to 0.403
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.403 to 0.407
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.407 to 0.412
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.412 to 0.416
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.416 to 0.420
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.420 to 0.424
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.424 to 0.428
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.428 to 0.433
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.433 to 0.437
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.437 to 0.441
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.441 to 0.446
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.446 to 0.450
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.450 to 0.455
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.455 to 0.459
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.459 to 0.464
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.464 to 0.468
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.468 to 0.473
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.473 to 0.478
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.478 to 0.483
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.483 to 0.487
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.487 to 0.492
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.492 to 0.497
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.497 to 0.502
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.502 to 0.507
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.507 to 0.512
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.512 to 0.517
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.517 to 0.523
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.523 to 0.528
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.528 to 0.533
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.533 to 0.538
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.538 to 0.544
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.544 to 0.549
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.549 to 0.555
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.555 to 0.560
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.560 to 0.566
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.566 to 0.571
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.571 to 0.577
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.577 to 0.583
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.583 to 0.589
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.589 to 0.595
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.595 to 0.601
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.601 to 0.607
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.607 to 0.613
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.613 to 0.619
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.619 to 0.625
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.625 to 0.631
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.631 to 0.638
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.638 to 0.644
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.644 to 0.650
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.650 to 0.657
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.657 to 0.663
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.663 to 0.670
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
    KDE bandwidth adjusted from 0.670 to 0.677
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=1921 samples
min Q(x) = 1.2713718433587928e-07
Plot saved to KDE_fit_plots/sim_15085800_using_07EE002.png
N=25202 samples
min Q(x) = 0.0004897488979622722
Plot saved to KDE_fit_plots/sim_12039500_using_12036000.png
N=4852 samples
    KDE bandwidth adjusted from 24.463 to 24.708
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=4852 samples
min Q(x) = 0.045107632875442505
Plot saved to KDE_fit_plots/sim_12100496_using_08GB013.png
N=3371 samples
    KDE bandwidth adjusted from 0.031 to 0.032
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.032 to 0.032
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.032 to 0.032
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.032 to 0.033
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.033 to 0.033
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.033 to 0.033
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.033 to 0.034
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.034 to 0.034
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.034 to 0.034
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.034 to 0.035
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.035 to 0.035
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.035 to 0.035
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.035 to 0.036
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.036 to 0.036
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.036 to 0.036
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.036 to 0.037
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.037 to 0.037
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.037 to 0.038
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.038 to 0.038
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.038 to 0.038
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.038 to 0.039
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.039 to 0.039
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.039 to 0.040
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.040 to 0.040
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.040 to 0.040
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.040 to 0.041
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.041 to 0.041
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.041 to 0.042
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.042 to 0.042
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.042 to 0.042
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.042 to 0.043
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.043 to 0.043
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.043 to 0.044
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.044 to 0.044
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.044 to 0.045
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.045 to 0.045
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.045 to 0.045
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.045 to 0.046
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.046 to 0.046
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.046 to 0.047
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.047 to 0.047
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.047 to 0.048
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.048 to 0.048
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.048 to 0.049
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.049 to 0.049
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.049 to 0.050
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.050 to 0.050
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.050 to 0.051
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.051 to 0.051
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.051 to 0.052
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.052 to 0.052
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.052 to 0.053
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.053 to 0.053
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.053 to 0.054
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.054 to 0.054
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.054 to 0.055
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.055 to 0.055
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.055 to 0.056
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.056 to 0.057
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.057 to 0.057
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.057 to 0.058
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.058 to 0.058
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.058 to 0.059
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.059 to 0.059
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.059 to 0.060
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.060 to 0.061
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.061 to 0.061
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.061 to 0.062
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.062 to 0.062
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.062 to 0.063
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.063 to 0.064
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.064 to 0.064
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.064 to 0.065
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.065 to 0.066
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.066 to 0.066
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.066 to 0.067
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.067 to 0.068
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.068 to 0.068
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.068 to 0.069
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.069 to 0.070
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.070 to 0.070
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.070 to 0.071
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.071 to 0.072
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.072 to 0.073
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.073 to 0.073
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.073 to 0.074
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.074 to 0.075
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.075 to 0.075
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.075 to 0.076
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.076 to 0.077
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.077 to 0.078
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.078 to 0.079
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.079 to 0.079
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.079 to 0.080
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.080 to 0.081
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.081 to 0.082
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.082 to 0.083
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.083 to 0.083
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.083 to 0.084
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.084 to 0.085
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.085 to 0.086
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.086 to 0.087
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.087 to 0.088
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.088 to 0.088
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.088 to 0.089
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.089 to 0.090
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.090 to 0.091
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.091 to 0.092
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.092 to 0.093
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.093 to 0.094
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.094 to 0.095
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.095 to 0.096
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.096 to 0.097
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.097 to 0.098
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.098 to 0.099
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.099 to 0.100
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.100 to 0.101
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.101 to 0.102
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.102 to 0.103
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.103 to 0.104
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.104 to 0.105
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.105 to 0.106
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.106 to 0.107
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.107 to 0.108
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.108 to 0.109
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.109 to 0.110
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.110 to 0.111
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.111 to 0.112
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.112 to 0.113
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.113 to 0.115
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.115 to 0.116
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.116 to 0.117
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.117 to 0.118
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.118 to 0.119
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.119 to 0.120
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.120 to 0.122
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.122 to 0.123
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.123 to 0.124
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.124 to 0.125
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.125 to 0.127
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.127 to 0.128
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.128 to 0.129
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.129 to 0.130
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.130 to 0.132
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.132 to 0.133
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.133 to 0.134
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.134 to 0.136
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.136 to 0.137
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.137 to 0.138
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.138 to 0.140
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.140 to 0.141
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.141 to 0.143
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.143 to 0.144
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.144 to 0.146
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.146 to 0.147
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.147 to 0.148
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.148 to 0.150
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.150 to 0.151
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.151 to 0.153
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.153 to 0.154
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.154 to 0.156
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.156 to 0.158
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.158 to 0.159
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.159 to 0.161
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.161 to 0.162
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.162 to 0.164
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.164 to 0.166
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.166 to 0.167
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.167 to 0.169
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.169 to 0.171
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.171 to 0.172
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.172 to 0.174
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.174 to 0.176
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.176 to 0.178
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.178 to 0.179
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.179 to 0.181
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.181 to 0.183
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.183 to 0.185
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.185 to 0.187
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.187 to 0.188
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.188 to 0.190
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.190 to 0.192
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.192 to 0.194
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.194 to 0.196
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.196 to 0.198
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.198 to 0.200
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.200 to 0.202
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.202 to 0.204
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.204 to 0.206
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.206 to 0.208
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.208 to 0.210
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.210 to 0.212
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.212 to 0.214
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.214 to 0.217
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.217 to 0.219
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.219 to 0.221
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.221 to 0.223
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.223 to 0.225
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.225 to 0.228
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.228 to 0.230
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.230 to 0.232
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.232 to 0.235
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.235 to 0.237
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.237 to 0.239
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.239 to 0.242
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.242 to 0.244
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.244 to 0.247
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.247 to 0.249
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.249 to 0.252
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.252 to 0.254
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.254 to 0.257
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.257 to 0.259
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.259 to 0.262
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.262 to 0.264
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.264 to 0.267
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.267 to 0.270
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.270 to 0.272
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.272 to 0.275
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.275 to 0.278
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.278 to 0.281
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.281 to 0.283
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.283 to 0.286
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.286 to 0.289
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.289 to 0.292
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.292 to 0.295
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.295 to 0.298
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.298 to 0.301
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.301 to 0.304
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.304 to 0.307
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.307 to 0.310
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.310 to 0.313
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.313 to 0.316
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.316 to 0.319
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.319 to 0.323
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.323 to 0.326
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.326 to 0.329
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.329 to 0.332
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.332 to 0.336
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.336 to 0.339
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.339 to 0.342
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.342 to 0.346
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.346 to 0.349
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.349 to 0.353
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.353 to 0.356
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.356 to 0.360
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.360 to 0.363
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.363 to 0.367
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.367 to 0.371
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
    KDE bandwidth adjusted from 0.371 to 0.374
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=3371 samples
min Q(x) = 1.0741663203361895e-07
Plot saved to KDE_fit_plots/sim_12050500_using_08KE016.png
N=3593 samples
min Q(x) = 0.0045731705613434315
Plot saved to KDE_fit_plots/sim_08LA009_using_08KA007.png
N=731 samples
    KDE bandwidth adjusted from 0.610 to 0.616
KDE returned P(x_i) = 0, adjusting bandwidth by a factor of 1.01
N=731 samples
min Q(x) = 2.0500986011029454e-06
Plot saved to KDE_fit_plots/sim_12415290_using_12083000.png
      proxy    target  min_concurrent_years  nested_catchments  \
0   05CA001   08LF051                     1                  0   
1   08LE031  12205000                     1                  0   
2   08MH004  12458000                     1                  0   
3   07EE002  15085800                     1                  0   
4  12036000  12039500                     1                  0   
5   08GB013  12100496                     1                  0   
6   08KE016  12050500                     1                  0   
7   08KA007   08LA009                     1                  0   
8  12083000  12415290                     1                  0   

   centroid_distance  num_concurrent_obs  proxy_n_obs  target_n_obs  \
0             317.06                5557         5739         23468   
1             293.69               20241        20241         25202   
2             238.26                1138         1138         17173   
3             595.15                1921         3549          5721   
4              18.58               25202        25202         25202   
5             333.26                4852         8964          6615   
6             546.98                3371        18343          7429   
7              97.72                3593        22495          3815   
8             421.84                 731        21428           731   

   proxy_frac_concurrent  target_frac_concurrent    kld_lb  kld_median  \
0               0.968287                0.236791  0.469242    0.477195   
1               1.000000                0.803151  0.076257         NaN   
2               1.000000                0.066267  1.083024    1.146405   
3               0.541279                0.335780  0.000201    0.000215   
4               1.000000                1.000000  1.351763    1.378502   
5               0.541276                0.733485  0.303306    0.319105   
6               0.183776                0.453762       NaN         NaN   
7               0.159724                0.941809  0.346798    0.354155   
8               0.034114                1.000000       NaN         NaN   

     kld_ub  
0  0.481775  
1       NaN  
2  1.219597  
3  0.000231  
4  1.424785  
5  0.333693  
6       NaN  
7  0.363746  
8       NaN  
</pre></div>
</div>
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">NameError</span><span class="g g-Whitespace">                                 </span>Traceback (most recent call last)
<span class="n">Cell</span> <span class="n">In</span><span class="p">[</span><span class="mi">53</span><span class="p">],</span> <span class="n">line</span> <span class="mi">58</span>
<span class="g g-Whitespace">     </span><span class="mi">56</span> <span class="n">batch_result</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">57</span> <span class="nb">print</span><span class="p">(</span><span class="n">batch_result</span><span class="p">)</span>
<span class="ne">---&gt; </span><span class="mi">58</span> <span class="nb">print</span><span class="p">(</span><span class="n">asdf</span><span class="p">)</span>
<span class="g g-Whitespace">     </span><span class="mi">59</span> <span class="k">if</span> <span class="n">batch_result</span><span class="o">.</span><span class="n">empty</span><span class="p">:</span>
<span class="g g-Whitespace">     </span><span class="mi">60</span>     <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Empty batch.  Skipping&#39;</span><span class="p">)</span>

<span class="ne">NameError</span>: name &#39;asdf&#39; is not defined
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;data/parametric_divergence_test/KL_parametric_fits_4bits_20241125.csv&#39;</span><span class="p">)</span>
<span class="c1"># print(len(result_df))</span>
<span class="c1"># foo = result_df.copy()</span>
<span class="c1"># foo.dropna(subset=[&#39;kld_lb&#39;], inplace=True)</span>
<span class="c1"># foo[&#39;kld_ci_range&#39;] = foo[&#39;kld_ub&#39;] - foo[&#39;kld_lb&#39;]</span>
<span class="c1"># print(foo[&#39;kld_ci_range&#39;].max())</span>
<span class="c1"># foo.head()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">foo</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="s1">&#39;num_concurrent_obs&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bin_size</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">foo</span><span class="p">)</span> <span class="o">/</span> <span class="mi">50</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">bin_size</span><span class="si">}</span><span class="s1"> samples per bin&#39;</span><span class="p">)</span>
<span class="n">foo</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">foo</span><span class="o">.</span><span class="n">index</span> <span class="o">//</span> <span class="n">bin_size</span>
<span class="n">foo</span><span class="p">[</span><span class="s1">&#39;n_years&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">foo</span><span class="p">[</span><span class="s1">&#39;num_concurrent_obs&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mf">365.24</span>

<span class="n">bin_data</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">foo</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))):</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">foo</span><span class="p">[</span><span class="n">foo</span><span class="p">[</span><span class="s1">&#39;bin&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">vals</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;kld_ci_range&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">sample_size</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s1">&#39;n_years&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">bin_data</span><span class="o">.</span><span class="n">append</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">sample_size</span><span class="p">)]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">vals</span><span class="p">,</span> <span class="p">[</span><span class="mf">2.5</span><span class="p">,</span> <span class="mi">25</span><span class="p">,</span> <span class="mi">50</span><span class="p">,</span> <span class="mi">75</span><span class="p">,</span> <span class="mi">95</span><span class="p">])</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>   
    
<span class="n">bdf</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">bin_data</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;lb&#39;</span><span class="p">,</span> <span class="s1">&#39;25&#39;</span><span class="p">,</span> <span class="s1">&#39;median&#39;</span><span class="p">,</span> <span class="s1">&#39;75&#39;</span><span class="p">,</span> <span class="s1">&#39;ub&#39;</span><span class="p">])</span>
<span class="c1"># grouped[&#39;bin_center&#39;] = foo.groupby(&#39;bin&#39;)[&#39;num_concurrent_obs&#39;].median().values</span>

<span class="n">p</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">600</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;lb&#39;</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;ub&#39;</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;95% CI&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">varea</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">y1</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;25&#39;</span><span class="p">],</span> <span class="n">y2</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;75&#39;</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;IQR&#39;</span><span class="p">,</span> <span class="n">fill_alpha</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">],</span> <span class="n">y</span><span class="o">=</span><span class="n">bdf</span><span class="p">[</span><span class="s1">&#39;median&#39;</span><span class="p">],</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Median&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;solid&#39;</span><span class="p">)</span>
<span class="n">p</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s2">&quot;Concurrent Record Length [years]&quot;</span>
<span class="n">p</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;$$95\% \text{ CI } \hat D_\text</span><span class="si">{KL}</span><span class="s2">(P||Q)$$&quot;</span>
<span class="n">p</span> <span class="o">=</span> <span class="n">dpf</span><span class="o">.</span><span class="n">format_fig_fonts</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">font_size</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span>
<span class="n">show</span><span class="p">(</span><span class="n">p</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The plot above describes how the (bootstrapped) uncertainty of the KL divergence estimate decreases with sample size.  The series are computed on record length intervals determined by equal sample size, approximately 6000 samples per interval.</p>
</section>
<section id="citations">
<h1>Citations<a class="headerlink" href="#citations" title="Link to this heading">#</a></h1>
<span class="target" id="id1"></span></section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Streamflow observation as a model of streamflow observation</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-runoff-variability">Characterizing Runoff Variability</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#optimal-encoding">Optimal Encoding</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#probabilistic-representations-of-observed-sequences">Probabilistic Representations of Observed Sequences</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#motivating-example">Motivating Example</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#epistemic-noise">Epistemic Noise</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#comparing-probability-distributions">Comparing Probability Distributions</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#target-proxy-range-binning">Target/Proxy Range Binning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#application-based-binning">Application-based Binning</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#maximum-uncertainty-binning">Maximum Uncertainty Binning</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#visualize-the-noise-added-by-quantization-and-the-prior-assumption">Visualize the Noise added by Quantization and the Prior Assumption</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#good-bad-2">{good, bad}^2</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#dealing-with-underspecification-assuming-a-prior-on-q">Dealing with Underspecification: Assuming a Prior on Q</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#quantization-noise">Quantization Noise</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#quantization-noise-and-representation-bias">Quantization Noise and Representation Bias</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#formalize-the-problem-statement">Formalize the problem statement</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#compute-the-noise-added-to-a-discriminant-value-due-to-assuming-an-error-distribution-as-a-prior">Compute the noise added to a discriminant value due to assuming an error distribution as a prior</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pairwise-processing">Pairwise Processing</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#citations">Citations</a></li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Dan Kovacek
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
      © Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>